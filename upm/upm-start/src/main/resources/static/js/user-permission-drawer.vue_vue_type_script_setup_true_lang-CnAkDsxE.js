var u=(g,p,n)=>new Promise((l,t)=>{var m=o=>{try{d(n.next(o))}catch(i){t(i)}},s=o=>{try{d(n.throw(o))}catch(i){t(i)}},d=o=>o.done?l(o.value):Promise.resolve(o.value).then(m,s);d((n=n.apply(g,p)).next())});import{ee as R}from"./bootstrap-DjYyHEgg.js";import{e as _,f as D,g as I}from"./index-ZCUElbZQ.js";import{p as A}from"./data-DUfe3ftl.js";import{m as S,b9 as b,ab as B,b2 as V,bJ as w,j as L,u as x,ai as O}from"../jse/index-index-rmdNY63r.js";import{u as j}from"./use-drawer-CB92zaEG.js";const q=S({__name:"user-permission-drawer",emits:["reload"],setup(g,{emit:p}){const n=p,l=b({}),t=b([]),[m,s]=j({destroyOnClose:!0,onConfirm:d,onOpenChange(r){return u(this,null,function*(){if(r){s.lock();const c=s.getData();l.value=c,s.unlock()}})}});function d(){return u(this,null,function*(){try{s.lock(!0);const r={interfacePathList:t.value,userId:l.value.id};yield _(r),n("reload"),s.close()}catch(r){console.error(r)}finally{s.lock(!1)}})}const o={checkboxConfig:{highlight:!0,reserve:!0,trigger:"row",checkRowKeys:t.value},toolbarConfig:{custom:!1,export:!1,refresh:!1,resizable:!1,zoom:!1},columns:A,height:"auto",keepSource:!0,pagerConfig:{enabled:!1},proxyConfig:{ajax:{query:()=>u(null,null,function*(){const[r,c]=yield Promise.all([D(l.value.id),I()]);t.value=r.map(e=>e.interfacePath);const h=c.map(e=>{const a=e.match(/^([^[]+)(\[.*\])$/);return!a&&!e&&console.warn("无效的接口路径格式:",e),{interfacePath:a?a[1]:e,name:a?a[2]:""}}),k=new Set(t.value);return h.filter(e=>k.has(e.interfacePath)).forEach(e=>{f.grid.setCheckboxRow(e,!0)}),{records:h}})}},rowConfig:{keyField:"interfacePath"}};function i(){var e;const r=f.grid.getCheckboxReserveRecords(),c=f.grid.getCheckboxRecords(),h=f.grid.getData(),C=[...((e=t.value)==null?void 0:e.filter(a=>!h.some(y=>y.interfacePath===a)))||[],...r.map(a=>a.interfacePath),...c.map(a=>a.interfacePath)];return[...new Set(C)]}const P={checkboxChange(){t.value=i()},checkboxAll(){t.value=i()}},[v,f]=R({gridOptions:o,gridEvents:P});return(r,c)=>(V(),B(x(m),{title:"授权数据权限",class:"w-[800px]"},{default:w(()=>[L(x(v),null,{dataScope:w(()=>[...c[0]||(c[0]=[O(" 仅自己 ",-1)])]),_:1})]),_:1}))}});export{q as _};
