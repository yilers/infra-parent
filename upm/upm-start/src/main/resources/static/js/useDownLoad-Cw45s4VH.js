var E=Object.defineProperty,k=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var v=(r,e,s)=>e in r?E(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s,d=(r,e)=>{for(var s in e||(e={}))A.call(e,s)&&v(r,s,e[s]);if(x)for(var s of x(e))I.call(e,s)&&v(r,s,e[s]);return r},F=(r,e)=>k(r,S(e));var c=(r,e,s)=>new Promise((n,u)=>{var w=l=>{try{f(s.next(l))}catch(t){u(t)}},y=l=>{try{f(s.throw(l))}catch(t){u(t)}},f=l=>l.done?n(l.value):Promise.resolve(l.value).then(w,y);f((s=s.apply(r,e)).next())});import{dN as N,dK as B,bq as P}from"./bootstrap-DjYyHEgg.js";import{b as T,c as U}from"./fileTransfer-p8-3apt7.js";import{u as V}from"./useShopCheck-DKIjDUfz.js";import{b9 as q,da as D,db as G}from"../jse/index-index-rmdNY63r.js";function z(){const{apiURL:r}=N(),e=q(!1),{checkShopSelected:s}=V(),n=(l,t)=>c(null,null,function*(){if(s()&&!e.value){e.value=!0;try{const o=l.formApi.getLatestSubmissionValues(),a=F(d({},o),{code:t});yield U(a),u()}catch(o){console.error(o)}finally{e.value=!1}}});function u(){P.push("/basic/exportFile")}return{handleDownload:n,downLoading:e,handleIdDownload:l=>c(null,null,function*(){try{l&&G({source:`${r}/exportTask/download?taskId=${l}`,target:"_self"})}catch(t){console.error(t)}}),handleBlobDownload:(l,t)=>c(null,null,function*(){if(e.value){B.info("有文件正在下载中，请稍后再试");return}try{e.value=!0,t==null||t(!0);const{fileExtension:o,id:a,name:m}=l,p=yield T(a),i=new Blob([p.data],{type:p.headers["content-type"]}),b=`${m}.${o||"xlsx"}`;D({fileName:b,source:i})}finally{e.value=!1,t==null||t(!1)}}),handleExportFileBlob:(l,t)=>c(null,null,function*(){if(e.value){B.info("有文件正在下载中，请稍后再试");return}const{apiParams:o,exportApi:a,name:m,fileExtension:p}=l;try{e.value=!0,t==null||t(!0);const i=yield a(d({},o)),b=new Blob([i.data],{type:i.headers["content-type"]}),$=`${m}.${p||"xlsx"}`;D({fileName:$,source:b})}finally{e.value=!1,t==null||t(!1)}})}}export{z as u};
