var B=Object.defineProperty,T=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var g=(s,o,t)=>o in s?B(s,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[o]=t,D=(s,o)=>{for(var t in o||(o={}))U.call(o,t)&&g(s,t,o[t]);if(y)for(var t of y(o))R.call(o,t)&&g(s,t,o[t]);return s},L=(s,o)=>T(s,O(o));var c=(s,o,t)=>new Promise((u,l)=>{var m=n=>{try{p(t.next(n))}catch(r){l(r)}},f=n=>{try{p(t.throw(n))}catch(r){l(r)}},p=n=>n.done?u(n.value):Promise.resolve(n.value).then(m,f);p((t=t.apply(s,o)).next())});import{bv as P,bx as E,a8 as $}from"./bootstrap-DjYyHEgg.js";import{b as j}from"./index-D5n-88Z9.js";import{b as z}from"./index-DphJOICZ.js";import{h as G,d as J}from"./index-ZCUElbZQ.js";import{a as M}from"./data-I_kBbuuX.js";import{d as W}from"./data-DUfe3ftl.js";import{m as q,b9 as b,aa as H,b$ as K,L as h,ab as Q,b2 as X,bJ as Y,j as Z,u as _}from"../jse/index-index-rmdNY63r.js";import{u as ee}from"./use-drawer-CB92zaEG.js";import{m as ae}from"./crypto-DK7XV_U1.js";import{s as te,l as oe,b as se}from"./tree-DTIvVT2i.js";const be=q({__name:"user-drawer",emits:["reload"],setup(s,{emit:o}){const t=o,u=b(),l=b(!1),m=b("123456"),f=H(()=>l.value?P("pages.common.edit"):P("pages.common.add"));function p(e){return c(this,null,function*(){!e&&m.value&&r.setFieldValue("password",m.value)})}const[n,r]=E({commonConfig:{formItemClass:"col-span-2",componentProps:{class:"w-full"},labelWidth:80},schema:W(),showDefaultActions:!1,wrapperClass:"grid-cols-2"}),[C,d]=ee({destroyOnClose:!0,onConfirm:S,onOpenChange(e){return c(this,null,function*(){if(e){d.lock();const a=d.getData();l.value=!!a.id,Array.isArray(a.roleList)&&(a.roleIdList=a.roleList.map(w=>w.id)),u.value=a,r.updateSchema([{componentProps:{disabled:l.value},fieldName:"account"},{dependencies:{show:()=>!l.value,triggerFields:["id"]},fieldName:"password"}]);const i=[F(),V(),p(l.value)];yield Promise.all(i),r.setValues(a),d.unlock()}})}});function S(){return c(this,null,function*(){try{d.lock(!0);const{valid:e}=yield r.validate();if(!e)return;const a=K(yield r.getValues());a.password&&!l.value&&(a.password=ae(a.password)),yield l.value?G(a):J(a),t("reload"),d.close()}catch(e){console.error(e)}finally{d.lock(!1)}})}function x(e,a="deptName",i=" / "){const w=e.map(N=>L(D({},N),{disabled:N.usable===0})),I=te(w,"sortNumber","id"),v=oe(I,{id:"id",pid:"parentId"});return se(v,a,i),v}const A=()=>c(null,null,function*(){try{const e=yield j({});return x(e)}catch(e){return console.error("获取部门树失败",e),[]}}),F=()=>c(null,null,function*(){const e=yield A();r.updateSchema([{componentProps:{fieldNames:{label:"deptName",value:"id"},showSearch:!0,treeData:e,treeDefaultExpandAll:!0,treeLine:{showLeafIcon:!1},treeNodeLabelProp:"fullName",treeNodeFilterProp:"deptName"},fieldName:"deptId"}])}),V=()=>c(null,null,function*(){const a=(yield z({current:1,size:40,data:{}})).records||[];r.updateSchema([{componentProps:{optionLabelProp:"title",options:a.map(i=>({label:k(i),title:i.roleName,value:i.id}))},fieldName:"roleIdList"}])});function k(e){const a=M.find(i=>i.value===e.dataScope);return a?h("div",{class:"flex items-center gap-[6px]"},[h("span",null,e.roleName),h($,{color:a.color},()=>a.label)]):e.roleName}return(e,a)=>(X(),Q(_(C),{title:f.value,class:"w-[600px]"},{default:Y(()=>[Z(_(n))]),_:1},8,["title"]))}});export{be as _};
