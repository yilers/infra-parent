var ee=Object.defineProperty,oe=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var M=(r,t,e)=>t in r?ee(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,i=(r,t)=>{for(var e in t||(t={}))ae.call(t,e)&&M(r,e,t[e]);if(A)for(var e of A(t))se.call(t,e)&&M(r,e,t[e]);return r},d=(r,t)=>oe(r,te(t));var x=(r,t,e)=>new Promise((C,f)=>{var F=c=>{try{y(e.next(c))}catch(T){f(T)}},E=c=>{try{y(e.throw(c))}catch(T){f(T)}},y=c=>c.done?C(c.value):Promise.resolve(c.value).then(F,E);y((e=e.apply(r,t)).next())});import{W as re}from"./index-C4NAiFfA.js";import{dO as p,dv as S,dJ as ie,a7 as ne,dK as le}from"./bootstrap-DjYyHEgg.js";import{a as ce,b as de}from"./common-DOFZpKVA.js";import{h as me,a as pe,b as ue}from"./shopRechargeSales-BtQUcM40.js";import{u as fe}from"./useDownLoad-Cw45s4VH.js";import{u as be}from"./useShopCheck-DKIjDUfz.js";import{u as Ce}from"./useTransForm-WoUBoxq3.js";import{m as he,b9 as V,be as ge,ab as z,b2 as N,u as R,bJ as u,bc as b,aS as P,aw as k,bL as ye,ai as Te,j as we}from"../jse/index-index-rmdNY63r.js";const ve={date:{field:"formattedTime",title:"日期",width:130},specs:{field:"specs",title:"规格",width:130},channel:{field:"specs",title:"渠道",width:160},difference:{width:200,field:"difference",title:"与腾讯后台数据对比是否有差异",slots:{default:"difference"}},customRemark:{width:280,field:"customRemark",title:"自定义备注",slots:{default:"customRemark"}},action:{width:180,title:"操作",align:"center",field:"action",slots:{default:"action"},fixed:"right"}},Ve=he({__name:"base-table",props:{activeTab:{},businessCategory:{},searchFormSchemas:{},gridSchemas:{},baseColumns:{default:()=>[ve.date]},exportFileName:{default:"数据报表"},additionalColumns:{default:()=>[]},apiConfig:{default:()=>({api:me,buildParams:({formValues:r,pagination:t,activeTab:e,businessCategory:C,templateType:f})=>d(i(i(d(i({},t&&{current:t.currentPage,size:t.pageSize}),{tabCode:e}),r),f===S.Proportion?{saleRate:1}:{}),{businessCategory:C}),hasPagination:!0})},permissionCode:{default:()=>[]},templateType:{},direction:{default:p.Horizontal}},setup(r,{expose:t}){const e=r,{checkShopSelected:C}=be(),{handleExportFileBlob:f,downLoading:F}=fe(),{transformColumns:E,transformRowData:y,rowspanMethod:c,rowspanCustomMethod:T,rowspanTransposedMethod:G,transformColumnsToColumnMode:L,transformRowDataToColumnMode:O,transformColumnsToTransposed:$,transformRowDataToTransposed:B}=Ce(),w=V([]),h=V([]),H=i({},e.searchFormSchemas),W=d(i({},e.gridSchemas),{columns:[],toolbarConfig:i({},e.gridSchemas.toolbarConfig),stripe:!0,border:!0,rowConfig:{isHover:!0},columnConfig:{resizable:!1},showOverflow:!0,height:"auto",keepSource:!0,pagerConfig:{enabled:e.apiConfig.hasPagination},exportConfig:{},spanMethod:e.direction===p.Transposed?G:e.templateType===S.Summary?T:c,virtualYConfig:{enabled:!1},virtualXConfig:{enabled:!1},proxyConfig:{ajax:{query:I},sort:!0}});function j(o){const a=e.direction!==p.Vertical&&e.direction!==p.Transposed;return[...e.baseColumns.filter(s=>!(!a&&s.field==="specs")).map(s=>{var m;if(s.field==="formattedTime"){const l=((m=v.formApi)==null?void 0:m.getLatestSubmissionValues())||{},g={day:130,week:180,month:130,season:130}[l.type]||130;return d(i({},s),{width:g})}return s}),...o,...e.additionalColumns]}function I(s,m){return x(this,arguments,function*({page:{currentPage:o,pageSize:a}},n){if(!C())return{result:{records:[],total:0}};try{const[l,D]=yield Promise.all([pe(i({tabCode:e.activeTab},n.year&&{year:n.year})),ue({tabCode:e.activeTab})]);w.value=(l==null?void 0:l.length)>0?[...l]:[],h.value=D||[];let g;e.direction===p.Horizontal?g=E(w.value):e.direction===p.Transposed?g=$(w.value,h.value):g=L(w.value,h.value),v.setGridOptions({columns:j(g)});const Q=d(i({formValues:n},e.apiConfig.hasPagination&&{pagination:{currentPage:o,pageSize:a}}),{activeTab:e.activeTab,businessCategory:e.businessCategory,templateType:e.templateType}),Z=yield e.apiConfig.api(e.apiConfig.buildParams(Q));return q(Z)}catch(l){return console.error("获取数据失败:",l),{total:0,records:[]}}})}function J(o,a){var s;const n=a?o==null?void 0:o.records:(s=o==null?void 0:o.records)!=null?s:o;return Array.isArray(n)?n:[]}function q(o){var l;const a=!!e.apiConfig.hasPagination,n=J(o,a);if(n.length===0||a&&Number((l=o==null?void 0:o.total)!=null?l:0)===0)return a?d(i({},o),{records:[]}):{records:[]};let m;return e.direction===p.Horizontal?m=y(h.value,n,a):e.direction===p.Transposed?m=B(w.value,h.value,n,a):m=O(h.value,n,a),a?d(i({},o),{records:m}):{records:m}}const K={},[U,v]=ie({gridEvents:K,formOptions:H,gridOptions:W}),X=()=>x(null,null,function*(){C()&&(e.templateType===S.CommonC?_():Y())}),Y=()=>x(null,null,function*(){const o=yield v.formApi.getLatestSubmissionValues();if(!o.startTime||!o.endTime){le.info("请先选择日期");return}const a={apiParams:d(i(i({tabCode:e.activeTab},e.templateType===S.Proportion?{saleRate:1}:{}),o),{businessCategory:e.businessCategory}),name:e.exportFileName,fileExtension:"xlsx",exportApi:ce};f(a)}),_=()=>x(null,null,function*(){const o=yield v.formApi.getLatestSubmissionValues(),a={apiParams:i({tabCode:e.activeTab},o),name:e.exportFileName,fileExtension:"xlsx",exportApi:de};f(a)});return t({gridApi:v}),(o,a)=>{const n=ge("access");return N(),z(R(U),null,{"toolbar-actions":u(()=>[b(o.$slots,"toolbar-actions")]),"toolbar-tools":u(()=>[b(o.$slots,"toolbar-tools"),ye((N(),z(R(ne),{loading:R(F),class:"mr-2",type:"primary",onClick:X},{icon:u(()=>[we(R(re),{class:"mr-1 inline-block size-6"})]),default:u(()=>[a[0]||(a[0]=Te(" 导出报表 ",-1))]),_:1},8,["loading"])),[[n,r.permissionCode,"code"]]),b(o.$slots,"toolbar-suffix")]),status:u(s=>[b(o.$slots,"status",P(k(s)))]),difference:u(s=>[b(o.$slots,"difference",P(k(s)))]),customRemark:u(s=>[b(o.$slots,"customRemark",P(k(s)))]),action:u(s=>[b(o.$slots,"action",P(k(s)))]),_:3})}}});export{ve as C,Ve as _};
