var I=Object.defineProperty,O=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var k=(s,e,a)=>e in s?I(s,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[e]=a,u=(s,e)=>{for(var a in e||(e={}))q.call(e,a)&&k(s,a,e[a]);if(_)for(var a of _(e))J.call(e,a)&&k(s,a,e[a]);return s},h=(s,e)=>O(s,j(e));var y=(s,e,a)=>new Promise((b,i)=>{var l=n=>{try{d(a.next(n))}catch(p){i(p)}},c=n=>{try{d(a.throw(n))}catch(p){i(p)}},d=n=>n.done?b(n.value):Promise.resolve(n.value).then(l,c);d((a=a.apply(s,e)).next())});import{dX as f,dJ as R,dZ as U,dK as x}from"./bootstrap-DjYyHEgg.js";import{h as $,c as H}from"./cardType-DPMG7IpI.js";import{h as K}from"./choose-custom-modal.vue_vue_type_script_setup_true_lang-B5kymVJs.js";import{u as P}from"./useShopCheck-DKIjDUfz.js";import{b as X,a as Z}from"./business-Uwvf-GkQ.js";import{_ as L}from"./form.vue_vue_type_script_setup_true_lang-RFlfxSZs.js";import{u as Q,t as W}from"./useSchemas-BvOAAoUm.js";import{_ as T}from"./table-action.vue_vue_type_style_index_0_lang-BluPqhNI.js";import{m as Y,b9 as w,v as ee,aa as B,ad as ae,b2 as N,j as v,bJ as C,ab as te,ac as se,u as m,ai as oe,bp as re,I as ne}from"../jse/index-index-rmdNY63r.js";const be=Y({__name:"table",props:{businessCategory:{default:f.Sale}},setup(s){const e=s,{gridSchemas:a,searchFormSchemas:b}=Q(e.businessCategory),i=w(),l=w([]),{checkShopSelected:c}=P(),d=u({},b),n=h(u({},a),{toolbarConfig:u({},a.toolbarConfig),stripe:!0,border:!0,rowConfig:{isHover:!0},columnConfig:{resizable:!1},showOverflow:!0,exportConfig:{},height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:(S,E)=>y(null,[S,E],function*({page:{currentPage:t,pageSize:o}},r){return c()?yield $(h(u(u({current:t,size:o},r),[f.Sale,f.Summary].includes(e.businessCategory)?{type:U.Custom}:{}),{businessCategory:Z(e.businessCategory),businessType:X(e.businessCategory)})):{result:{records:[],total:0}}})}}}),p={},[D,g]=R({gridEvents:p,formOptions:d,gridOptions:n}),V=()=>y(null,null,function*(){if(!c())return{result:{records:[],total:0}};try{const t=yield K(e.businessCategory);l.value=t.map(o=>({label:o.name,value:o.id})),g.formApi.updateSchema([{componentProps:{options:l.value},fieldName:"categoryId"}])}catch(t){x.error("获取分类失败")}});ee(()=>{[f.Sale].includes(e.businessCategory)&&V()});const F=B(()=>t=>{var o,r,S;return(S=(r=(o=l.value)==null?void 0:o.find(E=>E.value===t))==null?void 0:r.label)!=null?S:"-"}),G=()=>{c()&&(i.value.setData({businessCategory:e.businessCategory,isUpdate:!1,gridApi:g,categories:m(l)}),i.value.open())},M=t=>{i.value.setData({businessCategory:e.businessCategory,record:t,isUpdate:!0,gridApi:g,categories:m(l)}),i.value.open()},z=t=>y(null,null,function*(){yield H(t.id),x.success("删除成功"),g.query()}),A=B(()=>{var t;return(t=W.find(o=>o.key===e.businessCategory))==null?void 0:t.addText});return(t,o)=>(N(),ae(ne,null,[v(m(D),null,{"toolbar-actions":C(()=>[v(m(T),{actions:[{label:A.value,type:"primary",icon:"ant-design:plus-outlined",auth:["template:cardTypeManagement:add"],onClick:G.bind(null)}]},null,8,["actions"])]),"toolbar-tools":C(()=>[...o[0]||(o[0]=[])]),category:C(({row:r})=>[oe(re(F.value(r.categoryId)),1)]),action:C(({row:r})=>[r.operate===1?(N(),te(m(T),{key:0,actions:[{label:"编辑",icon:"ant-design:edit-outlined",type:"link",size:"small",auth:["template:cardTypeManagement:edit"],onClick:M.bind(null,r)}],"drop-down-actions":[{label:"删除",icon:"ant-design:delete-outlined",auth:["template:cardTypeManagement:delete"],popConfirm:{title:"确定删除吗？",confirm:z.bind(null,r)}}]},null,8,["actions","drop-down-actions"])):se("",!0)]),_:1}),v(L,{ref_key:"cardFormRef",ref:i},null,512)],64))}});export{be as _};
