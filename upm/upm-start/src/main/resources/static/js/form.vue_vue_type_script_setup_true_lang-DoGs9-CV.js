var I=Object.defineProperty,_=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var w=(e,a,t)=>a in e?I(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,p=(e,a)=>{for(var t in a||(a={}))x.call(a,t)&&w(e,t,a[t]);if(b)for(var t of b(a))N.call(a,t)&&w(e,t,a[t]);return e},C=(e,a)=>_(e,A(a));var l=(e,a,t)=>new Promise((m,d)=>{var u=r=>{try{i(t.next(r))}catch(n){d(n)}},h=r=>{try{i(t.throw(r))}catch(n){d(n)}},i=r=>r.done?m(r.value):Promise.resolve(r.value).then(u,h);i((t=t.apply(e,a)).next())});import{dy as g,dL as P,bj as L,dK as j}from"./bootstrap-DjYyHEgg.js";import{u as k}from"./useDateRangePicker-DjB1zMnJ.js";import{m as M,b9 as f,ab as B,b2 as F,u as v,bJ as R,ae as Y,j as U}from"../jse/index-index-rmdNY63r.js";function Q(e){return l(this,null,function*(){return g.post("baseCardAggregate/pageList",e)})}function q(e){return l(this,null,function*(){return g.post("/baseCardAggregate/add",e)})}function H(e){return l(this,null,function*(){return g.post("/baseCardAggregate/update",e)})}function W(e){return l(this,null,function*(){return g.post(`/baseCardAggregate/delete/${e}`)})}const{dateRangePresets:$}=k(),X={toolbarConfig:{resizable:!0},columns:[{field:"cardNames",align:"left",title:"卡种名称",width:300,formatter({cellValue:e}){return(e==null?void 0:e.split(",").join(`
`))||""}},{field:"productNames",align:"left",title:"关联腾讯商品",formatter({cellValue:e}){return(e==null?void 0:e.split(",").join(`
`))||""}},{field:"createTime",title:"添加时间",width:180},{width:220,title:"操作",align:"center",slots:{default:"action"},fixed:"right"}]},Z={wrapperClass:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",compact:!0,collapsed:!0,commonConfig:{componentProps:{class:"w-full"}},schema:[$.datetime("createTime","创建时间"),{fieldName:"cardIds",label:"卡种名称",component:"Select",componentProps:{placeholder:"请选择",maxTagCount:1,maxTagTextLength:12,mode:"multiple",allowClear:!0,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase())}},{component:"Input",componentProps:{allowClear:!0},defaultValue:"",fieldName:"productName",label:"商品名称"}],fieldMappingTime:[["createTime",["startTime","endTime"],"YYYY-MM-DD HH:mm:ss"]],showCollapseButton:!1,submitOnChange:!1,submitOnEnter:!1},z={wrapperClass:"grid-cols-12",commonConfig:{formItemClass:"col-span-12"},schema:[{fieldName:"id",label:"卡种ID",component:"Input",dependencies:{show:!1,triggerFields:["id"]}},{fieldName:"cardIds",label:"选择卡种",component:"Select",componentProps:{placeholder:"选择卡种",mode:"multiple",allowClear:!0,class:"w-full",showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase())},formItemClass:"col-span-12",rules:"required"}]},E={class:"common-form"},V=M({__name:"form",setup(e,{expose:a}){const t=f(),m=f(!1),d=f(),u=f([]),[h,i]=P(p({showDefaultActions:!1},z)),[r,n]=L({onOpenChange(o){var c;const s=n.getData();m.value=(c=s==null?void 0:s.isUpdate)!=null?c:!1,t.value=o?(s==null?void 0:s.record)||{}:{},d.value=o?s==null?void 0:s.gridApi:null,u.value=o?s==null?void 0:s.categories:[],o&&t.value.cardIds&&(t.value=C(p({},t.value),{cardIds:t.value.cardIds.split(",")})),o&&i.updateSchema([{fieldName:"cardIds",componentProps:{options:u.value}}]),i.setValues(t.value)},onConfirm(){return l(this,null,function*(){var s,c;if((yield i.validate()).valid)try{n.lock(!0);const y=yield i.getValues(),T=yield S(y);yield((s=t.value)!=null&&s.id?H:q)(T),j.success("保存成功"),(c=d.value)==null||c.reload(),n.close()}finally{n.lock(!1)}})}});function S(o){return l(this,null,function*(){const{cardIds:s}=o;return C(p({},o),{cardIds:s.join(",")})})}return a(n),(o,s)=>(F(),B(v(r),{title:m.value?"编辑商品":"新增商品",class:"w-300px"},{default:R(()=>[Y("div",E,[U(v(h))])]),_:1},8,["title"]))}});export{V as _,W as a,X as g,Q as h,Z as s};
