var U=Object.defineProperty,j=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var V=(u,a,s)=>a in u?U(u,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[a]=s,m=(u,a)=>{for(var s in a||(a={}))K.call(a,s)&&V(u,s,a[s]);if(P)for(var s of P(a))q.call(a,s)&&V(u,s,a[s]);return u},h=(u,a)=>j(u,E(a));var k=(u,a,s)=>new Promise((y,x)=>{var d=o=>{try{c(s.next(o))}catch(C){x(C)}},N=o=>{try{c(s.throw(o))}catch(C){x(C)}},c=o=>o.done?y(o.value):Promise.resolve(o.value).then(d,N);c((s=s.apply(u,a)).next())});import{bj as J,dJ as T,dK as z}from"./bootstrap-DjYyHEgg.js";import{a as F}from"./pageTableConfig-CJVVeSTk.js";import{c as w}from"./mapping-BVKRu9Vr.js";import S from"./index-CovW7kLz.js";import{m as H,b9 as I,n as Y,ab as $,b2 as Q,u as p,bJ as v,j as b,ai as O}from"../jse/index-index-rmdNY63r.js";const ne=H({__name:"choose-mapping-column",props:{pageCode:{default:""}},emits:["onSubmit"],setup(u,{expose:a,emit:s}){const y=u,x=s,d=I([]),N=I(!1),c=I([]),o=I([]),[C,R]=J({onOpenChange(n){return k(this,null,function*(){var l,i,r,f;const e=R.getData();N.value=(l=e==null?void 0:e.isUpdate)!=null?l:!1;const t=(r=(i=e==null?void 0:e.defaultCheckedLists)==null?void 0:i.map(M=>M.columnId))!=null?r:[];o.value=[...(f=e==null?void 0:e.defaultCheckedLists)!=null?f:[]],c.value=n?t:[],d.value=n?[...t]:[],n&&(yield Y(),_.setGridOptions({checkboxConfig:{checkRowKeys:c.value}}))})},onConfirm(){return k(this,null,function*(){x("onSubmit",o.value),R.close()})}}),A=h(m({},w),{toolbarConfig:m({},w.toolbarConfig),editConfig:{mode:"cell",trigger:"click",beforeEditMethod:({row:n})=>c.value.includes(n.id)?!0:(z.warning("只有选中的行才能编辑"),!1)},stripe:!0,border:!0,rowConfig:{isHover:!0,keyField:"id"},checkboxConfig:{highlight:!0,checkRowKeys:c.value},columnConfig:{resizable:!1},showOverflow:!1,exportConfig:{},height:"auto",keepSource:!0,pagerConfig:{enabled:!1},virtualYConfig:{},proxyConfig:{ajax:{query:()=>k(null,null,function*(){const n={pageCode:y.pageCode};let e=yield F(n);return e=e.map(t=>{const l=o.value.find(i=>i.id===t.id||i.columnId===t.id);return l?h(m({},t),{customName:l.columnName,sortNumber:l.sortNumber,columnSetting:l.columnSetting||0}):h(m({},t),{customName:t.columnName,columnSetting:0})}),{records:e}})}}}),B={checkboxChange(){c.value=g().ids,o.value=g().lists},checkboxAll(){c.value=g().ids,o.value=g().lists},editClosed({row:n,$grid:e}){if(c.value.includes(n.id)){const t=o.value.findIndex(l=>l.id===n.id||l.columnId===n.id);t!==-1&&(o.value[t]=h(m(m({},o.value[t]),n),{columnId:n.id}))}else e.setCheckboxRow(n,!0);c.value=g().ids,o.value=g().lists}},[G,_]=T({gridOptions:A,gridEvents:B});function g(){const n=_.grid.getData(),e=_.grid.getCheckboxRecords(),t=e.map(i=>i.id);d.value=d.value.filter(i=>t.includes(i)||!n.some(r=>r.id===i)),t.forEach(i=>{d.value.includes(i)||d.value.push(i)});const l=d.value.map(i=>{const r=e.find(f=>f.id===i);return r||o.value.find(f=>f.id===i||f.columnId===i)}).filter(Boolean);return{ids:d.value,lists:l}}const L=n=>{const e=o.value.findIndex(t=>t.id===n.id||t.columnId===n.id);e!==-1&&(o.value[e].columnSetting=n.columnSetting)};return a(R),(n,e)=>(Q(),$(p(C),{title:"选择",class:"h-[90%] w-[70%]","content-class":"h-[100%]"},{default:v(()=>[b(p(G),null,{columnSetting:v(({row:t})=>[b(p(S),{class:"w-[120px]",value:t.columnSetting,"onUpdate:value":l=>t.columnSetting=l,onChange:l=>L(t),disabled:!c.value.includes(t.id)},{default:v(()=>[b(p(S).Option,{value:0},{default:v(()=>[...e[0]||(e[0]=[O("展示并导出",-1)])]),_:1}),b(p(S).Option,{value:1},{default:v(()=>[...e[1]||(e[1]=[O("仅展示",-1)])]),_:1}),b(p(S).Option,{value:2},{default:v(()=>[...e[2]||(e[2]=[O("仅导出",-1)])]),_:1})]),_:1},8,["value","onUpdate:value","onChange","disabled"])]),_:1})]),_:1}))}});export{ne as _};
