var H=Object.defineProperty,W=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var v=(t,e,r)=>e in t?H(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,u=(t,e)=>{for(var r in e||(e={}))U.call(e,r)&&v(t,r,e[r]);if(S)for(var r of S(e))K.call(e,r)&&v(t,r,e[r]);return t},L=(t,e)=>W(t,J(e));var w=(t,e,r)=>new Promise((x,p)=>{var y=a=>{try{l(r.next(a))}catch(m){p(m)}},f=a=>{try{l(r.throw(a))}catch(m){p(m)}},l=a=>a.done?x(a.value):Promise.resolve(a.value).then(y,f);l((r=r.apply(t,e)).next())});import{W as Q}from"./index-C4NAiFfA.js";import{dw as Z,dI as V,dJ as tt,dK as et,dz as ot,a7 as I,bu as rt}from"./bootstrap-DjYyHEgg.js";import{h as at,u as it}from"./fileTransfer-p8-3apt7.js";import{f as nt,A as st}from"./table-FRaKquww.js";import{u as lt,_ as mt}from"./useTableImport-CNd8lRg2.js";import{u as dt}from"./useDownLoad-Cw45s4VH.js";import{u as ut}from"./useDynamicTable-T14ukGXG.js";import{u as ct}from"./useShopCheck-DKIjDUfz.js";import{ci as N,m as pt,b9 as k,v as ft,aa as ht,be as bt,ab as g,b2 as c,bJ as n,j as C,u as o,ae as gt,bp as E,bL as P,ai as A,ad as Ct,I as xt,bb as yt}from"../jse/index-index-rmdNY63r.js";import{p as B}from"./contast-C3bEivmW.js";import{u as Tt}from"./useDateRangePicker-DjB1zMnJ.js";import{_ as _t}from"./page.vue_vue_type_script_setup_true_lang-CmAABu9Z.js";import{_ as wt}from"./fallback.vue_vue_type_script_setup_true_lang-CaaeY5iC.js";import"./index-ld-cT6bn.js";import"./hasIn-CXmLCMBI.js";import"./isSymbol-BoOBgcZb.js";import"./useRefs-ReJqRy3L.js";import"./dateTime-Ce6Ez397.js";import"./index-CovW7kLz.js";import"./pageTableConfig-CJVVeSTk.js";import"./tool-BzPbNkcJ.js";import"./rotate-cw-Dzdn7gja.js";const{dateRangePresets:Dt}=Tt(),D={toolbarConfig:{resizable:!0},columns:[{title:"序号",type:"seq",width:50,fixed:"left"},{field:"id",title:"主键ID",width:180},{field:"commonPayTradeNo",title:"账务流水号"},{field:"aliBusinessSerialNo",title:"业务流水号"},{field:"commonMerchantOrderNo",title:"商户订单号",formatter({cellValue:t}){return t===null||t===""?"--":t}},{field:"commonSupplyOrderNo",title:"供货订单号",formatter({cellValue:t}){return t===null||t===""?"--":t}},{field:"commonSupplyProductId",title:"供货商品ID",formatter({cellValue:t}){return t===null||t===""?"--":t}},{field:"commonSupplyProductName",title:"供货商品名称",formatter({cellValue:t}){return t===null||t===""?"--":t}},{field:"commonProductName",title:"商品名称",formatter({cellValue:t}){return t===null||t===""?"--":t}},{field:"commonTransactionTime",title:"发生时间"},{field:"aliCounterAccount",title:"对方账号"},{field:"commonIncomeAmount",title:"收入金额（+元）"},{field:"commonExpenseAmount",title:"支出金额（-元）"},{field:"aliAccountBalance",title:"账户余额（元）"},{field:"aliTransactionChannel",title:"交易渠道"},{field:"commonBusinessType",title:"业务类型"},{field:"commonRemark",title:"备注",formatter({cellValue:t}){return t===null||t===""?"--":t}},{field:"commonProductId",title:"销售商品ID",formatter({cellValue:t}){return t===null||t===""?"--":t}},{field:"nature",title:"性质",width:270,slots:{default:"natureValue"}},{field:"failedReason",title:"异常原因",formatter({cellValue:t}){return t===null||t===""?"--":t}},{field:"natureStr",title:"性质",width:270},{field:"progressStatus",title:"进度状态",width:150,formatter({cellValue:t}){const e=B.find(r=>r.value===t);return e?e.label:t}}]},St={wrapperClass:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",compact:!0,collapsed:!0,commonConfig:{componentProps:{class:"w-full"}},schema:[Dt.datetime("occurTime","发生时间",[N().startOf("month"),N().endOf("month")]),{component:"Input",componentProps:{allowClear:!0},fieldName:"merchantOrderNo",label:"商户订单号"},{component:"Input",componentProps:{allowClear:!0},fieldName:"productName",label:"商品名称"},{component:"Select",componentProps:{allowClear:!0,placeholder:"请选择",mode:"multiple",maxTagCount:1,maxTagTextLength:6,showSearch:!0,filterOption:(t,e)=>e.label.toLowerCase().includes(t.toLowerCase())},fieldName:"natureList",label:"性质"},{component:"Select",componentProps:{allowClear:!0,options:B,placeholder:"请选择",mode:"multiple",maxTagCount:1,maxTagTextLength:6},fieldName:"progressStatusList",label:"进度状态"}],fieldMappingTime:[["occurTime",["startTime","endTime"],"YYYY-MM-DD HH:mm:ss"]],showCollapseButton:!0,submitOnChange:!1,submitOnEnter:!1},vt=pt({__name:"index",setup(t){const{queryWithColumns:e}=ut({staticColumns:D.columns,pageCode:Z.XYTransactionStatementDetails,queryFn:st}),{checkShopSelected:r}=ct(),{bizImportType:x,bizImportTypeList:p,uploadFormRef:y,isError:f,extension:l,handleImport:a,ImportSettingButton:m}=lt({importTypeList:[{id:1,label:"导入数据",bizCode:"XY_TRADE_BILL_DETAIL",isError:!1,auth:"basic:xyTransactionStatementDetails:import"},{id:2,label:"导入异常数据",bizCode:"XY_TRADE_BILL_DETAIL",isError:!0,auth:"basic:xyTransactionStatementDetails:importFail"}],defaultExtension:".xls,.xlsx,.csv",errorExtension:".xls,.xlsx,.csv"}),z=k(V.xyTradeBillDetailCsv),O=u({},St),F=L(u({},D),{toolbarConfig:u({},D.toolbarConfig),stripe:!0,border:!0,rowConfig:{isHover:!0},columnConfig:{resizable:!1,width:"auto"},showOverflow:!0,exportConfig:{},height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:(i,_)=>w(null,[i,_],function*({page:{currentPage:d,pageSize:s}},b){return r()?yield e(h,u({current:d,size:s},b)):{result:{records:[],total:0}}})}}}),Y={},[R,h]=tt({gridEvents:Y,formOptions:O,gridOptions:F});ft(()=>{M()});const T=k([]),M=()=>w(null,null,function*(){try{const d=yield nt({});T.value=d,h.formApi.updateSchema([{componentProps:{options:T.value},fieldName:"natureList"}])}catch(d){et.error("获取性质失败")}}),{handleDownload:X,downLoading:$}=dt(),{hasAccessByCodes:q}=ot(),j=ht(()=>q(["basic:xyTransactionStatementDetails:list"]));return(d,s)=>{const b=bt("access");return j.value?(c(),g(o(_t),{key:0,"auto-content-height":""},{default:n(()=>[C(o(R),null,{"toolbar-actions":n(()=>[(c(!0),Ct(xt,null,yt(o(p),i=>P((c(),g(o(I),{key:i.id,type:"primary",style:{"margin-right":"12px"},onClick:_=>o(a)(i.bizCode,i.isError,o(h))},{default:n(()=>[A(E(i.label),1)]),_:2},1032,["onClick"])),[[b,[i.auth],"codes"]])),128))]),"toolbar-tools":n(()=>[P((c(),g(o(I),{loading:o($),class:"mr-2",type:"primary",onClick:s[0]||(s[0]=i=>o(X)(o(h),z.value))},{icon:n(()=>[C(o(Q),{class:"mr-1 inline-block size-6"})]),default:n(()=>[s[1]||(s[1]=A(" 导出数据 ",-1))]),_:1},8,["loading"])),[[b,["basic:xyTransactionStatementDetails:export"],"codes"]]),C(o(m))]),natureValue:n(({row:i})=>{var _;return[gt("div",null,E(((_=T.value.find(G=>G.value===i.nature))==null?void 0:_.label)||i.nature),1)]}),_:1}),C(o(mt),{ref_key:"uploadFormRef",ref:y,"biz-import-type":o(x),extension:o(l),"is-error":o(f),"upload-fn":o(f)?o(it):o(at)},null,8,["biz-import-type","extension","is-error","upload-fn"])]),_:1})):(c(),g(o(wt),{key:1,description:"抱歉，您没有权限访问此页面。",status:"403"}))}}}),Kt=rt(vt,[["__scopeId","data-v-fb937582"]]);export{Kt as default};
