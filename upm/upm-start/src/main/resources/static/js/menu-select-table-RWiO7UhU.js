var Z=(e,n,o)=>new Promise((t,r)=>{var c=a=>{try{m(o.next(a))}catch(g){r(g)}},u=a=>{try{m(o.throw(a))}catch(g){r(g)}},m=a=>a.done?t(a.value):Promise.resolve(a.value).then(c,u);m((o=o.apply(e,n)).next())});import{e6 as fe,g as pe,m as ge,_ as W,r as he,d as me,P as M,a as ye,e7 as be,e8 as ve,e9 as Ce,ea as $e,eb as xe,ab as ke,ec as Se,b9 as Ie,j as we,b8 as Te,i as Be,C as Ee,aJ as _e,aK as Ae,G as He,aL as Me,b as ee,ed as ne,ee as ze,a7 as oe,ef as J,bu as Oe}from"./bootstrap-DjYyHEgg.js";import{e as Pe,f as Le}from"./tree-DTIvVT2i.js";import Ne from"./index-xNzK-YmT.js";import De from"./index-CM6A-82x.js";import{m as ie,bl as K,aa as Fe,j as h,bL as Ke,aP as Re,bz as Ge,b9 as je,v as Ve,w as R,ad as se,b2 as U,bJ as S,ae as X,I as We,bb as Je,ab as Ue,u as z,ai as P,bp as G,b$ as Xe,n as qe}from"../jse/index-index-rmdNY63r.js";import{u as j}from"./uniq-B9t2APT2.js";function Ye(e){return Array.isArray(e)?e:Array.from(e)}function Qe(e,n){const o=new Set(n);return e.filter(t=>!o.has(t))}function Ze(e){return typeof e=="object"&&e!==null}function te(e){return Ze(e)&&fe(e)}function en(e,...n){if(!te(e))return[];const o=Ye(e),t=[];for(let r=0;r<n.length;r++){const c=n[r];te(c)&&t.push(...Array.from(c))}return Qe(o,t)}const V=(e,n,o,t,r)=>({backgroundColor:e,border:`${t.lineWidth}px ${t.lineType} ${n}`,[`${r}-icon`]:{color:o}}),nn=e=>{const{componentCls:n,motionDurationSlow:o,marginXS:t,marginSM:r,fontSize:c,fontSizeLG:u,lineHeight:m,borderRadiusLG:a,motionEaseInOutCirc:g,alertIconSizeLG:y,colorText:v,paddingContentVerticalSM:C,alertPaddingHorizontal:$,paddingMD:l,paddingContentHorizontalLG:s}=e;return{[n]:W(W({},he(e)),{position:"relative",display:"flex",alignItems:"center",padding:`${C}px ${$}px`,wordWrap:"break-word",borderRadius:a,[`&${n}-rtl`]:{direction:"rtl"},[`${n}-content`]:{flex:1,minWidth:0},[`${n}-icon`]:{marginInlineEnd:t,lineHeight:0},"&-description":{display:"none",fontSize:c,lineHeight:m},"&-message":{color:v},[`&${n}-motion-leave`]:{overflow:"hidden",opacity:1,transition:`max-height ${o} ${g}, opacity ${o} ${g},
        padding-top ${o} ${g}, padding-bottom ${o} ${g},
        margin-bottom ${o} ${g}`},[`&${n}-motion-leave-active`]:{maxHeight:0,marginBottom:"0 !important",paddingTop:0,paddingBottom:0,opacity:0}}),[`${n}-with-description`]:{alignItems:"flex-start",paddingInline:s,paddingBlock:l,[`${n}-icon`]:{marginInlineEnd:r,fontSize:y,lineHeight:0},[`${n}-message`]:{display:"block",marginBottom:t,color:v,fontSize:u},[`${n}-description`]:{display:"block"}},[`${n}-banner`]:{marginBottom:0,border:"0 !important",borderRadius:0}}},on=e=>{const{componentCls:n,colorSuccess:o,colorSuccessBorder:t,colorSuccessBg:r,colorWarning:c,colorWarningBorder:u,colorWarningBg:m,colorError:a,colorErrorBorder:g,colorErrorBg:y,colorInfo:v,colorInfoBorder:C,colorInfoBg:$}=e;return{[n]:{"&-success":V(r,t,o,e,n),"&-info":V($,C,v,e,n),"&-warning":V(m,u,c,e,n),"&-error":W(W({},V(y,g,a,e,n)),{[`${n}-description > pre`]:{margin:0,padding:0}})}}},sn=e=>{const{componentCls:n,iconCls:o,motionDurationMid:t,marginXS:r,fontSizeIcon:c,colorIcon:u,colorIconHover:m}=e;return{[n]:{"&-action":{marginInlineStart:r},[`${n}-close-icon`]:{marginInlineStart:r,padding:0,overflow:"hidden",fontSize:c,lineHeight:`${c}px`,backgroundColor:"transparent",border:"none",outline:"none",cursor:"pointer",[`${o}-close`]:{color:u,transition:`color ${t}`,"&:hover":{color:m}}},"&-close-text":{color:u,transition:`color ${t}`,"&:hover":{color:m}}}}},tn=e=>[nn(e),on(e),sn(e)],ln=pe("Alert",e=>{const{fontSizeHeading3:n}=e,o=ge(e,{alertIconSizeLG:n,alertPaddingHorizontal:12});return[tn(o)]}),an={success:Ie,info:Se,error:ke,warning:xe},rn={success:$e,info:Ce,error:ve,warning:be},cn=He("success","info","warning","error"),dn=()=>({type:M.oneOf(cn),closable:{type:Boolean,default:void 0},closeText:M.any,message:M.any,description:M.any,afterClose:Function,showIcon:{type:Boolean,default:void 0},prefixCls:String,banner:{type:Boolean,default:void 0},icon:M.any,closeIcon:M.any,onClose:Function}),un=ie({compatConfig:{MODE:3},name:"AAlert",inheritAttrs:!1,props:dn(),setup(e,n){let{slots:o,emit:t,attrs:r,expose:c}=n;const{prefixCls:u,direction:m}=ye("alert",e),[a,g]=ln(u),y=K(!1),v=K(!1),C=K(),$=i=>{i.preventDefault();const f=C.value;f.style.height=`${f.offsetHeight}px`,f.style.height=`${f.offsetHeight}px`,y.value=!0,t("close",i)},l=()=>{var i;y.value=!1,v.value=!0,(i=e.afterClose)===null||i===void 0||i.call(e)},s=Fe(()=>{const{type:i}=e;return i!==void 0?i:e.banner?"warning":"info"});c({animationEnd:l});const d=K({});return()=>{var i,f,b,w,T,x,B,E,k,_;const{banner:O,closeIcon:A=(i=o.closeIcon)===null||i===void 0?void 0:i.call(o)}=e;let{closable:H,showIcon:I}=e;const L=(f=e.closeText)!==null&&f!==void 0?f:(b=o.closeText)===null||b===void 0?void 0:b.call(o),N=(w=e.description)!==null&&w!==void 0?w:(T=o.description)===null||T===void 0?void 0:T.call(o),Y=(x=e.message)!==null&&x!==void 0?x:(B=o.message)===null||B===void 0?void 0:B.call(o),D=(E=e.icon)!==null&&E!==void 0?E:(k=o.icon)===null||k===void 0?void 0:k.call(o),Q=(_=o.action)===null||_===void 0?void 0:_.call(o);I=O&&I===void 0?!0:I;const ae=(N?rn:an)[s.value]||null;L&&(H=!0);const p=u.value,re=we(p,{[`${p}-${s.value}`]:!0,[`${p}-closing`]:y.value,[`${p}-with-description`]:!!N,[`${p}-no-icon`]:!I,[`${p}-banner`]:!!O,[`${p}-closable`]:H,[`${p}-rtl`]:m.value==="rtl",[g.value]:!0}),ce=H?h("button",{type:"button",onClick:$,class:`${p}-close-icon`,tabindex:0},[L?h("span",{class:`${p}-close-text`},[L]):A===void 0?h(Te,null,null):A]):null,de=D&&(Be(D)?Ee(D,{class:`${p}-icon`}):h("span",{class:`${p}-icon`},[D]))||h(ae,{class:`${p}-icon`},null),ue=_e(`${p}-motion`,{appear:!1,css:!0,onAfterLeave:l,onBeforeLeave:F=>{F.style.maxHeight=`${F.offsetHeight}px`},onLeave:F=>{F.style.maxHeight="0px"}});return a(v.value?null:h(Ae,ue,{default:()=>[Ke(h("div",ee(ee({role:"alert"},r),{},{style:[r.style,d.value],class:[r.class,re],"data-show":!y.value,ref:C}),[I?de:null,h("div",{class:`${p}-content`},[Y?h("div",{class:`${p}-message`},[Y]):null,N?h("div",{class:`${p}-description`},[N]):null]),Q?h("div",{class:`${p}-action`},[Q]):null,ce]),[[Me,!y.value]])]}))}}}),fn=me(un);function le(e,n){var o;((o=e==null?void 0:e.permissions)==null?void 0:o.length)>0&&e.permissions.forEach(t=>{t.checked=n})}function q(e,n){var o,t;le(e,n),(t=(o=e==null?void 0:e.children)==null?void 0:o.forEach)==null||t.call(o,r=>{q(r,n)})}function pn(e){Pe(e,n=>{if(gn(n),n.children&&n.children.length>0){const o=n.children.filter(c=>c.permissionType===2&&n.permissionType!==0),t=en(n.children,o);n.children=t;const r=o.map(c=>({id:c.id,label:c.permissionName,checked:!1}));n.permissions=r}})}function gn(e){var n,o,t,r;e.permissionType===1&&((o=(n=e.children)==null?void 0:n.forEach)==null||o.call(n,c=>{if([0,1].includes(c.permissionType)){const u=`错误用法: [${e.permissionName} - 菜单]下不能放 目录/菜单 -> [${c.permissionName}]`;console.warn(u),ne.warning({message:"提示",description:u,duration:0})}})),e.permissionType===2&&((r=(t=e.children)==null?void 0:t.forEach)==null||r.call(t,c=>{if([0,1,2].includes(c.permissionType)){const u=`错误用法: [${e.permissionName} - 按钮]下不能放置'目录/菜单/按钮' -> [${c.permissionName}]`;console.warn(u),ne.warning({message:"提示",description:u,duration:0})}}))}const hn={class:"flex h-full flex-col",id:"menu-select-table"},mn={class:"text-primary mx-1 font-semibold"},yn={class:"flex flex-wrap gap-x-3 gap-y-1"},bn=ie({name:"MenuSelectTable",inheritAttrs:!1,__name:"menu-select-table",props:Re({checkedKeys:{default:()=>[]},defaultExpandAll:{type:Boolean,default:!0},hasPermissionType2:{type:Boolean,default:!0},menus:{}},{association:{type:Boolean,default:!0},associationModifiers:{}}),emits:["update:association"],setup(e,{expose:n}){const o=e,t=Ge(e,"association"),r={checkboxConfig:{labelField:"permissionName",checkStrictly:!t.value},size:"small",columns:J,height:"auto",keepSource:!0,pagerConfig:{enabled:!1},proxyConfig:{enabled:!1},toolbarConfig:{refresh:!1,custom:!1,zoom:!0},rowConfig:{isHover:!1,isCurrent:!1,keyField:"id"},scrollY:{enabled:!0,gt:0},treeConfig:{parentField:"parentId",rowField:"id",transform:!1},showOverflow:!1},c=je(0);function u(){c.value=$().length}const[m,a]=ze({gridOptions:r,gridEvents:{checkboxChange:l=>{const s=l.checked,d=l.row;t.value?q(d,s):le(d,s),u()},checkboxAll:l=>{l.$grid.getData().forEach(d=>{q(d,l.checked)}),u()}}});function g(l,s,d){l.forEach(i=>{s.includes(i.id)&&a.grid.setCheckboxRow(i,!0),i.permissions&&i.permissions.length>0&&i.permissions.forEach(f=>{s.includes(f.id)&&(f.checked=!0,d&&v(i))}),i.children&&i.children.length>0&&g(i.children,s,d)})}Ve(()=>{R(()=>o.menus,l=>Z(null,null,function*(){const s=Xe(l);pn(s),yield a.grid.loadData(s),o.defaultExpandAll&&(yield qe(),y(!0))})),R(t,l=>{a.setGridOptions({checkboxConfig:{checkStrictly:!l}})}),R(()=>o.checkedKeys,l=>{const s=j([...l]),d=a.grid.getData();g(d,s,t.value),u()}),R(()=>o.hasPermissionType2,l=>{a.setGridOptions({columns:l?J:J.filter(s=>s.field!=="permissions")})},{immediate:!0})});function y(l){var s;(s=a.grid)==null||s.setAllTreeExpand(l)}function v(l){if(t.value){const s=l.permissions.filter(d=>d.checked===!0);s.length>0&&a.grid.setCheckboxRow(l,!0),s.length===0&&a.grid.setCheckboxRow(l,!1)}u()}function C(l,s){const d=[];return l.forEach(i=>{if(i.children&&i.children.length>0){const f=C(i.children,s);d.push(...f)}else if(s&&d.push(i.id),i.permissions&&i.permissions.length>0){const f=i.permissions.filter(b=>b.checked===!0).map(b=>b.id);d.push(...f)}}),j(d)}function $(){var b,w,T,x,B,E,k,_,O;if(t.value){const A=(T=(w=(b=a==null?void 0:a.grid)==null?void 0:b.getCheckboxRecords)==null?void 0:w.call(b,!0))!=null?T:[],H=C(A,!0),I=Le(o.menus,H);return j([...I,...H])}const l=(E=(B=(x=a==null?void 0:a.grid)==null?void 0:x.getCheckboxRecords)==null?void 0:B.call(x,!0))!=null?E:[],s=(O=(_=(k=a==null?void 0:a.grid)==null?void 0:k.getData)==null?void 0:_.call(k))!=null?O:[],d=l.map(A=>A.id),i=C(s,!1);return j([...d,...i])}return n({getCheckedKeys:$}),(l,s)=>(U(),se("div",hn,[h(z(m),null,{"toolbar-actions":S(()=>[h(z(fn),{class:"mr-2",type:"info"},{message:S(()=>[X("div",null,[s[2]||(s[2]=P(" 已选中 ",-1)),X("span",mn,G(c.value),1),s[3]||(s[3]=P(" 个节点 ",-1))])]),_:1})]),"toolbar-tools":S(()=>[h(z(De),null,{default:S(()=>[h(z(oe),{onClick:s[0]||(s[0]=d=>y(!1))},{default:S(()=>[P(G(l.$t("pages.common.collapse")),1)]),_:1}),h(z(oe),{onClick:s[1]||(s[1]=d=>y(!0))},{default:S(()=>[P(G(l.$t("pages.common.expand")),1)]),_:1})]),_:1})]),permissions:S(({row:d})=>[X("div",yn,[(U(!0),se(We,null,Je(d.permissions,i=>(U(),Ue(z(Ne),{key:i.id,checked:i.checked,"onUpdate:checked":f=>i.checked=f,onChange:()=>v(d)},{default:S(()=>[P(G(i.label),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])]),_:1})]))}}),wn=Oe(bn,[["__scopeId","data-v-76e91b49"]]);export{wn as M};
