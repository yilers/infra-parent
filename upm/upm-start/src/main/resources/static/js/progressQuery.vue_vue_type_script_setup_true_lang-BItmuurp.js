var _=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var J=(t,n,e)=>n in t?_(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,C=(t,n)=>{for(var e in n||(n={}))ae.call(n,e)&&J(t,e,n[e]);if(Q)for(var e of Q(n))se.call(n,e)&&J(t,e,n[e]);return t},V=(t,n)=>ee(t,te(n));var D=(t,n,e)=>new Promise((g,u)=>{var b=l=>{try{y(e.next(l))}catch(m){u(m)}},w=l=>{try{y(e.throw(l))}catch(m){u(m)}},y=l=>l.done?g(l.value):Promise.resolve(l.value).then(b,w);y((e=e.apply(t,n)).next())});import{W as ne}from"./index-C4NAiFfA.js";import{bu as le,dw as oe,dJ as re,a7 as ie,dK as ue}from"./bootstrap-DjYyHEgg.js";import{f as de,h as ce,i as me}from"./index-CwQ9Bea5.js";import{h as fe}from"./pageTableConfig-CJVVeSTk.js";import{b as L,d as pe}from"./index-C17F3t2v.js";import{C as ye,a as F}from"./index-DQysn_XC.js";import{m as H,de as W,b9 as M,v as ge,w as be,dd as xe,aa as v,a as Ce,ad as p,b2 as r,bc as q,ae as k,ac as $,aT as N,aR as O,bp as j,aQ as P,ab as h,bJ as c,j as f,u as o,ai as A,I,da as ve}from"../jse/index-index-rmdNY63r.js";import{u as ke}from"./use-drawer-CB92zaEG.js";const we=H({__name:"count-to",props:{startVal:{default:0},endVal:{},disabled:{type:Boolean},delay:{default:0},duration:{default:2e3},decimals:{default:0},decimal:{default:"."},separator:{default:","},prefix:{},suffix:{},transition:{type:[Array,Function],default:()=>W.easeOutExpo},mainClass:{},decimalClass:{},prefixClass:{},suffixClass:{},mainStyle:{type:[Boolean,null,String,Object,Array]},decimalStyle:{type:[Boolean,null,String,Object,Array]},prefixStyle:{type:[Boolean,null,String,Object,Array]},suffixStyle:{type:[Boolean,null,String,Object,Array]}},emits:["started","finished"],setup(t,{emit:n}){const e=t,g=n,u=M(e.startVal);ge(()=>{u.value=e.endVal}),be(()=>e.endVal,l=>{u.value=l});const b=xe(u,{delay:v(()=>e.delay),duration:v(()=>e.duration),disabled:v(()=>e.disabled),transition:v(()=>Ce(e.transition)?W[e.transition]:e.transition),onStarted(){g("started")},onFinished(){g("finished")}}),w=v(()=>{var m;return(m=b.value.toFixed(e.decimals).split(".")[0])==null?void 0:m.replaceAll(/\B(?=(\d{3})+(?!\d))/g,e.separator)}),y=v(()=>e.decimal+b.value.toFixed(e.decimals).split(".")[1]);return(l,m)=>(r(),p("div",P({class:"count-to"},l.$attrs),[q(l.$slots,"prefix",{},()=>[t.prefix?(r(),p("div",{key:0,class:O(["count-to-prefix",t.prefixClass]),style:N(t.prefixStyle)},j(t.prefix),7)):$("",!0)],!0),k("div",{class:O(["count-to-main",t.mainClass]),style:N(t.mainStyle)},[k("span",null,j(w.value),1),t.decimals>0?(r(),p("span",{key:0,class:O(["count-to-main-decimal",t.decimalClass]),style:N(t.decimalStyle)},j(y.value),7)):$("",!0)],6),q(l.$slots,"suffix",{},()=>[t.suffix?(r(),p("div",{key:0,class:O(["count-to-suffix",t.suffixClass]),style:N(t.suffixStyle)},j(t.suffix),7)):$("",!0)],!0)],16))}}),E=le(we,[["__scopeId","data-v-47b199b8"]]),Ne=H({__name:"progressQuery",setup(t,{expose:n}){const e=M({kpiAmount:null,doneAmount:null,dateProgress:"-",kpiDoneRate:"-"}),[g,u]=ke({title:"KPI进度查询",footer:!1,appendToMain:!0,destroyOnClose:!0,onOpenChange(s){return D(this,null,function*(){if(s){const a={pageCode:oe.KpiManage},i=yield fe(a),S=b(i),d=L.columns,x=S.map(K=>{const Y=d.find(Z=>Z.field===K.field);return V(C({},Y),{title:K.title})});R.setGridOptions({columns:x})}else w()})}});function b(s){if(s.length===0)return[];const a=d=>({field:d.columnKey,title:d.columnName,width:170,visible:!0,sortNumber:d.sortNumber}),i=[...s].sort((d,x)=>d.sortNumber-x.sortNumber),S=[];return i.forEach(d=>{S.push(a(d))}),S}const w=()=>{e.value={kpiAmount:null,doneAmount:null,dateProgress:"-",kpiDoneRate:"-"}},y=V(C({},pe),{collapsed:!0}),l=V(C({},L),{toolbarConfig:{},layouts:["Form","Top","Toolbar","Table","Pager"],stripe:!0,border:!0,rowConfig:{isHover:!0},columnConfig:{resizable:!1},showOverflow:!1,exportConfig:{},height:"auto",keepSource:!0,pagerConfig:{enabled:!1},proxyConfig:{ajax:{query:(S,d)=>D(null,[S,d],function*({page:{currentPage:s,pageSize:a}},i){const x=V(C({currentPage:s,pageSize:a},i),{masterTableId:u.getData().record.id});return e.value=yield de(x),{records:yield ce(x)}})}}}),m={},[U,R]=re({gridEvents:m,formOptions:y,gridOptions:l}),T=M(!1),X=()=>D(null,null,function*(){if(T.value){ue.info("有文件正在下载中，请稍后再试");return}try{T.value=!0;const s=R.formApi.getLatestSubmissionValues(),a=yield me(C({masterTableId:u.getData().record.id},s)),i=new Blob([a.data],{type:a.headers["content-type"]}),d=`${`合同${u.getData().record.code}`}.xlsx`;ve({fileName:d,source:i})}finally{T.value=!1}}),B=(s,a="")=>{let i;return a?i=Number.parseFloat(s.toString().replace("%","")):i=typeof s=="number"?s:Number.parseFloat(s.toString()),{delay:400,duration:1e3,decimals:String(i).includes(".")?2:0,suffixStyle:a?{display:"inline"}:{},suffix:a,startVal:0,endVal:i,separator:"",transition:"easeOutQuart"}},z=s=>typeof s=="number",G=s=>typeof s=="string"&&s.includes("%");return n(u),(s,a)=>(r(),h(o(g),{class:"w-full"},{default:c(()=>[f(o(U),null,{top:c(()=>[f(o(ye),{title:"年度任务概览"},{default:c(()=>[f(o(F),{style:{width:"25%","text-align":"center"}},{default:c(()=>[a[0]||(a[0]=k("div",null,"年度KPI金额",-1)),z(e.value.kpiAmount)?(r(),h(o(E),P({key:0,class:"justify-center text-2xl"},B(e.value.kpiAmount)),null,16)):(r(),p(I,{key:1},[A("--")],64))]),_:1}),f(o(F),{style:{width:"25%","text-align":"center"}},{default:c(()=>[a[1]||(a[1]=k("div",null,"截止当前完成",-1)),z(e.value.doneAmount)?(r(),h(o(E),P({key:0,class:"justify-center text-2xl"},B(e.value.doneAmount)),null,16)):(r(),p(I,{key:1},[A("--")],64))]),_:1}),f(o(F),{style:{width:"25%","text-align":"center"}},{default:c(()=>[a[2]||(a[2]=k("div",null,"时间进度",-1)),G(e.value.dateProgress)?(r(),h(o(E),P({key:0,class:"justify-center text-2xl"},B(e.value.dateProgress,"%")),null,16)):(r(),p(I,{key:1},[A("--")],64))]),_:1}),f(o(F),{style:{width:"25%","text-align":"center"}},{default:c(()=>[a[3]||(a[3]=k("div",null,"KPI完成度",-1)),G(e.value.kpiDoneRate)?(r(),h(o(E),P({key:0,class:"justify-center text-2xl"},B(e.value.kpiDoneRate,"%")),null,16)):(r(),p(I,{key:1},[A("--")],64))]),_:1})]),_:1})]),"toolbar-tools":c(()=>[f(o(ie),{loading:T.value,class:"mr-2",type:"primary",onClick:X},{icon:c(()=>[f(o(ne),{class:"mr-1 inline-block size-6"})]),default:c(()=>[a[4]||(a[4]=A(" 导出报表 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{Ne as _};
