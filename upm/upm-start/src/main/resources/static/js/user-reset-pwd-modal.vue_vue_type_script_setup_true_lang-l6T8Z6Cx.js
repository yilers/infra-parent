var c=(f,d,o)=>new Promise((u,s)=>{var m=a=>{try{e(o.next(a))}catch(n){s(n)}},t=a=>{try{e(o.throw(a))}catch(n){s(n)}},e=a=>a.done?u(a.value):Promise.resolve(a.value).then(m,t);e((o=o.apply(f,d)).next())});import{bj as I,et as _,bD as C}from"./bootstrap-DjYyHEgg.js";import{h as k}from"./index-ZCUElbZQ.js";import{m as A,b9 as L,ab as N,b2 as V,bJ as x,j as B,u as w}from"../jse/index-index-rmdNY63r.js";import{m as D}from"./crypto-DK7XV_U1.js";const M=A({__name:"user-reset-pwd-modal",emits:["reload"],setup(f,{emit:d}){const o=d,[u,s]=I({onClosed:v,onConfirm:n,onOpenChange:a,destroyOnClose:!0}),[m,t]=_({schema:[{component:"Input",dependencies:{show:()=>!1,triggerFields:[""]},fieldName:"id",label:"用户ID",rules:"required",disabled:!0},{component:"Input",fieldName:"account",label:"用户账号",rules:"required",disabled:!0},{component:"Input",fieldName:"nickname",label:"用户昵称",rules:"required",disabled:!0},{component:"InputPassword",componentProps:{placeholder:"请输入新的密码, 密码长度为5 - 20"},fieldName:"password",label:"新的密码",rules:C().min(5,{message:"密码长度为5 - 20"}).max(20,{message:"密码长度为5 - 20"})}],showDefaultActions:!1,commonConfig:{labelWidth:80}}),e=L(null);function a(r){return c(this,null,function*(){if(!r)return null;const l=s.getData();l.password="",e.value=l,e.value.roleIdList=Array.isArray(e.value.roleList)?e.value.roleList.map(i=>i.id):[],yield t.setValues(e.value)})}function n(){return c(this,null,function*(){var r,l,i,b,h;s.lock(!0);try{const{valid:p}=yield t.validate();if(!p)return;const g=yield t.getValues(),y={id:(r=e.value)==null?void 0:r.id,password:D(g.password),account:(l=e.value)==null?void 0:l.account,nickname:(i=e.value)==null?void 0:i.nickname,deptId:(b=e.value)==null?void 0:b.deptId,roleIdList:(h=e.value)==null?void 0:h.roleIdList};yield k(y),o("reload"),s.close()}catch(p){console.error(p)}finally{s.lock(!1)}})}function v(){return c(this,null,function*(){s.close(),yield t.resetForm(),e.value=null})}return(r,l)=>(V(),N(w(u),{"close-on-click-modal":!1,"fullscreen-button":!1,title:"重置密码"},{default:x(()=>[B(w(m))]),_:1}))}});export{M as _};
