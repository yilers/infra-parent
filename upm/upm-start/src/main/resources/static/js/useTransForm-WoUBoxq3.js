var q=Object.defineProperty,D=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var F=(N,d,h)=>d in N?q(N,d,{enumerable:!0,configurable:!0,writable:!0,value:h}):N[d]=h,w=(N,d)=>{for(var h in d||(d={}))G.call(d,h)&&F(N,h,d[h]);if(R)for(var h of R(d))U.call(d,h)&&F(N,h,d[h]);return N},C=(N,d)=>D(N,$(d));import{f as M}from"./business-Uwvf-GkQ.js";function H(){function N(o=[]){if(!(o!=null&&o.length))return[];const s=t=>({field:t.columnId,title:t.columnName,width:170,visible:t.frontShow===1,sortNumber:t.sortNumber}),i=[...o].sort((t,e)=>(t.sortNumber||0)-(e.sortNumber||0)),f=new Map,a=[];for(const t of i){const e=s(t);if(!t.categoryName){a.push(e);continue}let n=f.get(t.categoryName);n||(n={title:t.categoryName,children:[]},f.set(t.categoryName,n),a.push(n)),n.children&&n.children.push(e)}return a}function d(o=[],s=[],i=!0){if(!(o!=null&&o.length)||!(s!=null&&s.length))return[];const f={};for(const e of o)f[e.rowCode]={name:e.rowName,sortNumber:e.sortNumber||0,frontShow:e.frontShow===1,rowCode:e.rowCode,valueType:e.valueType};const a=new Set(["createTime","updateTime"]),t=[];for(const e of s){const n=i?M(e.time,e.type):e.time,c=C(w({},e),{formattedTime:n||""}),u=Object.entries(e.dataMap).filter(([r])=>{var m;return(m=f[r])==null?void 0:m.frontShow}).sort(([r],[m])=>{var p,l;return(((p=f[r])==null?void 0:p.sortNumber)||0)-(((l=f[m])==null?void 0:l.sortNumber)||0)});for(const[r,m]of u){const p=f[r];if(!(p!=null&&p.name))continue;const l=C(w({},c),{specs:p.name,rowCode:r});for(const y of m)for(const[g,T]of Object.entries(y))a.has(g)||(l[g]=T);t.push(l)}}return t}function h({row:o,_rowIndex:s,column:i,visibleData:f}){const a=["formattedTime"],t=o[i.property];if(t&&a.includes(i.property)){const e=f[s-1];let n=f[s+1];if(e&&e[i.property]===t)return{rowspan:0,colspan:0};{let c=1;for(;n&&n[i.property]===t;)n=f[++c+s];if(c>1)return{rowspan:c,colspan:1}}}}const v=({row:o,items:s,seq:i,rowIndex:f,$rowIndex:a,_rowIndex:t,column:e,visibleData:n,data:c})=>{const u="formattedTime",r=["formattedTime"],m=(p,l,y,g,T)=>{let b=1;for(;l&&l[T]===p[T];)l=g[++b+y];return b>1?{rowspan:b,colspan:1}:null};if(["action","customRemark","difference","status"].includes(e.property)){f>0?o.seq=o[u]===s[f-1][u]?s[f-1].seq:s[f-1].seq+1:f===0&&(o.seq=i);const p=c[a-1];if(p&&p[u]===o[u])return{rowspan:0,colspan:0};const l=c[a+1];return m(o,l,a,c,u)}else if(r.includes(e.property)){const p=o[e.property];if(p){const l=n[t-1];if(l&&l[e.property]===p)return{rowspan:0,colspan:0};const y=n[t+1];return m(o,y,t,n,e.property)}}return null},j=({row:o,_rowIndex:s,column:i,visibleData:f})=>{if(!["formattedTime","productType","action","difference","status"].includes(i.property))return null;const t=["action","difference","status"].includes(i.property);if(!t){const u=o[i.property];if(!u||u==="--")return null}const e=f[s-1];if(e)if(t){if(e.formattedTime===o.formattedTime)return{rowspan:0,colspan:0}}else{const u=o[i.property];if(e[i.property]===u)if(i.property==="productType"){if(e.formattedTime===o.formattedTime)return{rowspan:0,colspan:0}}else return{rowspan:0,colspan:0}}let n=1,c=f[s+1];for(;c;){if(t){if(c.formattedTime!==o.formattedTime)break}else{const u=o[i.property];if(c[i.property]!==u||i.property==="productType"&&c.formattedTime!==o.formattedTime)break}c=f[++n+s]}return n>1?{rowspan:n,colspan:1}:null};function k(o=[],s=[]){if(!(o!=null&&o.length)||!(s!=null&&s.length))return[];const i=s.filter(e=>e.frontShow===1).sort((e,n)=>(e.sortNumber||0)-(n.sortNumber||0));if(i.length===0)return[];const f=[...o].filter(e=>e.frontShow===1).sort((e,n)=>(e.sortNumber||0)-(n.sortNumber||0)),a=new Map,t=[];for(const e of f){const n=i.map(r=>({title:r.rowName,field:`${e.columnId}_${r.rowCode}`,width:120})),c={title:e.columnName,sortNumber:e.sortNumber,children:n},u=e.categoryName||"";if(u){let r=a.get(u);r||(r={title:u,children:[]},a.set(u,r),t.push(r)),r.children&&r.children.push(c)}else t.push(c)}for(const e of t)e.children&&e.children.length>1&&e.children.sort((n,c)=>(n.sortNumber||0)-(c.sortNumber||0));return t}function O(o=[],s=[],i=!0){if(!(o!=null&&o.length)||!(s!=null&&s.length))return[];const f={};for(const t of o)f[t.rowCode]={name:t.rowName,sortNumber:t.sortNumber||0,frontShow:t.frontShow===1,rowCode:t.rowCode,valueType:t.valueType};const a=new Set(["createTime","specs","updateTime"]);return s.map(t=>{var u;const e=i?M(t.time,t.type):t.time,n=C(w({},t),{formattedTime:e||""}),c=Object.entries(t.dataMap).filter(([r])=>{var m;return(m=f[r])==null?void 0:m.frontShow}).sort(([r],[m])=>{var p,l;return(((p=f[r])==null?void 0:p.sortNumber)||0)-(((l=f[m])==null?void 0:l.sortNumber)||0)});for(const[r,m]of c)if((u=f[r])!=null&&u.name)for(const p of m)for(const[l,y]of Object.entries(p))a.has(l)||(n[`${l}_${r}`]=y);return n})}function V(o=[],s=[],i){if(!(o!=null&&o.length)||!(s!=null&&s.length))return[];const f=s.filter(n=>n.frontShow===1).sort((n,c)=>(n.sortNumber||0)-(c.sortNumber||0));if(f.length===0)return i||[];const t=i||[{title:"卡种类型",field:"productType",width:150},{title:"卡种名称",field:"productDetail",width:300}],e=f.map(n=>({title:n.rowName,field:n.rowCode,width:120}));return[...t,...e]}function A(o=[],s=[],i=[],f=!0,a){if(!(o!=null&&o.length)||!(s!=null&&s.length)||!(i!=null&&i.length))return[];const e=a||{productType:"categoryName",productDetail:"columnName"},n={};for(const r of s)n[r.rowCode]={name:r.rowName,sortNumber:r.sortNumber||0,frontShow:r.frontShow===1,rowCode:r.rowCode,valueType:r.valueType};const c=o.filter(r=>r.frontShow===1).sort((r,m)=>(r.sortNumber||0)-(m.sortNumber||0));if(c.length===0)return[];const u=[];for(const r of i){const m=f?M(r.time,r.type):r.time;for(const p of c){const l=C(w({},r),{formattedTime:m||""});for(const[y,g]of Object.entries(e)){const T=p[g];l[y]=T!==void 0&&T!==""?T:"--"}for(const[y,g]of Object.entries(r.dataMap)){const T=n[y];if(T!=null&&T.frontShow&&Array.isArray(g))for(const b of g){const S=b[p.columnId];if(S!==void 0){l[y]=S;break}}}u.push(l)}}return u}return{transformColumns:N,transformRowData:d,rowspanMethod:h,rowspanCustomMethod:v,rowspanTransposedMethod:j,transformColumnsToColumnMode:k,transformRowDataToColumnMode:O,transformColumnsToTransposed:V,transformRowDataToTransposed:A}}export{H as u};
