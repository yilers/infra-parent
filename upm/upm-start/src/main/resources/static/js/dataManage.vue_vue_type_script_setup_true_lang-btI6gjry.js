var F=Object.defineProperty,S=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var Y=(n,a,e)=>a in n?F(n,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[a]=e,y=(n,a)=>{for(var e in a||(a={}))L.call(a,e)&&Y(n,e,a[e]);if(A)for(var e of A(a))T.call(a,e)&&Y(n,e,a[e]);return n},N=(n,a)=>S(n,V(a));var x=(n,a,e)=>new Promise((d,c)=>{var g=i=>{try{l(e.next(i))}catch(m){c(m)}},f=i=>{try{l(e.throw(i))}catch(m){c(m)}},l=i=>i.done?d(i.value):Promise.resolve(i.value).then(g,f);l((e=e.apply(n,a)).next())});import{m as B,b9 as P,ab as $,b2 as p,u as k,bJ as C,j as D,ad as b,ae as w,bp as I,ci as K}from"../jse/index-index-rmdNY63r.js";import{dJ as O,dK as M}from"./bootstrap-DjYyHEgg.js";import{b as j,c as R}from"./index-CwQ9Bea5.js";import{_ as z}from"./checkedKpiForm.vue_vue_type_script_setup_true_lang-CUczDAno.js";import{g as E}from"./index-C17F3t2v.js";import{_ as G}from"./table-action.vue_vue_type_style_index_0_lang-BluPqhNI.js";import J from"./index-EkdSFYQU.js";import{u as U}from"./use-drawer-CB92zaEG.js";function W(n,a={}){const{maxLength:e=17,maxDecimalPlaces:d=4,allowLeadingDot:c=!1,allowNegative:g=!1,min:f,max:l,errorMessages:i={}}=a,m={leadingDot:"小数点前不能没有整数",maxLength:`输入长度不能超过${e}位`,invalidFormat:"请输入正确的数字格式",maxDecimalPlaces:`小数点后最多支持${d}位`,negative:"不允许输入负数",min:`数值不能小于${f}`,max:`数值不能大于${l}`},o=y(y({},m),i),u=String(n).trim();if(!u||u==="-")return{valid:!1,message:o.invalidFormat};const h=u.startsWith("-");if(h&&!g)return{valid:!1,message:o.negative};const _=h?u.slice(1):u;if(_.startsWith(".")&&!c)return{valid:!1,message:o.leadingDot};if(_.length>e)return{valid:!1,message:o.maxLength};if(!(c?/^(\d+(?:\.\d*)?|\.?\d+)$/:/^(\d+(?:\.\d*)?)$/).test(_))return{valid:!1,message:o.invalidFormat};if(_.includes(".")){const t=_.split(".");if(t.length!==2)return{valid:!1,message:o.invalidFormat};const v=t[1];if(!v||v.length>d||!/^\d+$/.test(v))return{valid:!1,message:o.maxDecimalPlaces}}const r=Number(u);return Number.isNaN(r)?{valid:!1,message:o.invalidFormat}:f!==void 0&&r<f?{valid:!1,message:o.min}:l!==void 0&&r>l?{valid:!1,message:o.max}:{valid:!0,message:""}}function q(n){return W(n,{maxLength:17,maxDecimalPlaces:4,allowLeadingDot:!1,allowNegative:!0})}const H={key:0},Q={key:1},X={key:1},Z={key:0},ee={key:1,style:{display:"flex","align-items":"center","justify-content":"center"}},ae={style:{"margin-right":"12px"}},ue=B({__name:"dataManage",setup(n,{expose:a}){const e=P({}),d=P(),[c,g]=U({title:"KPI数据管理",footer:!1,appendToMain:!0,destroyOnClose:!0,onOpenChange(s){return x(this,null,function*(){e.value=s?g.getData().record:{}})}}),f=N(y({},E),{toolbarConfig:{},layouts:["Form","Top","Toolbar","Table","Pager"],stripe:!0,border:!0,rowConfig:{isHover:!0},columnConfig:{resizable:!1},showOverflow:!1,exportConfig:{},height:"auto",keepSource:!0,pagerConfig:{enabled:!1},proxyConfig:{ajax:{query:()=>x(null,null,function*(){const s={type:"month",masterTableId:e.value.id};return{records:yield j(s)}})}}}),l={},[i,m]=O({gridEvents:l,gridOptions:f}),o=s=>{if(s.doneAmount===null){M.warning("请先录入KPI");return}d.value.setData({record:s,gridApi:m}),d.value.open()},u=s=>x(null,null,function*(){if(!s.doneAmountCopy)return;const r=q(s.doneAmountCopy);if(!r.valid){M.warning(r.message);return}const t={id:s.id,doneAmount:s.doneAmountCopy,masterTableId:s.masterTableId};yield R([y({},t)]),M.success("保存成功"),m.reload()}),h=s=>{const r=K(s.timeStartStr,"YYYYMM").format("YYYYMM"),t=K().format("YYYYMM");return r>=t};return a(g),(s,r)=>(p(),$(k(c),{class:"w-full"},{default:C(()=>[D(k(i),null,{doneAmount:C(({row:t})=>[h(t)?(p(),b("div",H,"--")):(p(),b("div",Q,[t.doneAmount===null?(p(),$(k(J),{key:0,value:t.doneAmountCopy,"onUpdate:value":v=>t.doneAmountCopy=v,type:"number",class:"w-full",placeholder:"请录入KPI",onBlur:v=>u(t)},null,8,["value","onUpdate:value","onBlur"])):(p(),b("div",X,I(t.doneAmount),1))]))]),proofreadAmount:C(({row:t})=>[h(t)?(p(),b("div",Z,"--")):(p(),b("div",ee,[w("div",ae,I(t.proofreadAmount),1),D(k(G),{actions:[{label:"",icon:"ant-design:edit-outlined",type:"link",size:"small",auth:["kpi:kpiManage:dataManageChecked"],onClick:o.bind(null,t)}]},null,8,["actions"])]))]),_:1}),D(z,{ref_key:"checkedKpiFormRef",ref:d},null,512)]),_:1}))}});export{ue as _};
