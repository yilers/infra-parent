var J=Object.defineProperty,L=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var M=(n,t,a)=>t in n?J(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,f=(n,t)=>{for(var a in t||(t={}))W.call(t,a)&&M(n,a,t[a]);if(z)for(var a of z(t))I.call(t,a)&&M(n,a,t[a]);return n},b=(n,t)=>L(n,G(t));var D=(n,t,a)=>new Promise((S,d)=>{var C=m=>{try{i(a.next(m))}catch(l){d(l)}},g=m=>{try{i(a.throw(m))}catch(l){d(l)}},i=m=>m.done?S(m.value):Promise.resolve(m.value).then(C,g);i((a=a.apply(n,t)).next())});import{dz as K,dJ as Q,bj as k,a7 as U}from"./bootstrap-DjYyHEgg.js";import{a as X}from"./index-BEZtt-y-.js";import{u as Z}from"./useShopCheck-DKIjDUfz.js";import{f as ee}from"./business-Uwvf-GkQ.js";import{c as te}from"./contast-C3bEivmW.js";import{_ as ae}from"./base-modal.vue_vue_type_script_setup_true_lang-BMdF0Qny.js";import{q as se,c as oe,_ as re}from"./summary-record-modals.vue_vue_type_script_setup_true_lang-BGSl7ua4.js";import ne from"./error-modal-WgugRHFS.js";import{_ as me}from"./form.vue_vue_type_script_setup_true_lang-ufnoB7jb.js";import{_ as R}from"./table-action.vue_vue_type_style_index_0_lang-BluPqhNI.js";import{B as ie}from"./index-ClU3eF4t.js";import{_ as le}from"./page.vue_vue_type_script_setup_true_lang-CmAABu9Z.js";import{_ as ue}from"./fallback.vue_vue_type_script_setup_true_lang-CaaeY5iC.js";import{v as ce}from"./AlertBuilder-BtGpEXE7.js";import{m as pe,aa as de,ab as _,b2 as T,bJ as p,j as u,u as o,ae as ye,ac as fe,aS as ke,aw as Se,ai as Ce}from"../jse/index-index-rmdNY63r.js";import"./dateTime-Ce6Ez397.js";import"./useDownLoad-Cw45s4VH.js";import"./fileTransfer-p8-3apt7.js";import"./useDateRangePicker-DjB1zMnJ.js";import"./index-Bw6N7aDv.js";import"./shallowequal-W2RnI4nT.js";import"./index-CM6A-82x.js";import"./Dropdown-D1vLSWoc.js";import"./rotate-cw-Dzdn7gja.js";import"./circle-check-big-KiVgv6lu.js";const ge={class:"flex items-center justify-center gap-2"},Ge=pe({__name:"index",setup(n){const{checkShopSelected:t}=Z(),{hasAccessByCodes:a}=K(),S=de(()=>a(["tasks:summarizeTask:list"])),d={compact:!0,collapsed:!1,commonConfig:{labelWidth:80,componentProps:{allowClear:!0}},schema:se(),fieldMappingTime:[["summaryTime",["summaryStartTime","summaryEndTime"],"YYYY-MM-DD HH:mm:ss"],["reportTime",["reportStartTime","reportEndTime"],"YYYY-MM-DD HH:mm:ss"]],submitOnChange:!1,wrapperClass:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},C={columns:oe,height:"auto",showOverflow:!1,keepSource:!0,toolbarConfig:{custom:!0,export:!1,zoom:!0,search:!0},proxyConfig:{ajax:{query:(c,w)=>D(null,[c,w],function*({page:{currentPage:s,pageSize:r}},e){if(!t())return{result:{records:[],total:0}};const v=yield X(f({current:s,size:r},e)),F=v.records.map(h=>b(f({},h),{consumingTime:ee(h.time,h.dateType)}));return b(f({},v),{records:F})})}},id:"tasks-summarizeTask-index"},[g,i]=Q({formOptions:d,gridOptions:C,gridEvents:{}}),[m,l]=k({connectedComponent:ae,destroyOnClose:!0}),[$,y]=k({connectedComponent:me,destroyOnClose:!0}),[B,x]=k({connectedComponent:ne,destroyOnClose:!0}),[E,O]=k({connectedComponent:re,destroyOnClose:!0}),A=s=>{l.setData({type:1,record:s,options:{title:"审核",content:"审核完成后，数据锁定，不会再因源数据更改而变动，是否确认此操作？"}}),l.open()},Y=s=>{l.setData({type:2,record:s,options:{title:"反审核",content:"反审核后，数据将取消锁定，是否确认此操作？"}}),l.open()},q=()=>{t()&&(y.setData({status:1,options:{title:"汇总报表数据",content:""}}),y.open())},V=s=>{y.setData({status:2,record:s,options:{title:"重新汇总报表数据",content:"重新汇总报表数据，原数据将会被覆盖，是否确认此操作？"}}),y.open()},N=s=>{O.setData(s).open()},j=s=>{x.setData({result:s}),x.open()},H=s=>{s.status===428&&j(s)},P=s=>{var r;ce({title:"汇总失败-查看原因",content:((r=s.errorDetail)==null?void 0:r.replace(/,/g,`
`))||"",icon:"error",showCancel:!1,confirmText:"关闭"})};return(s,r)=>S.value?(T(),_(o(le),{key:0,"auto-content-height":""},{default:p(()=>[u(o(g),null,{"toolbar-actions":p(()=>[u(o(R),{actions:[{label:"汇总报表数据",type:"primary",auth:["tasks:summarizeTask:summaryReport"],icon:"ant-design:cloud-upload-outlined",onClick:q.bind(null)}]},null,8,["actions"])]),summaryStatus:p(({row:e})=>[ye("div",ge,[u(o(ie),ke(Se((()=>{const c=o(te).find(w=>w.value===e.summaryStatus);return{status:(c==null?void 0:c.status)||"default",text:(c==null?void 0:c.label)||"-"}})())),null,16),e.summaryStatus===3?(T(),_(o(U),{key:0,type:"link",size:"small",onClick:c=>P(e)},{default:p(()=>[...r[4]||(r[4]=[Ce(" 查看原因 ",-1)])]),_:1},8,["onClick"])):fe("",!0)])]),action:p(({row:e})=>[u(o(R),{actions:[{label:"重新汇总",icon:"ant-design:edit-outlined",type:"link",size:"small",auth:["tasks:summarizeTask:againSummary"],ifShow:()=>e.summaryStatus===3||e.reviewStatus===2,onClick:()=>V(e)},{label:"审核",icon:"ant-design:edit-outlined",type:"link",size:"small",auth:["tasks:summarizeTask:examine"],ifShow:()=>e.summaryStatus===2&&e.reviewStatus===2,onClick:()=>A(e)},{label:"反审核",icon:"ant-design:edit-outlined",type:"link",size:"small",ifShow:()=>e.summaryStatus===2&&e.reviewStatus===3,auth:["tasks:summarizeTask:examine"],onClick:()=>Y(e)},{label:"汇总记录",icon:"carbon:collapse-categories",type:"link",size:"small",auth:["tasks:summarizeTask:summaryRecord"],onClick:()=>N(e)}]},null,8,["actions"])]),_:1}),u(o($),{onOnSummarySubmit:H,onReload:r[0]||(r[0]=e=>o(i).query())}),u(o(B),{onReload:r[1]||(r[1]=e=>o(i).query())}),u(o(m),{onReload:r[2]||(r[2]=e=>o(i).query())}),u(o(E),{onReload:r[3]||(r[3]=e=>o(i).query())})]),_:1})):(T(),_(o(ue),{key:1,description:"抱歉，您没有权限访问此页面。",status:"403"}))}});export{Ge as default};
