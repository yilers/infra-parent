var F=Object.defineProperty,T=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var N=(a,t,e)=>t in a?F(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,D=(a,t)=>{for(var e in t||(t={}))L.call(t,e)&&N(a,e,t[e]);if(g)for(var e of g(t))V.call(t,e)&&N(a,e,t[e]);return a},v=(a,t)=>T(a,B(t));var c=(a,t,e)=>new Promise((s,d)=>{var m=r=>{try{p(e.next(r))}catch(i){d(i)}},n=r=>{try{p(e.throw(r))}catch(i){d(i)}},p=r=>r.done?s(r.value):Promise.resolve(r.value).then(m,n);p((e=e.apply(a,t)).next())});import{bv as C,bx as k,dK as q}from"./bootstrap-DjYyHEgg.js";import{c as R,d as $,b as j}from"./index-D5n-88Z9.js";import{g as E}from"./get-popup-container-BlodRF3J.js";import{s as G,l as J,b as K}from"./tree-DTIvVT2i.js";import{m as M,b9 as I,aa as O,b$ as U,ab as W,b2 as z,bJ as H,j as Q,u as _}from"../jse/index-index-rmdNY63r.js";import{u as X}from"./use-drawer-CB92zaEG.js";function Y(){return[{color:"error",label:"否",value:0},{color:"processing",label:"是",value:1}]}const ie=[{field:"deptName",title:"部门名称",treeNode:!0,align:"left",dragSort:!0},{field:"deptCode",title:"部门编码"},{field:"sortNumber",title:"排序"},{field:"usable",title:"是否启用",cellRender:{name:"CellTag",options:Y()}},{width:250,title:"操作",align:"center",slots:{default:"action"},fixed:"right"}],Z=()=>[{component:"Input",dependencies:{show:()=>!1,triggerFields:[""]},fieldName:"id"},{component:"TreeSelect",componentProps:{getPopupContainer:E},dependencies:{show:a=>a.parentId!=="0",triggerFields:["parentId"]},fieldName:"parentId",label:"上级部门",rules:"selectRequired"},{component:"Input",fieldName:"deptName",componentProps:{placeholder:"请输入部门名称",allowClear:!0},label:"部门名称",rules:"required"},{fieldName:"deptCode",label:"部门编码",component:"Input",componentProps:{placeholder:"请输入部门编码",allowClear:!0},formItemClass:"col-span-12",rules:"required",detailSpan:12},{fieldName:"deptDesc",label:"机构描述",component:"Textarea",componentProps:{placeholder:"请输入机构描述",rows:7}}],pe=M({__name:"dept-drawer",emits:["reload"],setup(a,{emit:t}){const e=t,s=I(),d=O(()=>{var o;return(o=s.value)!=null&&o.id?C("pages.common.edit"):C("pages.common.add")}),[m,n]=k({wrapperClass:"grid-cols-12",commonConfig:{componentProps:{class:"w-full"},formItemClass:"col-span-12",labelWidth:80},schema:Z(),showDefaultActions:!1}),[p,r]=X({onConfirm:S,onOpenChange(o){return c(this,null,function*(){if(o){const l=r.getData();l&&(s.value=l,n.setValues(s.value)),yield x()}})}}),i=I([]),P=()=>c(null,null,function*(){const o=yield j({});i.value=G(o,"sortNumber","id");const l=J(o,{id:"id",pid:"parentId"});return K(l,"deptName"," / "),l}),x=()=>c(null,null,function*(){const o=yield P();n.updateSchema([{componentProps:{fieldNames:{label:"deptName",value:"id"},showSearch:!0,treeData:o,treeDefaultExpandAll:!0,treeLine:{showLeafIcon:!1},treeNodeLabelProp:"fullName",treeNodeFilterProp:"deptName"},fieldName:"parentId"}])});function S(){return c(this,null,function*(){var o,l;try{const{valid:u}=yield n.validate();if(u){r.lock(!0);const w=U(yield n.getValues()),f=w.parentId||"0";let h=1;if(f!=="0"){const b=i.value.find(A=>A.id===f);h=(b==null?void 0:b.deptDeep)||1}const y=v(D({},w),{parentId:f,parentDeptDeep:h,version:((o=s.value)==null?void 0:o.version)||1,usable:1});yield((l=s.value)!=null&&l.id?R:$)(y),q.success("保存成功"),e("reload"),r.close()}}catch(u){console.error(u)}finally{r.lock(!1)}})}return(o,l)=>(z(),W(_(p),{title:d.value,class:"w-[600px]"},{default:H(()=>[Q(_(m))]),_:1},8,["title"]))}});export{pe as _,ie as c};
