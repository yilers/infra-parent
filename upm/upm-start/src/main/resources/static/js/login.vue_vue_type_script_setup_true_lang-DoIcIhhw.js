var ne=Object.defineProperty,oe=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var H=(e,n,a)=>n in e?ne(e,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[n]=a,Q=(e,n)=>{for(var a in n||(n={}))le.call(n,a)&&H(e,a,n[a]);if(Z)for(var a of Z(n))re.call(n,a)&&H(e,a,n[a]);return e},A=(e,n)=>oe(e,ie(n));var K=(e,n,a)=>new Promise((i,c)=>{var l=u=>{try{r(a.next(u))}catch(v){c(v)}},t=u=>{try{r(a.throw(u))}catch(v){c(v)}},r=u=>u.done?i(u.value):Promise.resolve(u.value).then(l,t);r((a=a.apply(e,n)).next())});import{aQ as ce,aW as ue,aX as fe,aY as de,aZ as f,a_ as z,a$ as me,b0 as ge,b1 as he,b2 as G,b3 as be,b4 as ye,aS as pe,b5 as ee,b6 as ve}from"./bootstrap-B0IOIL79.js";import{m as V,aa as W,ad as x,b2 as m,aT as j,bc as R,bC as B,b9 as U,aR as X,j as g,u as s,bJ as h,ab as I,ai as E,bp as w,aP as te,bz as we,b7 as ae,w as xe,bF as Se,cL as $e,ag as se,cc as Pe,ae as C,v as ke,ac as M,aN as Re}from"../jse/index-index-StHjciy-.js";import{T as Le}from"./auth-title-9h8Ycpuq.js";import{S as Te,a as Me,b as Ee,c as Ce}from"./index-Cm8lEwIC.js";import{m as Be}from"./crypto-BIPOTUv7.js";const Ve=V({__name:"spine-text",props:{animationDuration:{default:2},animationIterationCount:{default:"infinite"}},setup(e){const n=W(()=>({animation:`shine ${e.animationDuration}s linear ${e.animationIterationCount}`}));return(a,i)=>(m(),x("div",{style:j(n.value),class:"vben-spine-text !bg-clip-text text-transparent"},[R(a.$slots,"default")],4))}}),De=V({__name:"slider-captcha-action",props:{actionStyle:{},isPassing:{type:Boolean},toLeft:{type:Boolean}},setup(e,{expose:n}){const a=e,i=B("actionRef"),c=U("0"),l=W(()=>{const{actionStyle:r}=a;return A(Q({},r),{left:c.value})}),t=W(()=>Number.parseInt(c.value)>10&&!a.isPassing);return n({getEl:()=>i.value,getStyle:()=>{var r;return(r=i==null?void 0:i.value)==null?void 0:r.style},setLeft:r=>{c.value=r}}),(r,u)=>(m(),x("div",{ref_key:"actionRef",ref:i,class:X([{"transition-width !left-0 duration-300":e.toLeft,"rounded-md":t.value},"bg-background dark:bg-accent absolute left-0 top-0 flex h-full cursor-move items-center justify-center px-3.5 shadow-md"]),style:j(l.value),name:"captcha-action"},[g(s(ce),{"is-passing":e.isPassing,class:"text-foreground/60 size-4"},{default:h(()=>[R(r.$slots,"icon",{},()=>[e.isPassing?(m(),I(s(fe),{key:1})):(m(),I(s(ue),{key:0}))])]),_:3},8,["is-passing"])],6))}}),_e=V({__name:"slider-captcha-bar",props:{barStyle:{},toLeft:{type:Boolean}},setup(e,{expose:n}){const a=e,i=B("barRef"),c=U("0"),l=W(()=>{const{barStyle:t}=a;return A(Q({},t),{width:c.value})});return n({getEl:()=>i.value,setWidth:t=>{c.value=t}}),(t,r)=>(m(),x("div",{ref_key:"barRef",ref:i,class:X([e.toLeft&&"transition-width !w-0 duration-300","bg-success absolute h-full"]),style:j(l.value)},null,6))}}),Ie=V({__name:"slider-captcha-content",props:{contentStyle:{},isPassing:{type:Boolean},successText:{},text:{}},setup(e,{expose:n}){const a=e,i=B("contentRef"),c=W(()=>{const{contentStyle:l}=a;return Q({},l)});return n({getEl:()=>i.value}),(l,t)=>(m(),x("div",{ref_key:"contentRef",ref:i,class:X([{[l.$style.success]:e.isPassing},"absolute top-0 flex size-full select-none items-center justify-center text-xs"]),style:j(c.value)},[R(l.$slots,"text",{},()=>[g(s(Ve),{class:"flex h-full items-center"},{default:h(()=>[E(w(e.isPassing?e.successText:e.text),1)]),_:1})])],6))}}),We="_success_fwxn1_2",Fe={success:We},Ne={$style:Fe},je=de(Ie,[["__cssModules",Ne]]),Xe=V({__name:"index",props:te({class:{},actionStyle:{default:()=>({})},barStyle:{default:()=>({})},contentStyle:{default:()=>({})},wrapperStyle:{default:()=>({})},isSlot:{type:Boolean,default:!1},successText:{default:""},text:{default:""}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:te(["end","move","start","success"],["update:modelValue"]),setup(e,{expose:n,emit:a}){const i=e,c=a,l=we(e,"modelValue"),t=ae({endTime:0,isMoving:!1,isPassing:!1,moveDistance:0,startTime:0,toLeft:!1});n({resume:q});const r=B("wrapperRef"),u=B("barRef"),v=B("contentRef"),S=B("actionRef");xe(()=>t.isPassing,o=>{if(o){const{endTime:y,startTime:p}=t,$=(y-p)/1e3;c("success",{isPassing:o,time:$.toFixed(1)}),l.value=o}}),Se(()=>{t.isPassing=!!l.value});function F(o){return"pageX"in o?o.pageX:"touches"in o&&o.touches[0]?o.touches[0].pageX:0}function D(o){t.isPassing||S.value&&(c("start",o),t.moveDistance=F(o)-Number.parseInt(S.value.getStyle().left.replace("px","")||"0",10),t.startTime=Date.now(),t.isMoving=!0)}function b(o){var P,k,_;const y=(k=(P=r.value)==null?void 0:P.offsetWidth)!=null?k:220,p=(_=o==null?void 0:o.offsetWidth)!=null?_:40,$=y-p-6;return{actionWidth:p,offset:$,wrapperWidth:y}}function d(o){const{isMoving:y,moveDistance:p}=t;if(y){const $=s(S),P=s(u);if(!$||!P)return;const{actionWidth:k,offset:_,wrapperWidth:N}=b($.getEl()),T=F(o)-p;c("move",{event:o,moveDistance:p,moveX:T}),T>0&&T<=_?($.setLeft(`${T}px`),P.setWidth(`${T+k/2}px`)):T>_&&($.setLeft(`${N-k}px`),P.setWidth(`${N-k/2}px`),i.isSlot||O())}}function L(o){const{isMoving:y,isPassing:p,moveDistance:$}=t;if(y&&!p){c("end",o);const P=S.value,k=s(u);if(!P||!k)return;const _=F(o)-$,{actionWidth:N,offset:T,wrapperWidth:Y}=b(P.getEl());_<T?i.isSlot?setTimeout(()=>{if(l.value){const J=s(v);J&&(J.getEl().style.width=`${Number.parseInt(k.getEl().style.width)}px`)}else q()},0):q():(P.setLeft(`${Y-N}px`),k.setWidth(`${Y-N/2}px`),O()),t.isMoving=!1}}function O(){if(i.isSlot){q();return}t.endTime=Date.now(),t.isPassing=!0,t.isMoving=!1}function q(){t.isMoving=!1,t.isPassing=!1,t.moveDistance=0,t.toLeft=!1,t.startTime=0,t.endTime=0;const o=s(S),y=s(u),p=s(v);!o||!y||!p||(p.getEl().style.width="100%",t.toLeft=!0,$e(()=>{t.toLeft=!1,o.setLeft("0"),y.setWidth("0")},300))}return(o,y)=>(m(),x("div",{ref_key:"wrapperRef",ref:r,class:X(s(Pe)("border-border bg-background-deep relative flex h-10 w-full items-center overflow-hidden rounded-md border text-center",i.class)),style:j(e.wrapperStyle),onMouseleave:L,onMousemove:d,onMouseup:L,onTouchend:L,onTouchmove:d},[g(_e,{ref_key:"barRef",ref:u,"bar-style":e.barStyle,"to-left":t.toLeft},null,8,["bar-style","to-left"]),g(je,{ref_key:"contentRef",ref:v,"content-style":e.contentStyle,"is-passing":t.isPassing,"success-text":e.successText||s(f)("ui.captcha.sliderSuccessText"),text:e.text||s(f)("ui.captcha.sliderDefaultText")},se({_:2},[o.$slots.text?{name:"text",fn:h(()=>[R(o.$slots,"text",{isPassing:t.isPassing})]),key:"0"}:void 0]),1032,["content-style","is-passing","success-text","text"]),g(De,{ref_key:"actionRef",ref:S,"action-style":e.actionStyle,"is-passing":t.isPassing,"to-left":t.toLeft,onMousedown:D,onTouchstart:D},se({_:2},[o.$slots.actionIcon?{name:"icon",fn:h(()=>[R(o.$slots,"actionIcon",{isPassing:t.isPassing})]),key:"0"}:void 0]),1032,["action-style","is-passing","to-left"])],38))}}),qe={class:"w-full sm:mx-auto md:max-w-md"},Qe={class:"mt-4 flex items-center justify-between"},ze={class:"text-muted-foreground text-center text-xs uppercase"},Ae={class:"mt-4 flex flex-wrap justify-center"},Ke=V({name:"ThirdPartyLogin",__name:"third-party-login",setup(e){return(n,a)=>(m(),x("div",qe,[C("div",Qe,[a[0]||(a[0]=C("span",{class:"border-input w-[35%] border-b dark:border-gray-600"},null,-1)),C("span",ze,w(s(f)("authentication.thirdPartyLogin")),1),a[1]||(a[1]=C("span",{class:"border-input w-[35%] border-b dark:border-gray-600"},null,-1))]),C("div",Ae,[g(s(z),{class:"mb-3"},{default:h(()=>[g(s(Te))]),_:1}),g(s(z),{class:"mb-3"},{default:h(()=>[g(s(Me))]),_:1}),g(s(z),{class:"mb-3"},{default:h(()=>[g(s(Ee))]),_:1}),g(s(z),{class:"mb-3"},{default:h(()=>[g(s(Ce))]),_:1})])]))}}),Ge=["onKeydown"],Ue={class:"text-muted-foreground"},Oe={key:0,class:"mb-6 flex justify-between"},Ye={class:"flex-center"},Je={key:1,class:"mb-2 mt-4 flex items-center justify-between"},Ze={key:0,class:"mt-3 text-center text-sm"},He=V({name:"AuthenticationLogin",__name:"login",props:{formSchema:{default:()=>[]},codeLoginPath:{default:"/auth/code-login"},forgetPasswordPath:{default:"/auth/forget-password"},loading:{type:Boolean,default:!1},qrCodeLoginPath:{default:"/auth/qrcode-login"},registerPath:{default:"/auth/register"},showCodeLogin:{type:Boolean,default:!1},showForgetPassword:{type:Boolean,default:!1},showQrcodeLogin:{type:Boolean,default:!1},showRegister:{type:Boolean,default:!1},showRememberMe:{type:Boolean,default:!0},showThirdPartyLogin:{type:Boolean,default:!1},subTitle:{default:""},title:{default:""},submitButtonText:{default:""}},emits:["submit"],setup(e,{expose:n,emit:a}){const i=e,c=a,[l,t]=me(ae({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:W(()=>i.formSchema),showDefaultActions:!1})),r=ge(),u=`REMEMBER_ME_USERNAME_${location.hostname}`,v=localStorage.getItem(u)||"",S=U(!!v);function F(){return K(this,null,function*(){const{valid:b}=yield t.validate(),d=yield t.getValues();b&&(localStorage.setItem(u,S.value?d==null?void 0:d.username:""),c("submit",d))})}function D(b){r.push(b)}return ke(()=>{v&&t.setFieldValue("username",v)}),n({getFormApi:()=>t}),(b,d)=>(m(),x("div",{onKeydown:be(ye(F,["prevent"]),["enter"])},[R(b.$slots,"title",{},()=>[g(Le,null,{desc:h(()=>[C("span",Ue,[R(b.$slots,"subTitle",{},()=>[E(w(e.subTitle||s(f)("authentication.loginSubtitle")),1)])])]),default:h(()=>[R(b.$slots,"title",{},()=>[E(w(e.title||`${s(f)("authentication.welcomeBack")} ðŸ‘‹ðŸ»`),1)])]),_:3})]),g(s(l)),e.showRememberMe||e.showForgetPassword?(m(),x("div",Oe,[C("div",Ye,[e.showRememberMe?(m(),I(s(he),{key:0,modelValue:S.value,"onUpdate:modelValue":d[0]||(d[0]=L=>S.value=L),name:"rememberMe"},{default:h(()=>[E(w(s(f)("authentication.rememberMe")),1)]),_:1},8,["modelValue"])):M("",!0)]),e.showForgetPassword?(m(),x("span",{key:0,class:"vben-link text-sm font-normal",onClick:d[1]||(d[1]=L=>D(e.forgetPasswordPath))},w(s(f)("authentication.forgetPassword")),1)):M("",!0)])):M("",!0),g(s(G),{class:X([{"cursor-wait":e.loading},"w-full"]),loading:e.loading,"aria-label":"login",onClick:F},{default:h(()=>[E(w(e.submitButtonText||s(f)("common.login")),1)]),_:1},8,["class","loading"]),e.showCodeLogin||e.showQrcodeLogin?(m(),x("div",Je,[e.showCodeLogin?(m(),I(s(G),{key:0,class:"w-1/2",variant:"outline",onClick:d[2]||(d[2]=L=>D(e.codeLoginPath))},{default:h(()=>[E(w(s(f)("authentication.mobileLogin")),1)]),_:1})):M("",!0),e.showQrcodeLogin?(m(),I(s(G),{key:1,class:"ml-4 w-1/2",variant:"outline",onClick:d[3]||(d[3]=L=>D(e.qrCodeLoginPath))},{default:h(()=>[E(w(s(f)("authentication.qrcodeLogin")),1)]),_:1})):M("",!0)])):M("",!0),R(b.$slots,"third-party-login",{},()=>[e.showThirdPartyLogin?(m(),I(Ke,{key:0})):M("",!0)]),R(b.$slots,"to-register",{},()=>[e.showRegister?(m(),x("div",Ze,[E(w(s(f)("authentication.accountTip"))+" ",1),C("span",{class:"vben-link text-sm font-normal",onClick:d[4]||(d[4]=L=>D(e.registerPath))},w(s(f)("authentication.createAccount")),1)])):M("",!0)])],40,Ge))}}),it=V({name:"Login",__name:"login",setup(e){const n=pe(),a=W(()=>[{component:"VbenInput",componentProps:{placeholder:f("authentication.usernameTip")},fieldName:"account",label:f("authentication.username"),rules:ee().min(1,{message:f("authentication.usernameTip")})},{component:"VbenInputPassword",componentProps:{placeholder:f("authentication.password")},fieldName:"password",label:f("authentication.password"),rules:ee().min(1,{message:f("authentication.passwordTip")})},{component:Re(Xe),fieldName:"captcha",rules:ve().refine(l=>l,{message:f("authentication.verifyRequiredTip")})}]),i=B("loginRef");function c(l){return K(this,null,function*(){l.password&&(l.password=Be(l.password)),n.authLogin(l).catch(()=>{var r,u;const t=(r=i.value)==null?void 0:r.getFormApi();t==null||t.setFieldValue("captcha",!1,!1),(u=t==null?void 0:t.getFieldComponentRef("captcha"))==null||u.resume()})})}return(l,t)=>(m(),I(s(He),{ref_key:"loginRef",ref:i,"form-schema":a.value,loading:s(n).loginLoading,onSubmit:c},null,8,["form-schema","loading"]))}});export{it as _};
