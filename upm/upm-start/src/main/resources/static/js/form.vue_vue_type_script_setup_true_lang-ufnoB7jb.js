var V=Object.defineProperty,N=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var D=(s,r,t)=>r in s?V(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t,S=(s,r)=>{for(var t in r||(r={}))x.call(r,t)&&D(s,t,r[t]);if(k)for(var t of k(r))O.call(r,t)&&D(s,t,r[t]);return s},b=(s,r)=>N(s,R(r));var g=(s,r,t)=>new Promise((p,c)=>{var y=i=>{try{n(t.next(i))}catch(T){c(T)}},e=i=>{try{n(t.throw(i))}catch(T){c(T)}},n=i=>i.done?p(i.value):Promise.resolve(i.value).then(y,e);n((t=t.apply(s,r)).next())});import{b9 as h,ci as Y,m as q,ab as F,b2 as w,bJ as A,ae as B,ad as L,u as v,bp as j}from"../jse/index-index-rmdNY63r.js";import{c as E}from"./index-BEZtt-y-.js";import{f as P}from"./dateTime-Ce6Ez397.js";import{dP as f,dM as u,dL as W,bj as $,dK as I}from"./bootstrap-DjYyHEgg.js";import{g as J,r as K}from"./business-Uwvf-GkQ.js";import{r as z}from"./contast-C3bEivmW.js";const G={wrapperClass:"flex",commonConfig:{formItemClass:"col-span-12",labelWidth:100}};function H(){const s=h(null),r=[{component:"Select",componentProps:{allowClear:!1,options:z,placeholder:"请选择",class:"w-40"},rules:"required",defaultValue:f.Sale,fieldName:"summaryType",label:"选择任务报表",dependencies:{trigger(e,n){return g(this,null,function*(){e.dateTime&&n.setFieldValue("dateTime",null),n.setFieldValue("dateType",e.summaryType===f.Finance?u.Month:u.Day)})},triggerFields:["summaryType"]}},{component:"Select",componentProps:{allowClear:!1,placeholder:"请选择"},rules:"required",fieldName:"dateType",label:"报表粒度",dependencies:{componentProps(e){return{options:e.summaryType===f.Finance?J([u.Month]):K}},trigger(e,n){return g(this,null,function*(){e.dateTime&&n.setFieldValue("dateTime",null)})},triggerFields:["summaryType","dateType"]}},{fieldName:"dateTime",label:"选择日",component:"DatePicker",rules:"required",componentProps:{format:"YYYY-MM-DD"},dependencies:{show(e){return e.dateType===u.Day},triggerFields:["dateType"]}},{fieldName:"dateTime",label:"选择周",component:"DatePicker",rules:"required",componentProps:{picker:"week",format:e=>{const n=Y(e).startOf("week"),i=Y(e).endOf("week");return`${n.format("YYYY/MM/DD")} ~ ${i.format("YY/MM/DD")}`}},dependencies:{show(e){return e.dateType===u.Week},triggerFields:["dateType"]}},{fieldName:"dateTime",label:"选择月份",component:"DatePicker",rules:"required",componentProps:{picker:"month"},dependencies:{show(e){return e.dateType===u.Month},componentProps(e){return{format:e.summaryType===f.Finance?"YYYYMM":"YYYY-MM"}},triggerFields:["dateType"]}}],[t,p]=W(b(S({wrapperClass:"flex",showDefaultActions:!1},G),{schema:r}));return s.value=p,{SummaryForm:t,formApi:p}}const Q={key:1},oe=q({__name:"form",emits:["onSummarySubmit","reload"],setup(s,{emit:r}){const t=r,p=h({}),c=h(1),y=h({title:"",content:""}),{SummaryForm:e,formApi:n}=H();function i(a){if(a.status===428&&a.msg){const[o,m]=a.msg.split("！");a.title=o,a.formattedCardList=m&&typeof m=="string"?m.split(",").map(l=>({name:l.trim()})):[]}return a}const T=()=>g(null,null,function*(){const{dateType:a,dateTime:o,summaryType:m}=yield n.getValues();if(m===f.Sale){const{startTime:l,endTime:M}=P(o,a);return{dateType:a,startTime:l,endTime:M,summaryType:m}}else return{month:Y(o).startOf("month").format("YYYYMM"),dateType:a,summaryType:m}}),C=()=>{const{time:a,dateType:o,summaryType:m}=p.value;if(m===f.Sale){const{startTime:l,endTime:M}=P(a,o);return{dateType:o,startTime:l,endTime:M,summaryType:m}}else return{month:Y(a).startOf("month").format("YYYYMM"),dateType:o,summaryType:m}},[_,d]=$({destroyOnClose:!0,onOpenChange(a){var o,m,l;c.value=((o=d.getData())==null?void 0:o.status)||1,y.value=((m=d.getData())==null?void 0:m.options)||{},p.value=a?((l=d.getData())==null?void 0:l.record)||{}:{},n.setValues(p.value)},onConfirm(){return g(this,null,function*(){try{if(c.value===1){const{valid:o}=yield n.validate();if(!o)return}d.lock(!0);const a=yield c.value===1?T():C();yield E(a),I.success("汇总报表数据成功"),d.close(),t("reload")}catch(a){const o=i(a);t("onSummarySubmit",o),d.close()}finally{d.lock(!1)}})}});return(a,o)=>(w(),F(v(_),{title:y.value.title,class:"w-[26%]"},{default:A(()=>[B("div",null,[c.value===1?(w(),F(v(e),{key:0})):(w(),L("div",Q,j(y.value.content),1))])]),_:1},8,["title"]))}});export{oe as _};
