var k=Object.defineProperty,N=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var C=(o,s,e)=>s in o?k(o,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[s]=e,p=(o,s)=>{for(var e in s||(s={}))B.call(s,e)&&C(o,e,s[e]);if(S)for(var e of S(s))L.call(s,e)&&C(o,e,s[e]);return o},y=(o,s)=>N(o,T(s));var h=(o,s,e)=>new Promise((c,u)=>{var l=n=>{try{r(e.next(n))}catch(i){u(i)}},d=n=>{try{r(e.throw(n))}catch(i){u(i)}},r=n=>n.done?c(n.value):Promise.resolve(n.value).then(l,d);r((e=e.apply(o,s)).next())});import{dL as j,bj as M,dK as R}from"./bootstrap-DjYyHEgg.js";import{s as J,t as K}from"./index-BWhM0zNP.js";import{a as U}from"./index-BiID8tjB.js";import{m as q,b9 as f,aa as z,ab as E,b2 as G,u as F,bJ as H,ae as O,j as Q}from"../jse/index-index-rmdNY63r.js";const W={class:"common-form"},ae=q({__name:"table-form",setup(o,{expose:s}){const e=f({}),c=f(),u=f(),l=f([]),[d,r]=j(p({showDefaultActions:!1},U)),[n,i]=M({onOpenChange(t){const a=i.getData();u.value=t?a==null?void 0:a.gridApi:null,e.value=t?A((a==null?void 0:a.record)||{}):{},c.value=(a==null?void 0:a.shopId)||"",l.value=(a==null?void 0:a.tableStatusList)||[],w(),r.setValues(e.value)},onConfirm(){return h(this,null,function*(){var a,m;if((yield r.validate()).valid)try{i.lock(!0);const b=yield r.getValues(),v=yield V(b);yield((a=e.value)!=null&&a.id?J:K)(v),R.success("保存成功"),(m=u.value)==null||m.reload(),i.close()}finally{i.lock(!1)}})}});function A(t){return t?y(p({},t),{summarySale:!!t.summarySale,summaryFinance:!!t.summaryFinance}):{summarySale:!1,summaryFinance:!1}}const w=()=>{r.updateSchema([{componentProps:{options:l.value},fieldName:"code"}])};function V(t){return h(this,null,function*(){const{code:a,id:m,sortNumber:b,summaryFinance:v,summarySale:_,type:I}=t,g=l.value.find(P=>P.code===a)||{};return y(p({code:a,name:g.name||"",tableId:g.id||"",sortNumber:b,summaryFinance:v?1:0,summarySale:_?1:0,type:I},m&&{id:m}),{shopId:c.value})})}const x=z(()=>{var t;return(t=e.value)!=null&&t.id?"编辑表配置":"新增表配置"});return s(i),(t,a)=>(G(),E(F(n),{title:x.value,class:"w-300px"},{default:H(()=>[O("div",W,[Q(F(d))])]),_:1},8,["title"]))}});export{ae as _};
