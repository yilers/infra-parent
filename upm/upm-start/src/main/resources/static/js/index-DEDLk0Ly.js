var G=Object.defineProperty,H=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var L=(e,t,i)=>t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,c=(e,t)=>{for(var i in t||(t={}))J.call(t,i)&&L(e,i,t[i]);if(S)for(var i of S(t))U.call(t,i)&&L(e,i,t[i]);return e},v=(e,t)=>H(e,V(t));var D=(e,t,i)=>new Promise((b,p)=>{var C=r=>{try{l(i.next(r))}catch(d){p(d)}},f=r=>{try{l(i.throw(r))}catch(d){p(d)}},l=r=>r.done?b(r.value):Promise.resolve(r.value).then(C,f);l((i=i.apply(e,t)).next())});import{W as K}from"./index-C4NAiFfA.js";import{dw as Q,dI as Z,dJ as ee,dK as te,dz as oe,a7 as B}from"./bootstrap-DjYyHEgg.js";import{h as ie,s as re}from"./fileTransfer-p8-3apt7.js";import{f as ae,y as se}from"./table-FRaKquww.js";import{u as ne,_ as le}from"./useTableImport-CNd8lRg2.js";import{u as de}from"./useDownLoad-Cw45s4VH.js";import{u as me}from"./useDynamicTable-T14ukGXG.js";import{u as ce}from"./useShopCheck-DKIjDUfz.js";import{ci as I,m as ue,b9 as N,v as pe,aa as fe,be as he,ab as w,b2 as u,bJ as s,j as g,u as o,ae as xe,bp as k,bL as E,ai as z,ad as we,I as ge,bb as be}from"../jse/index-index-rmdNY63r.js";import{p as A}from"./contast-C3bEivmW.js";import{u as Ce}from"./useDateRangePicker-DjB1zMnJ.js";import{_ as Te}from"./page.vue_vue_type_script_setup_true_lang-CmAABu9Z.js";import{_ as ye}from"./fallback.vue_vue_type_script_setup_true_lang-CaaeY5iC.js";import"./index-ld-cT6bn.js";import"./hasIn-CXmLCMBI.js";import"./isSymbol-BoOBgcZb.js";import"./useRefs-ReJqRy3L.js";import"./dateTime-Ce6Ez397.js";import"./index-CovW7kLz.js";import"./pageTableConfig-CJVVeSTk.js";import"./tool-BzPbNkcJ.js";import"./rotate-cw-Dzdn7gja.js";const{dateRangePresets:De}=Ce(),_={toolbarConfig:{custom:!0,export:!1,refresh:!0,resizable:!0,zoom:!0,search:!1},columns:[{field:"id",title:"主键ID",width:180},{field:"commonPayTradeNo",title:"流水单号",width:150},{field:"commonTransactionTime",title:"记账时间",width:180},{field:"commonBusinessType",title:"动帐类型",width:150},{field:"wxxdIncomeExpenseType",title:"收支类型",width:150},{field:"commonIncomeAmount",title:"收支金额",width:150},{field:"wxxdAccountBalance",title:"账户余额",width:150},{field:"commonMerchantOrderNo",title:"关联订单号",width:150},{field:"wxxdAfterSaleNo",title:"关联售后单号",width:180},{field:"wxxdWithdrawalNo",title:"关联提现单号",width:180},{field:"wxxdPolicyNo",title:"关联保单号",width:180},{field:"wxxdGiftNo",title:"关联礼物单号",width:150},{field:"commonBusinessDescription",title:"详情",width:200,formatter({cellValue:e}){return e===null?"--":e}},{field:"commonSupplyOrderNo",title:"供货订单号",width:150},{field:"commonSupplyProductName",title:"供货商品名称",width:150},{field:"commonSupplyProductId",title:"供货商品ID",width:150},{field:"nature",title:"性质",width:270,slots:{default:"natureValue"}},{field:"natureStr",title:"性质",width:240,formatter({cellValue:e}){return e===null?"--":e}},{field:"failedReason",title:"异常原因",width:240,formatter({cellValue:e}){return e===null?"--":e}},{field:"progressStatus",title:"进度状态",width:150,formatter({cellValue:e}){const t=A.find(i=>i.value===e);return t?t.label:e}}]},_e={wrapperClass:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",compact:!0,collapsed:!0,commonConfig:{componentProps:{class:"w-full"}},schema:[De.datetime("commonTransactionTime","记账时间",[I().startOf("month"),I().endOf("month")]),{component:"Select",componentProps:{allowClear:!0,placeholder:"请选择",mode:"multiple",maxTagCount:1,maxTagTextLength:6,showSearch:!0,filterOption:(e,t)=>t.label.toLowerCase().includes(e.toLowerCase())},fieldName:"natureList",label:"性质"},{component:"Select",componentProps:{allowClear:!0,options:A,placeholder:"请选择",mode:"multiple",maxTagCount:1,maxTagTextLength:6},fieldName:"progressStatusList",label:"进度状态"}],fieldMappingTime:[["commonTransactionTime",["startTime","endTime"],"YYYY-MM-DD HH:mm:ss"]],showCollapseButton:!0,submitOnChange:!1,submitOnEnter:!1},Ve=ue({__name:"index",setup(e){const{checkShopSelected:t}=ce(),{queryWithColumns:i}=me({staticColumns:_.columns,pageCode:Q.WXXDTransactionStatementDetails,queryFn:se}),{bizImportType:b,bizImportTypeList:p,uploadFormRef:C,isError:f,extension:l,handleImport:r,ImportSettingButton:d}=ne({importTypeList:[{id:1,label:"导入数据",bizCode:"WXXD_TRADE_BILL_DETAIL",isError:!1,auth:"basic:wxxdTransactionStatementDetails:import"},{id:2,label:"导入异常数据",bizCode:"WXXD_TRADE_BILL_DETAIL",isError:!0,auth:"basic:wxxdTransactionStatementDetails:importFail"}],defaultExtension:".csv,.xlsx,.xls",errorExtension:".xlsx"}),P=N(Z.wxxdTradeBillDetailCsv),F=c({},_e),O=v(c({},_),{toolbarConfig:c({},_.toolbarConfig),stripe:!0,border:!0,rowConfig:{isHover:!0},columnConfig:{resizable:!1},showOverflow:!0,exportConfig:{},height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:(a,y)=>D(null,[a,y],function*({page:{currentPage:m,pageSize:n}},x){return t()?yield i(h,c({current:m,size:n},x)):{result:{records:[],total:0}}})}}}),W={},[R,h]=ee({gridEvents:W,formOptions:F,gridOptions:O});pe(()=>{X()});const T=N([]),X=()=>D(null,null,function*(){try{const m=yield ae({});T.value=m,h.formApi.updateSchema([{componentProps:{options:T.value},fieldName:"natureList"}])}catch(m){te.error("获取性质失败")}}),{handleDownload:M,downLoading:$}=de(),{hasAccessByCodes:Y}=oe(),j=fe(()=>Y(["basic:wxxdTransactionStatementDetails:list"]));return(m,n)=>{const x=he("access");return j.value?(u(),w(o(Te),{key:0,"auto-content-height":""},{default:s(()=>[g(o(R),null,{"toolbar-actions":s(()=>[(u(!0),we(ge,null,be(o(p),a=>E((u(),w(o(B),{key:a.id,type:"primary",style:{"margin-right":"12px"},onClick:y=>o(r)(a.bizCode,a.isError,o(h))},{default:s(()=>[z(k(a.label),1)]),_:2},1032,["onClick"])),[[x,[a.auth],"codes"]])),128))]),"toolbar-tools":s(()=>[E((u(),w(o(B),{loading:o($),class:"mr-2",type:"primary",onClick:n[0]||(n[0]=a=>o(M)(o(h),P.value))},{icon:s(()=>[g(o(K),{class:"mr-1 inline-block size-6"})]),default:s(()=>[n[1]||(n[1]=z(" 导出数据 ",-1))]),_:1},8,["loading"])),[[x,["basic:wxxdTransactionStatementDetails:export"],"codes"]]),g(o(d))]),natureValue:s(({row:a})=>{var y;return[xe("div",null,k(((y=T.value.find(q=>q.value===a.nature))==null?void 0:y.label)||a.nature),1)]}),_:1}),g(o(le),{ref_key:"uploadFormRef",ref:C,"biz-import-type":o(b),"is-error":o(f),"upload-fn":o(f)?o(re):o(ie),extension:o(l)},null,8,["biz-import-type","is-error","upload-fn","extension"])]),_:1})):(u(),w(o(ye),{key:1,description:"抱歉，您没有权限访问此页面。",status:"403"}))}}});export{Ve as default};
