var E=Object.defineProperty,F=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var R=(o,a,s)=>a in o?E(o,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[a]=s,p=(o,a)=>{for(var s in a||(a={}))J.call(a,s)&&R(o,s,a[s]);if(W)for(var s of W(a))K.call(a,s)&&R(o,s,a[s]);return o},B=(o,a)=>F(o,Y(a));var h=(o,a,s)=>new Promise((y,C)=>{var b=t=>{try{m(s.next(t))}catch(f){C(f)}},c=t=>{try{m(s.throw(t))}catch(f){C(f)}},m=t=>t.done?y(t.value):Promise.resolve(t.value).then(b,c);m((s=s.apply(o,a)).next())});import{dy as M,dX as P,bj as U,dJ as $,dY as H,dZ as L}from"./bootstrap-DjYyHEgg.js";import{h as X}from"./cardType-DPMG7IpI.js";import{a as Z}from"./business-Uwvf-GkQ.js";import{u as Q}from"./useSchemas-BvOAAoUm.js";import{m as D,b9 as v,n as _,ab as ee,b2 as se,bJ as ae,j as te,u as A}from"../jse/index-index-rmdNY63r.js";function oe(o){return h(this,null,function*(){return M.get(`/baseCategory/findAll?businessCategory=${o}`)})}const me=D({__name:"choose-custom-modal",props:{businessCategory:{default:P.Sale}},emits:["onSubmit"],setup(o,{expose:a,emit:s}){const y=o,C=s,b=v(""),c=v({}),m=v(!1),t=v(),{getChooseGridSchemas:f,getChooseSearchFormSchemas:G}=Q(y.businessCategory),[O,k]=U({onOpenChange(r){return h(this,null,function*(){var u,i,l,g;const e=k.getData();m.value=(u=e==null?void 0:e.isUpdate)!=null?u:!1,t.value=r?e==null?void 0:e.defaultCheckedIds:[],c.value=(i=e==null?void 0:e.formValues)!=null?i:{},b.value=(l=e==null?void 0:e.fieldName)!=null?l:"",r&&(yield _(),n.setGridOptions({columns:f(c.value.calcWay),checkboxConfig:{checkRowKeys:t.value},pagerConfig:{enabled:((g=c.value)==null?void 0:g.calcWay)!=="categorySum"}}))})},onConfirm(){return h(this,null,function*(){var e;const r=((e=t.value)==null?void 0:e.join(","))||"";C("onSubmit",r,b.value),k.close()})}}),I={wrapperClass:"grid-cols-4 md:grid-cols-4",compact:!0,collapsed:!0,commonConfig:{labelWidth:70},schema:[],showCollapseButton:!1,submitOnChange:!1,submitOnEnter:!1},T={toolbarConfig:{custom:!1,refresh:!1,resizable:!1,zoom:!1},columns:[],stripe:!0,border:!0,rowConfig:{isHover:!0,keyField:"id"},checkboxConfig:{reserve:!0,highlight:!0,checkRowKeys:t.value},columnConfig:{resizable:!1},showOverflow:!0,exportConfig:{},height:"auto",keepSource:!0,pagerConfig:{enabled:!0},proxyConfig:{ajax:{query:(i,l)=>h(null,[i,l],function*({page:{currentPage:r,pageSize:e}},u){if(c.value.calcWay==="categorySum"){const N=(yield oe(P.Sale)).map(q=>B(p({},q),{categoryName:"-",calcWay:"categorySum"}));return x(c.value.calcWay),{records:N}}const d=["proportion","sumByYear","yearOverYear"].includes(c.value.calcWay)?{calcWayList:["sum","customSum","categorySum"]}:{},S=yield X(p(p(p({current:r,size:e,type:L.Custom,businessCategory:Z(y.businessCategory)},c.value.calcWay==="customSum"&&{businessType:H.Base}),d),u));return x(c.value.calcWay),S}),querySuccess:()=>{_(()=>{z(n.grid)})}}}},x=r=>{n.formApi&&n.formApi.setState({schema:G(r)})},V={checkboxChange(){t.value=w()},checkboxAll(){t.value=w()}},[j,n]=$({gridOptions:T,formOptions:I,gridEvents:V}),z=r=>h(null,null,function*(){r.getData().filter(i=>{var l;return(l=t.value)==null?void 0:l.includes(i.id)}).forEach(i=>{r.setCheckboxRow(i,!0)})});function w(){var g;const r=n.grid.getCheckboxReserveRecords(),e=n.grid.getCheckboxRecords(),u=n.grid.getData(),l=[...((g=t.value)==null?void 0:g.filter(d=>!u.some(S=>S.id===d)))||[],...r.map(d=>d.id),...e.map(d=>d.id)];return[...new Set(l)]}return a(k),(r,e)=>(se(),ee(A(O),{title:(m.value,"选择"),class:"h-[85%] w-[68%]","content-class":"h-[100%]"},{default:ae(()=>[te(A(j))]),_:1},8,["title"]))}});export{me as _,oe as h};
