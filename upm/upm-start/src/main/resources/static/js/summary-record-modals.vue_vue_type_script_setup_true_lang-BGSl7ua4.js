var j=Object.defineProperty,D=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var W=(t,e,a)=>e in t?j(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,C=(t,e)=>{for(var a in e||(e={}))I.call(e,a)&&W(t,a,e[a]);if(g)for(var a of g(e))V.call(e,a)&&W(t,a,e[a]);return t},_=(t,e)=>D(t,z(e));var m=(t,e,a)=>new Promise((l,p)=>{var S=s=>{try{i(a.next(s))}catch(d){p(d)}},b=s=>{try{i(a.throw(s))}catch(d){p(d)}},i=s=>s.done?l(s.value):Promise.resolve(s.value).then(S,b);i((a=a.apply(t,e)).next())});import{a8 as A,bj as E,dJ as $,dx as q,dP as F}from"./bootstrap-DjYyHEgg.js";import{b as J}from"./index-BEZtt-y-.js";import{u as L}from"./useDownLoad-Cw45s4VH.js";import{g as w,r as U,f as G}from"./business-Uwvf-GkQ.js";import{d as T,P as v,c as x,r as N,e as B,f as K}from"./contast-C3bEivmW.js";import{j as h,aM as H,ci as O,m as Q,b9 as X,aa as Y,ab as Z,b2 as ee,bJ as k,u as f}from"../jse/index-index-rmdNY63r.js";import{B as te}from"./index-ClU3eF4t.js";import{u as ae}from"./useDateRangePicker-DjB1zMnJ.js";import{_ as le}from"./table-action.vue_vue_type_style_index_0_lang-BluPqhNI.js";function oe(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!H(t)}function c(t,e){return!t||t===""?"-":h(A,{color:e},oe(t)?t:{default:()=>[t]})}function y(t,e){return h(te,{status:e,text:t},null)}const{dateRangePresets:P}=ae(),he=()=>[P.datetime("summaryTime","汇总时间",[O().startOf("month"),O().endOf("month")]),P.datetime("reportTime","报表日期"),{component:"Select",componentProps:{allowClear:!0,options:N,placeholder:"请选择"},fieldName:"summaryType",label:"报表名称"},{component:"Select",componentProps:{options:U,placeholder:"请选择"},fieldName:"dateType",label:"报表粒度"},{component:"Select",componentProps:{options:x,placeholder:"请选择"},fieldName:"summaryStatus",label:"汇总状态"},{component:"Select",componentProps:{options:T,placeholder:"请选择"},fieldName:"summaryWay",label:"汇总方式"},{component:"Select",componentProps:{options:B,placeholder:"请选择"},fieldName:"reviewStatus",label:"审核状态"}],Se=[{title:"汇总时间",field:"createTime",minWidth:150},{title:"任务耗时",field:"totalCost",minWidth:150,slots:{default:({row:t})=>{var e;return(e=t.totalCost)!=null?e:"-"}}},{title:"报表日期",field:"consumingTime",minWidth:180},{title:"报表名称",minWidth:180,field:"summaryType",slots:{default:({row:t})=>{var a;const e=N.find(l=>l.value===t.summaryType);return e?c(e.label,(a=e.color)!=null?a:"default"):"-"}}},{title:"报表粒度",minWidth:120,field:"dateType",slots:{default:({row:t})=>{var a;const e=w().find(l=>l.value===t.dateType);return e?c(e.label,(a=e.color)!=null?a:"default"):"-"}}},{title:"汇总状态",field:"summaryStatus",minWidth:150,align:"center",slots:{default:"summaryStatus"}},{title:"汇总方式",minWidth:150,field:"summaryWay",slots:{default:({row:t})=>{var a;const e=T.find(l=>l.value===t.summaryWay);return e?c(e.label,(a=e.color)!=null?a:"default"):"-"}}},{title:"审核状态",minWidth:150,field:"reviewStatus",slots:{default:({row:t})=>{var a;const e=B.find(l=>l.value===t.reviewStatus);return e?y(e.label,(a=e.status)!=null?a:"default"):"-"}}},{field:"action",fixed:"right",slots:{default:"action"},title:"操作",resizable:!1,width:270}],se=[{title:"汇总时间",field:"createTime",width:150},{title:"报表粒度",minWidth:120,field:"dateType",slots:{default:({row:t})=>{var a;const e=w().find(l=>l.value===t.dateType);return e?c(e.label,(a=e.color)!=null?a:"default"):"-"}}},{title:"汇总方式",minWidth:150,field:"summaryWay",slots:{default:({row:t})=>{var a;const e=T.find(l=>l.value===t.summaryWay);return e?c(e.label,(a=e.color)!=null?a:"default"):"-"}}},{title:"数据检查状态",field:"checkStatus",minWidth:120,slots:{default:({row:t})=>{var a;const e=v.find(l=>l.value===t.checkStatus);return e?y(e.label,(a=e.status)!=null?a:"default"):"-"}}},{title:"检查耗时",field:"checkCost",minWidth:120,slots:{default:({row:t})=>{var e;return(e=t.checkCost)!=null?e:"-"}}},{title:"数据汇总状态",field:"summaryStatus",minWidth:150,slots:{default:({row:t})=>{var a;const e=x.find(l=>l.value===t.summaryStatus);return e?y(e.label,(a=e.status)!=null?a:"default"):"-"}}},{title:"汇总耗时",field:"summaryCost",minWidth:120,slots:{default:({row:t})=>{var e;return(e=t.summaryCost)!=null?e:"-"}}},{title:"制作状态",field:"exportStatus",minWidth:120,slots:{default:({row:t})=>{var a;const e=v.find(l=>l.value===t.exportStatus);return e?y(e.label,(a=e.status)!=null?a:"default"):"-"}}},{title:"制作耗时",field:"exportCost",minWidth:120,slots:{default:({row:t})=>{var e;return(e=t.exportCost)!=null?e:"-"}}},{title:"备注",field:"remark",minWidth:300,slots:{default:({row:t})=>t.remark||"-"}},{title:"错误详情",field:"errorDetail",minWidth:300,slots:{default:({row:t})=>t.errorDetail||"-"}},{field:"action",fixed:"right",slots:{default:"action"},title:"操作",resizable:!1,width:100}],be=Q({__name:"summary-record-modals",setup(t){const e=X({}),[a,l]=E({onClosed:b,onConfirm:S,onOpenChange:p,destroyOnClose:!0});function p(u){return m(this,null,function*(){if(!u)return null;const n=l.getData();e.value=n})}function S(){return m(this,null,function*(){l.close()})}function b(){return m(this,null,function*(){l.close()})}const i={showOverflow:!1,columns:se,toolbarConfig:{custom:!1,refresh:!1,resizable:!1,zoom:!1},height:"auto",keepSource:!0,pagerConfig:{enabled:!1},proxyConfig:{ajax:{query:(u,n)=>m(null,null,function*(){return{records:yield J(_(C({},n),{id:e.value.id}))}})}}},[s]=$({gridOptions:i,gridEvents:{}}),{handleBlobDownload:d}=L(),M=Y(()=>{const{selectedShopName:u}=q();return n=>{const o=K.find(R=>R.value===e.value.summaryType),r=G(n.time,n.dateType).replaceAll("-","");return`${u}-${(o==null?void 0:o.label)||"报表"}${r}`}});return(u,n)=>(ee(),Z(f(a),{"fullscreen-button":!1,title:"汇总记录",class:"h-[90%] w-[70%]","content-class":"h-[100%]"},{default:k(()=>[h(f(s),null,{action:k(({row:o})=>[h(f(le),{actions:[{label:"下载",icon:"carbon:download",type:"link",size:"small",auth:["tasks:summarizeTask:downLoad"],ifShow:()=>{var r;return((r=e.value)==null?void 0:r.summaryType)===f(F).Finance&&o.exportId},loading:o.loading,onClick:f(d).bind(null,{id:o.exportId,name:M.value(o)},r=>o.loading=r)}]},null,8,["actions"])]),_:1})]),_:1}))}});export{be as _,Se as c,he as q};
