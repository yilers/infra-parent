var _=Object.defineProperty,x=Object.defineProperties;var y=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var N=(t,a,e)=>a in t?_(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e,g=(t,a)=>{for(var e in a||(a={}))A.call(a,e)&&N(t,e,a[e]);if(v)for(var e of v(a))S.call(a,e)&&N(t,e,a[e]);return t},P=(t,a)=>x(t,y(a));var C=(t,a,e)=>new Promise((i,n)=>{var h=s=>{try{d(e.next(s))}catch(m){n(m)}},b=s=>{try{d(e.throw(s))}catch(m){n(m)}},d=s=>s.done?i(s.value):Promise.resolve(s.value).then(h,b);d((e=e.apply(t,a)).next())});import{bD as M,dL as L,bj as k,dK as j}from"./bootstrap-DjYyHEgg.js";import{a as B,b as F}from"./productMatch-mIhL3Voh.js";import{u as R}from"./useDateRangePicker-DjB1zMnJ.js";import{m as Y,b9 as u,u as f,ab as U,b2 as q,bJ as D,ae as H,j as V}from"../jse/index-index-rmdNY63r.js";const{dateRangePresets:z}=R(),E=[{label:"天猫商品",value:1},{label:"腾讯商品",value:2}],$={toolbarConfig:{resizable:!0},columns:[{field:"id",title:"商品编号",width:170},{field:"type",title:"类型",formatter({cellValue:t}){const a=E.find(e=>e.value===t);return a?a.label:t},width:180},{field:"productId",title:"商品ID",width:200},{field:"productName",title:"商品名称",width:350},{field:"cardNames",title:"关联卡种",formatter({cellValue:t}){return(t==null?void 0:t.split(",").join(`
`))||""}},{field:"createTime",title:"添加时间",width:200},{width:200,title:"操作",align:"center",slots:{default:"action"},fixed:"right"}]},ee={wrapperClass:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",compact:!0,collapsed:!0,commonConfig:{componentProps:{class:"w-full"}},schema:[z.datetime("createTime","创建时间"),{fieldName:"cardIds",label:"关联卡种",component:"Select",componentProps:{placeholder:"请选择",mode:"multiple",maxTagCount:1,maxTagTextLength:12,allowClear:!0,showSearch:!0,filterOption:(t,a)=>a.label.toLowerCase().includes(t.toLowerCase())}},{component:"Input",componentProps:{allowClear:!0},fieldName:"productId",label:"商品ID"},{component:"Input",componentProps:{allowClear:!0},fieldName:"productName",label:"商品名称"}],fieldMappingTime:[["createTime",["startTime","endTime"],"YYYY-MM-DD HH:mm:ss"]],showCollapseButton:!0,submitOnChange:!1,submitOnEnter:!1},J={wrapperClass:"grid-cols-12",commonConfig:{formItemClass:"col-span-12"},schema:[{fieldName:"id",label:"卡种ID",component:"Input",dependencies:{show:!1,triggerFields:["id"]}},{fieldName:"productId",label:"商品ID",component:"Input",componentProps:{placeholder:"请输入商品ID",allowClear:!0},formItemClass:"col-span-12",rules:"required"},{fieldName:"productName",label:"商品名称",component:"Input",componentProps:{placeholder:"请输入商品名称",allowClear:!0},formItemClass:"col-span-12",rules:M().min(1,{message:"请输入商品名称"}).max(50,{message:"最多输入50个字符"})},{fieldName:"cardIds",label:"关联卡种",component:"Select",componentProps:{placeholder:"请选择关联卡种",mode:"multiple",allowClear:!0,class:"w-full",showSearch:!0,filterOption:(t,a)=>a.label.toLowerCase().includes(t.toLowerCase())},formItemClass:"col-span-12",rules:"required"}]},K={class:"common-form"},te=Y({__name:"form",setup(t,{expose:a}){const e=u({}),i=u(!1),n=u(),h=u(),b=u([]),[d,s]=L(g({showDefaultActions:!1},J)),[m,p]=k({onOpenChange(r){var l;const o=p.getData();i.value=(l=o==null?void 0:o.isUpdate)!=null?l:!1,h.value=o==null?void 0:o.activeTab,n.value=r?o==null?void 0:o.gridApi:null,b.value=r?o==null?void 0:o.categories:[],e.value=r?(o==null?void 0:o.record)||{}:{},r&&e.value.cardList&&(e.value.cardIds=e.value.cardList.map(c=>c.id)),r&&s.updateSchema([{fieldName:"cardIds",componentProps:{options:b.value}},{fieldName:"productId",componentProps:{disabled:f(i)}}]),s.setValues(e.value)},onConfirm(){return C(this,null,function*(){var o,l;if((yield s.validate()).valid)try{p.lock(!0);const c=yield s.getValues(),w=yield T(c);yield((o=e.value)!=null&&o.id?B:F)(w),j.success("保存成功"),(l=n.value)==null||l.reload(),p.close()}finally{p.lock(!1)}})}});function T(r){return C(this,null,function*(){const{cardIds:o,productName:l,id:c,productId:w}=r,I=Array.isArray(o)?o:o.split(",");return g(P(g({},!f(i)&&{productId:w}),{productName:l,cardIds:I.join(","),type:f(h)}),c&&{id:c})})}return a(p),(r,o)=>(q(),U(f(m),{title:i.value?"编辑商品":"新增商品",class:"w-300px"},{default:D(()=>[H("div",K,[V(f(d))])]),_:1},8,["title"]))}});export{te as _,$ as g,ee as s};
