var G=Object.defineProperty,F=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var D=(s,o,e)=>o in s?G(s,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[o]=e,C=(s,o)=>{for(var e in o||(o={}))z.call(o,e)&&D(s,e,o[e]);if(k)for(var e of k(o))R.call(o,e)&&D(s,e,o[e]);return s},S=(s,o)=>F(s,V(o));var n=(s,o,e)=>new Promise((b,f)=>{var u=c=>{try{p(e.next(c))}catch(i){f(i)}},_=c=>{try{p(e.throw(c))}catch(i){f(i)}},p=c=>c.done?b(c.value):Promise.resolve(c.value).then(u,_);p((e=e.apply(s,o)).next())});import{bj as U,dJ as j,dK as h,R as J,bu as M}from"./bootstrap-DjYyHEgg.js";import{h as T,e as x,a as $,b as q,c as K}from"./index-C4izEvQb.js";import L from"./index-EkdSFYQU.js";import{m as Q,b9 as W,ab as B,b2 as N,u as g,bJ as m,j as E,ad as X,aR as Y,bp as P,ae as Z,ai as w}from"../jse/index-index-rmdNY63r.js";import"./contast-C3bEivmW.js";import"./index-DMLMl1eR.js";import"./isPlainObject-DfbxWMXa.js";const tt={class:"truncate whitespace-nowrap"},rt={key:1},et=Q({__name:"editHistoryForm",emits:["onSubmit"],setup(s,{expose:o,emit:e}){const b=e,[f,u]=U({onOpenChange(r){return n(this,null,function*(){r&&y.setGridOptions({columns:x.columns.map(a=>(a.field==="productPrice"&&(a.visible=!1),a))})})},onConfirm(){return n(this,null,function*(){try{if(I.value)try{yield I.value}catch(t){I.value=null;return}u.lock(!0);let r=y.grid.getData();if(r=r.filter(t=>t.productId||t.productIdCopy),r.length===0){h.error("请输入要修改的商品ID！");return}if(r.some(t=>t.productIdCopyError)){h.error("商品ID有重复的，请重新输入！");return}const a=r.map(t=>S(C({},t),{productId:t.productIdCopy||t.productId}));yield T(a),h.success("保存成功"),u.close(),b("onSubmit")}finally{u.lock(!1)}})}}),_=C({},$),p={columns:x.columns,toolbarConfig:{enabled:!1},editConfig:{},stripe:!0,border:!0,rowConfig:{isHover:!0},columnConfig:{resizable:!1},showOverflow:!0,exportConfig:{},height:"auto",keepSource:!0,pagerConfig:{enabled:!1},proxyConfig:{ajax:{query:(l,A)=>n(null,[l,A],function*({page:{currentPage:r,pageSize:a}},t){return t.sourceProductId?(y.setGridOptions({columns:x.columns.map(v=>(v.field==="productPrice"&&(v.visible=t.type===2),v))}),{records:yield q(C({current:r,size:a},t))}):{records:[]}})}}},c={},[i,y]=j({formOptions:_,gridOptions:p,gridEvents:c}),I=W(null),H=r=>new Promise((a,t)=>n(null,null,function*(){try{if(r.productIdCopyError=!1,!r.productIdCopy){a(!0);return}const l=yield K(r.sourceProductId),A=y.grid.getData();(l.some(d=>d.productId===r.productIdCopy)||A.some(d=>(d.productName!==r.productName||d.productName===r.productName&&d.productPrice!==r.productPrice)&&d.productIdCopy===r.productIdCopy))&&(h.error(`商品ID '${r.productIdCopy}' 已重复，请重新输入！`),r.productIdCopyError=!0,t("出错了")),a(!0)}catch(l){t("出错了")}})),O=r=>n(null,null,function*(){I.value=H(r).then(()=>!0).catch(a=>{throw a})});return o(u),(r,a)=>(N(),B(g(f),{title:"修改历史数据",class:"h-[80%] w-[70%]","content-class":"h-[100%]"},{default:m(()=>[E(g(i),null,{productName:m(({row:t})=>[E(g(J),null,{title:m(()=>[w(P(t.productName||"--"),1)]),default:m(()=>[Z("div",tt,P(t.productName||"--"),1)]),_:2},1024)]),productId:m(({row:t})=>[t.productId?(N(),X("div",rt,P(t.productId||"--"),1)):(N(),B(g(L),{key:0,value:t.productIdCopy,"onUpdate:value":l=>t.productIdCopy=l,class:Y({"border-red-500":t.productIdCopyError}),onBlur:l=>O(t)},null,8,["value","onUpdate:value","class","onBlur"]))]),_:1})]),_:1}))}}),it=M(et,[["__scopeId","data-v-477c21dd"]]);export{it as default};
