var L=Object.defineProperty,M=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var v=(e,t,s)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,C=(e,t)=>{for(var s in t||(t={}))R.call(t,s)&&v(e,s,t[s]);if(N)for(var s of N(t))O.call(t,s)&&v(e,s,t[s]);return e},I=(e,t)=>M(e,B(t));var d=(e,t,s)=>new Promise((a,l)=>{var y=i=>{try{u(s.next(i))}catch(n){l(n)}},b=i=>{try{u(s.throw(i))}catch(n){l(n)}},u=i=>i.done?a(i.value):Promise.resolve(i.value).then(y,b);u((s=s.apply(e,t)).next())});import{b5 as f,e0 as W,bN as G,e1 as U,e2 as j,e3 as q,aZ as F,dV as E,a$ as $}from"./bootstrap-B0IOIL79.js";import{d as z,e as K,h as H,a as J}from"./index-KxAZzjzc.js";import{j as c,L as Y,m as Z,b9 as k,aa as A,bY as Q,u as p,ab as X,b2 as ee,bJ as te}from"../jse/index-index-StHjciy-.js";import{u as se}from"./use-drawer-zBZwZnKb.js";import{s as ne,l as oe,a as ie}from"./tree-Cp_w0kss.js";import{g as re}from"./get-popup-container-BlodRF3J.js";var P=(e=>(e.Web="web",e))(P||{});P.Web+"";const ae=[{label:"目录",value:0},{label:"菜单",value:1},{label:"按钮",value:2}],le={0:{icon:q,value:"目录"},1:{icon:j,value:"菜单"},2:{icon:U,value:"按钮"}};function h(){return[{color:"error",label:"否",value:0},{color:"processing",label:"是",value:1}]}const be=[{title:"菜单名称",field:"permissionName",treeNode:!0,width:200,align:"left",dragSort:!0},{title:"图标",field:"menuIcon",width:80,slots:{default:({row:e})=>(e==null?void 0:e.menuIcon)==="#"?"":c("span",{class:"flex justify-center"},[c(G,{icon:e.menuIcon},null)])}},{title:"组件类型",field:"permissionType",width:150,slots:{default:({row:e})=>{const t=le[e.permissionType];return t?c("span",{class:"flex items-center justify-center gap-1"},[Y(t.icon,{class:"size-[18px]"}),c("span",null,[t.value])]):"未知"}}},{title:"权限标识",field:"permissionCode"},{title:"组件路径",field:"component"},{title:"排序",field:"sortNumber"},{field:"usable",title:"是否启用",width:100,cellRender:{name:"CellTag",options:h()}},{title:"创建时间",field:"createTime"},{field:"action",fixed:"right",slots:{default:"action"},title:"操作",resizable:!1,width:"auto"}],pe=()=>[{fieldName:"id",label:"ID",component:"Input",dependencies:{show:!1,triggerFields:["id"]}},{component:"TreeSelect",defaultValue:"0",fieldName:"parentId",label:"上级菜单",rules:"selectRequired"},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:ae,optionType:"button"},defaultValue:0,dependencies:{componentProps:(e,t)=>(Object.keys(t.errors.value).forEach(s=>{t.setFieldError(s,void 0)}),{}),triggerFields:["permissionType"]},fieldName:"permissionType",label:"菜单类型",rules:"required"},{component:"Input",fieldName:"permissionName",label:"菜单名称",rules:"required",formItemClass:"col-span-2 md:col-span-2"},{component:"IconPicker",componentProps:{prefix:"carbon"},dependencies:{show:e=>e.permissionType!==2,triggerFields:["permissionType"]},fieldName:"menuIcon",label:"菜单图标"},{component:"Input",componentProps:e=>({placeholder:e.link===1?"填写链接地址http(s)://  使用新页面打开":"填写`路由地址`或者`链接地址`  链接默认使用内部iframe内嵌打开"}),dependencies:{rules:e=>e.link!==1?f({message:"请输入路由地址"}).min(1,"请输入路由地址").refine(t=>!t.startsWith("/"),{message:"路由地址不需要带/"}):f({message:"请输入链接地址"}).regex(/^https?:\/\//,{message:"请输入正确的链接地址"}),show:e=>(e==null?void 0:e.permissionType)!==2,triggerFields:["link","permissionType"]},fieldName:"menuUrl",help:`路由地址不带/, 如: menu, user
 链接为http(s)://开头
 链接默认使用内部iframe打开, 可通过{是否外链}控制打开方式`,label:"路由地址"},{component:"AutoComplete",componentProps:e=>({allowClear:!0,disabled:e.link===1,filterOption(t,s){return s.value.toLowerCase().includes(t.toLowerCase())},options:W().map(t=>({value:t}))}),defaultValue:"",dependencies:{rules:e=>e.menuUrl&&!/^https?:\/\//.test(e.menuUrl)?f().min(1,{message:"非链接时必填组件路径"}).refine(t=>!t.startsWith("/")&&!t.endsWith("/"),{message:"组件路径开头/末尾不需要带/"}):f().optional(),show:e=>e.permissionType===1,triggerFields:["permissionType","menuUrl"]},fieldName:"component",help:"填写./src/views下的组件路径, 如system/menu/index",label:"组件路径"},{component:"Input",dependencies:{show:e=>e.permissionType===2,triggerFields:["permissionType"]},fieldName:"permissionCode",help:`权限字符
 如: system:user:import`,label:"权限标识",rules:"required"},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:h(),optionType:"button"},defaultValue:0,dependencies:{show:e=>e.permissionType!==2,triggerFields:["permissionType"]},fieldName:"link",help:`外链为http(s)://开头
 选择否时, 使用iframe从内部打开页面, 否则新窗口打开`,label:"是否外链"},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:h(),optionType:"button"},defaultValue:1,dependencies:{show:e=>e.permissionType!==2,triggerFields:["permissionType"]},fieldName:"usable",help:"停用后不会出现在菜单栏, 也无法访问",label:"是否启用"},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:h(),optionType:"button"},defaultValue:1,dependencies:{show:e=>e.permissionType===1,triggerFields:["permissionType"]},fieldName:"cache",help:"路由的keepAlive属性",label:"是否缓存"}],ge=Z({__name:"menu-drawer",emits:["reload"],setup(e,{emit:t}){const s=t,a=k(),l=k(""),y=A(()=>{var r;return(r=a.value)!=null&&r.id?F("pages.common.edit"):F("pages.common.add")}),{hasAccessByRoles:b}=E(),u=A(()=>b(["platformAdmin"])),[i,n]=$({commonConfig:{componentProps:{class:"w-full"},formItemClass:"col-span-2",labelWidth:90},schema:pe(),showDefaultActions:!1,wrapperClass:"grid-cols-2"});function x(){return d(this,null,function*(){const o=(yield p(u)?H(p(l)):J(p(l))).filter(S=>S.permissionType!==2),g=ne(o,"sortNumber","id"),w=[{id:"0",permissionName:"根目录",children:oe(g,{id:"id",pid:"parentId"})}];ie(w,"permissionName"," / "),n.updateSchema([{componentProps:{fieldNames:{label:"permissionName",value:"id"},getPopupContainer:re,listHeight:300,showSearch:!0,treeData:w,treeDefaultExpandAll:!1,treeDefaultExpandedKeys:["0"],treeLine:{showLeafIcon:!1},treeNodeFilterProp:"permissionName",treeNodeLabelProp:"fullName"},fieldName:"parentId"}])})}const[_,m]=se({destroyOnClose:!0,onClosed:D,onConfirm:V,onOpenChange(r){return d(this,null,function*(){if(!r)return null;m.lock();const o=m.getData();l.value=o.device,yield x(),o?(a.value=o,n.setValues(a.value)):n.resetForm(),m.unlock()})}});function V(){return d(this,null,function*(){var r;try{m.lock(!0);const{valid:o}=yield n.validate();if(!o)return;const g=Q(yield n.getValues()),T=I(C({},g),{version:p(a).version||1,device:p(l)});yield(r=a.value)!=null&&r.id?z(T):K(T),s("reload"),m.close()}catch(o){console.error(o)}finally{m.lock(!1)}})}function D(){return d(this,null,function*(){yield n.resetForm()})}return(r,o)=>(ee(),X(p(_),{title:y.value,class:"w-[600px]"},{default:te(()=>[c(p(i))]),_:1},8,["title"]))}});export{ge as _,be as c};
