var V=Object.defineProperty,j=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var v=(s,e,a)=>e in s?V(s,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[e]=a,l=(s,e)=>{for(var a in e||(e={}))J.call(e,a)&&v(s,a,e[a]);if(T)for(var a of T(e))L.call(e,a)&&v(s,a,e[a]);return s},g=(s,e)=>j(s,F(e));var k=(s,e,a)=>new Promise((b,p)=>{var y=n=>{try{m(a.next(n))}catch(d){p(d)}},f=n=>{try{m(a.throw(n))}catch(d){p(d)}},m=n=>n.done?b(n.value):Promise.resolve(n.value).then(y,f);m((a=a.apply(s,e)).next())});import{dI as N,dJ as O,dz as q,dK as R}from"./bootstrap-DjYyHEgg.js";import{c as w}from"./fileTransfer-p8-3apt7.js";import{E as H}from"./table-FRaKquww.js";import{u as K}from"./useDownLoad-Cw45s4VH.js";import{u as P}from"./useShopCheck-DKIjDUfz.js";import{a as Q}from"./dateTime-Ce6Ez397.js";import{g as A,E as S,a as h,_ as U}from"./form.vue_vue_type_script_setup_true_lang-tDxmchd8.js";import{_ as B}from"./table-action.vue_vue_type_style_index_0_lang-BluPqhNI.js";import{B as x}from"./index-ClU3eF4t.js";import{_ as W}from"./page.vue_vue_type_script_setup_true_lang-CmAABu9Z.js";import{_ as X}from"./fallback.vue_vue_type_script_setup_true_lang-CaaeY5iC.js";import{m as Y,b9 as I,aa as Z,ab as z,b2 as E,bJ as r,j as c,u as o}from"../jse/index-index-rmdNY63r.js";import"./index-Bw6N7aDv.js";import"./shallowequal-W2RnI4nT.js";import"./index-CM6A-82x.js";import"./Dropdown-D1vLSWoc.js";import"./rotate-cw-Dzdn7gja.js";const xt=Y({__name:"index",setup(s){const{checkShopSelected:e}=P(),a=I(),b=I(N.createReconciliationMasterTableCsv),p=g(l({},A),{toolbarConfig:l({},A.toolbarConfig),stripe:!0,border:!0,rowConfig:{isHover:!0},columnConfig:{resizable:!1},showOverflow:!0,exportConfig:{},height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:(D,Ct)=>k(null,[D,Ct],function*({page:{currentPage:u,pageSize:i}},t){if(!e())return{result:{records:[],total:0}};const _=yield H(l({current:u,size:i},t)),M=_.records.map(C=>g(l({},C),{consumingTime:Q(C.startTime,C.endTime)}));return g(l({},_),{records:M})})}}}),[y,f]=O({gridOptions:p}),m=()=>{e()&&(a.value.setData({gridApi:f}),a.value.open())},n=u=>k(null,null,function*(){if(u.productionStatus===1){R.warning("制作对账总表正在处理中，请刷新查看");return}u.productionStatus=1;try{const i={code:o(b),reconciliationTaskId:u.id,reExport:u.exportId?1:0};yield w(i),R.success("制作对账总表正在处理中，请刷新查看")}catch(i){console.error(i)}finally{f.reload()}}),{hasAccessByCodes:d}=q(),$=Z(()=>d(["financeAccount:reconciliationTask:list"])),{handleBlobDownload:G}=K();return(u,i)=>$.value?(E(),z(o(W),{key:0,"auto-content-height":""},{default:r(()=>[c(o(y),null,{"toolbar-actions":r(()=>[c(o(B),{actions:[{label:"汇总报表数据",type:"primary",icon:"ant-design:align-left-outlined",auth:["financeAccount:reconciliationTask:summaryReport"],onClick:()=>m()}]},null,8,["actions"])]),importStatus:r(({row:t})=>[c(o(x),{status:o(h)[t.importStatus],text:o(S)[t.importStatus],class:"badge-3-words"},null,8,["status","text"])]),reconciliationStatus:r(({row:t})=>[c(o(x),{status:o(h)[t.reconciliationStatus],text:o(S)[t.reconciliationStatus],class:"badge-3-words"},null,8,["status","text"])]),summaryStatus:r(({row:t})=>[c(o(x),{status:o(h)[t.summaryStatus],text:o(S)[t.summaryStatus],class:"badge-3-words"},null,8,["status","text"])]),productionStatus:r(({row:t})=>[c(o(x),{status:o(h)[t.productionStatus],text:o(S)[t.productionStatus],class:"badge-3-words"},null,8,["status","text"])]),"toolbar-tools":r(()=>[...i[0]||(i[0]=[])]),action:r(({row:t})=>[c(o(B),{actions:[{label:`${t.exportId?"重新制作":"制作总表"} `,icon:"ant-design:edit-outlined",type:"link",size:"small",auth:["financeAccount:reconciliationTask:make"],onClick:n.bind(null,t)},{label:"下载",icon:"ant-design:cloud-download-outlined",type:"link",size:"small",ifShow(){return t.exportId&&t.productionStatus===2},loading:t.loading,auth:["financeAccount:reconciliationTask:download"],onClick:o(G).bind(null,{id:t.exportId,name:t.taskName+t.month},D=>t.loading=D)}]},null,8,["actions"])]),_:1}),c(U,{ref_key:"summaryReportFormRef",ref:a},null,512)]),_:1})):(E(),z(o(X),{key:1,description:"抱歉，您没有权限访问此页面。",status:"403"}))}});export{xt as default};
