var $=Object.defineProperty,F=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var D=(e,a,t)=>a in e?$(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,O=(e,a)=>{for(var t in a||(a={}))U.call(a,t)&&D(e,t,a[t]);if(A)for(var t of A(a))Y.call(a,t)&&D(e,t,a[t]);return e},x=(e,a)=>F(e,P(a));var k=(e,a,t)=>new Promise((l,c)=>{var p=n=>{try{u(t.next(n))}catch(f){c(f)}},g=n=>{try{u(t.throw(n))}catch(f){c(f)}},u=n=>n.done?l(n.value):Promise.resolve(n.value).then(p,g);u((t=t.apply(e,a)).next())});import{dO as z,a7 as E,dv as b,dK as M}from"./bootstrap-DjYyHEgg.js";import{e as I}from"./shopRechargeSales-BtQUcM40.js";import{C as y,_ as V}from"./base-table.vue_vue_type_script_setup_true_lang-D9HE2RzI.js";import{_ as j}from"./diff-detail-modal.vue_vue_type_script_setup_true_lang-BoPd08a_.js";import{ci as N,m as q,b9 as C,w,ad as T,b2 as d,ab as R,j as S,bJ as h,u as i,bp as G,ai as H,I as J}from"../jse/index-index-rmdNY63r.js";import{r as K}from"./business-Uwvf-GkQ.js";import{u as L}from"./useDateRangePicker-DjB1zMnJ.js";import{_ as Q}from"./test-order-modal.vue_vue_type_script_setup_true_lang-DOa2_eMp.js";import W from"./index-EkdSFYQU.js";import{_ as X}from"./table-action.vue_vue_type_style_index_0_lang-BluPqhNI.js";const{dateRangePresets:Z}=L(),ee={toolbarConfig:{resizable:!0}},ae=[{label:"是",value:1},{label:"否",value:0}],v={wrapperClass:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",compact:!0,collapsed:!0,commonConfig:{componentProps:{class:"w-full"}},schema:[{component:"Select",defaultValue:"day",componentProps:{options:K,placeholder:"请选择"},rules:"required",fieldName:"type",label:"报表粒度"},Z.date("createTime","日期",[N().startOf("month"),N().endOf("month")]),{component:"Select",componentProps:{allowClear:!0,options:ae,placeholder:"请选择"},fieldName:"difference",label:"是否有差异",dependencies:{if(e){return e.type!==3},trigger(e,a){a.setFieldValue("difference",void 0)},triggerFields:["type"]}}],fieldMappingTime:[["createTime",["startTime","endTime"],"YYYY-MM-DD"]],showCollapseButton:!1,submitOnChange:!1,submitOnEnter:!1},te={key:0},se={key:1},ye=q({__name:"table-column",props:{activeTab:{},businessCategory:{},templateType:{},tabName:{},direction:{default:z.Horizontal}},setup(e){var _;const a=e,t=C(),l=C(),c=C(),p=(_=v==null?void 0:v.schema)!=null?_:[],g=p.filter(s=>s.fieldName!=="difference"),u=()=>{const s=a.templateType===b.Summary?[y.difference,y.customRemark]:[],o=a.templateType===b.Summary?[y.action]:[];return[...s,...o]},n=s=>{var o;t.value.setData({record:s,gridApi:(o=l.value)==null?void 0:o.gridApi}),t.value.open()},f=s=>{var o;c.value.setData({record:s,gridApi:(o=l.value)==null?void 0:o.gridApi}),c.value.open()};w(()=>a.templateType,(s,o)=>k(null,null,function*(){var r;if(s!==o&&((r=l.value)!=null&&r.gridApi)){const{gridApi:m}=l.value;m.formApi.resetForm(),m.formApi.setState({schema:s===b.Summary?p:g}),m.formApi.validateAndSubmitForm()}}));const B=s=>k(null,null,function*(){try{yield I({id:s.id,remark:s.customRemark}),M.success("保存成功")}catch(o){M.error("保存失败")}});return(s,o)=>(d(),T(J,null,[(d(),R(V,{ref_key:"baseTableRef",ref:l,"active-tab":e.activeTab,key:e.activeTab,"business-category":e.businessCategory,"template-type":e.templateType,direction:e.direction,"search-form-schemas":x(O({},i(v)),{schema:e.templateType===i(b).Summary?i(p):i(g)}),"grid-schemas":i(ee),"base-columns":[i(y).date,i(y).specs],"additional-columns":u(),"export-file-name":e.tabName,"permission-code":["report:shopRechargeSales:export"]},{action:h(({row:r})=>[S(i(X),{actions:[{label:"查询测试订单",auth:["report:shopRechargeSales:testOrder"],icon:"ant-design:zoom-out-outlined",onClick:()=>f(r)}]},null,8,["actions"])]),difference:h(({row:r})=>[r.difference===0?(d(),T("div",te,"否")):(d(),R(i(E),{key:1,type:"link",onClick:m=>n(r)},{default:h(()=>[...o[0]||(o[0]=[H("是",-1)])]),_:1},8,["onClick"]))]),customRemark:h(({row:r})=>[r.status===2?(d(),R(i(W),{key:0,value:r.customRemark,"onUpdate:value":m=>r.customRemark=m,maxlength:50,onBlur:m=>B(r)},null,8,["value","onUpdate:value","onBlur"])):(d(),T("div",se,G(r.customRemark||"--"),1))]),_:1},8,["active-tab","business-category","template-type","direction","search-form-schemas","grid-schemas","base-columns","additional-columns","export-file-name"])),S(j,{ref_key:"diffDetailModalRef",ref:t},null,512),S(Q,{ref_key:"testOrderModalRef",ref:c},null,512)],64))}});export{ye as _};
