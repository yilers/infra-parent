var b=(D,k,v)=>new Promise((l,o)=>{var f=a=>{try{y(v.next(a))}catch(u){o(u)}},h=a=>{try{y(v.throw(a))}catch(u){o(u)}},y=a=>a.done?l(a.value):Promise.resolve(a.value).then(f,h);y((v=v.apply(D,k)).next())});import{C as J,c as P}from"./index-C4NAiFfA.js";import{el as U,a7 as O}from"./bootstrap-DjYyHEgg.js";import{m as q,b9 as x,ci as i,aa as H,v as K,ad as c,b2 as d,j as m,bJ as p,ae as n,u as r,ai as $,bp as T,I as S,bb as B,ac as z,aR as _,cf as C}from"../jse/index-index-rmdNY63r.js";import{t as R,a as Q,_ as X,g as Z,b as tt}from"./tableMain.vue_vue_type_script_setup_true_lang-CCW7NoGl.js";import{u as et}from"./useShopCheck-DKIjDUfz.js";import{Group as at,Button as W}from"./index-CgNjrL4O.js";import{C as I}from"./index-DQysn_XC.js";const st={class:"mb-4 flex items-center justify-between"},lt={class:"flex items-center"},nt={class:"ml-4 mr-4 text-lg"},ot={class:"flex"},rt={class:"ml-2 text-[14px]"},ut=["onClick"],it={key:0,class:"flex h-full flex-col items-center justify-around"},ct={class:"text-[16px]"},dt={key:1,class:"flex h-full items-center justify-between pl-4 pr-4"},mt={class:"text-[16px]"},vt={class:"mb-4 flex items-center justify-between"},ft={class:"flex"},pt={class:"ml-2 text-[14px]"},gt=q({__name:"TableStatusCards",props:{activeTab:{default:U.Sale}},setup(D){const k=D,{checkShopSelected:v}=et(),l={Day:"day",Week:"week",Month:"month"},o=x(l.Day),f=x([]),h=x([]),y=x(!1),a=x(i()),u=x(0),j=s=>b(null,null,function*(){v()&&(N(s),f.value=yield w(),V(),Y())}),N=s=>{var t;const e=((t=s==null?void 0:s.target)==null?void 0:t.value)||o.value;e===l.Day?a.value=i().subtract(1,"day"):e===l.Week?a.value=i().subtract(1,"week").startOf("week"):a.value=i().subtract(1,"month").startOf("month")},V=()=>{u.value=f.value.findIndex(s=>s.startTime.isSame(a.value,"day"))},E=()=>b(null,null,function*(){v()&&(a.value=o.value===l.Month?a.value.subtract(1,"year"):a.value.subtract(1,"month"),f.value=yield w(),u.value=0,Y())}),G=()=>b(null,null,function*(){if(v()){if(L.value)return!1;a.value=o.value===l.Month?a.value.add(1,"year"):a.value.add(1,"month"),f.value=yield w(),u.value=0,Y()}}),L=H(()=>a.value.startOf("month")>=i().startOf("month")&&o.value!==l.Month||a.value.startOf("year")>=i().startOf("year")&&o.value===l.Month),A=(s,e)=>{if(u.value===e)return!1;u.value=e,Y()},w=()=>b(null,null,function*(){try{const s={type:o.value,time:o.value===l.Month?a.value.format("YYYY"):a.value.format("YYYY-MM"),tabType:k.activeTab},e=(yield Z(s))||[];return e.forEach((t,g)=>{t.startTime=i(t.startTime),t.endTime=i(t.endTime),t.type===l.Day?(t.name=t.startTime.date(),t.startTime.isBefore(i(),"date")||(t.status=-1)):t.type===l.Week?(t.name=`${g+1}周`,t.startTime.isAfter(i().endOf("week"))&&(t.status=-1)):(t.name=`${t.startTime.month()+1}月`,t.startTime.isBefore(i(),"month")||(t.status=-1))}),e}catch(s){return[]}}),Y=()=>b(null,null,function*(){try{y.value=!0,h.value=[];const s=f.value[u.value],e={type:s.type,startTime:s.startTime.format("YYYY-MM-DD"),endTime:s.endTime.format("YYYY-MM-DD"),tabType:k.activeTab};h.value=(yield tt(e))||[]}catch(s){h.value=[]}finally{y.value=!1}}),F=(s,e)=>{if(e===u.value)return[-1,2].includes(s.status)?"border border-primary rounded-md":"border border-destructive rounded-md"},M=s=>R.find(e=>e.status===s.status);return K(()=>{v()&&j()}),(s,e)=>(d(),c("div",null,[m(r(I),null,{default:p(()=>[e[3]||(e[3]=n("span",{class:"mr-4 text-[16px]"},"表粒度",-1)),m(r(at),{value:o.value,"onUpdate:value":e[0]||(e[0]=t=>o.value=t),"button-style":"solid",onChange:j},{default:p(()=>[m(r(W),{value:l.Day},{default:p(()=>[...e[1]||(e[1]=[$("日",-1)])]),_:1},8,["value"]),m(r(W),{value:l.Month},{default:p(()=>[...e[2]||(e[2]=[$("月",-1)])]),_:1},8,["value"])]),_:1},8,["value"])]),_:1}),m(r(I),{class:"mt-4"},{default:p(()=>[n("div",st,[n("div",lt,[m(r(O),{type:"text",onClick:E},{icon:p(()=>[m(r(J),{class:"size-6"})]),_:1}),n("h1",nt,T(o.value!==l.Month?a.value.format("YYYY.MM"):a.value.format("YYYY")),1),m(r(O),{type:"text",onClick:G,disabled:L.value},{icon:p(()=>[m(r(P),{class:"size-6"})]),_:1},8,["disabled"])]),n("div",ot,[(d(!0),c(S,null,B(r(R),t=>(d(),c("div",{class:"mr-4 flex items-center",key:t.status},[t.text?(d(),c("span",{key:0,class:_(r(C)(t.icon,t.class))},null,2)):z("",!0),n("span",rt,T(t.text),1)]))),128))])]),n("div",{class:_(["grid gap-2",o.value===l.Day?"grid-cols-12":o.value===l.Week?"grid-cols-4":"grid-cols-6"])},[(d(!0),c(S,null,B(f.value,(t,g)=>(d(),c("div",{key:t.id,class:_(["mb-2 h-[76px] flex-col items-center justify-around",F(t,g)]),onClick:yt=>A(t,g)},[o.value!==l.Week?(d(),c("div",it,[n("div",ct,T(t.name),1),M(t).text!==""?(d(),c("span",{key:0,class:_(r(C)(M(t).icon,M(t).class,"size-5"))},null,2)):z("",!0)])):(d(),c("div",dt,[n("div",null,[n("div",mt,T(t.name),1),n("div",null,T(`${t.startTime.format("MM/DD")} - ${t.endTime.format("MM/DD")}`),1)]),n("span",{class:_(r(C)(M(t).icon,M(t).class,"size-6"))},null,2)]))],10,ut))),128))],2)]),_:1}),m(r(I),{class:"mt-4"},{default:p(()=>[n("div",vt,[e[4]||(e[4]=n("div",{class:"text-[16px]"},"基础表",-1)),n("div",ft,[(d(!0),c(S,null,B(r(Q),t=>(d(),c("div",{class:"mr-4 flex items-center",key:t.status},[n("span",{class:_(r(C)(t.icon,t.class))},null,2),n("span",pt,T(t.text),1)]))),128))])]),m(X,{"table-list":h.value,loading:y.value},null,8,["table-list","loading"])]),_:1})]))}});export{gt as _};
