var O=Object.defineProperty;var C=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var v=(l,n,a)=>n in l?O(l,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[n]=a,_=(l,n)=>{for(var a in n||(n={}))j.call(n,a)&&v(l,a,n[a]);if(C)for(var a of C(n))G.call(n,a)&&v(l,a,n[a]);return l};var f=(l,n,a)=>new Promise((d,p)=>{var g=i=>{try{o(a.next(i))}catch(m){p(m)}},y=i=>{try{o(a.throw(i))}catch(m){p(m)}},o=i=>i.done?d(i.value):Promise.resolve(i.value).then(g,y);o((a=a.apply(l,n)).next())});import{dU as L,dV as M,a3 as k,cZ as b}from"./bootstrap-B0IOIL79.js";import{h as P,a as U,b as J}from"./index-DJfT9zXE.js";import{_ as K,c as Y}from"./dept-drawer.vue_vue_type_script_setup_true_lang-YZIk2nBi.js";import{_ as S}from"./table-action.vue_vue_type_style_index_0_lang-D0vDTAOO.js";import Z from"./index-Bml6TPTK.js";import H from"./index-DrWjF7M-.js";import{_ as Q}from"./page.vue_vue_type_script_setup_true_lang-Bz79GSJl.js";import{_ as W}from"./fallback.vue_vue_type_script_setup_true_lang-CK1l9FEq.js";import{e as w,f as X,s as R}from"./tree-Cp_w0kss.js";import{m as ee,b9 as $,aa as te,ab as h,b2 as D,bJ as u,j as c,u as s,ac as ae,ai as E,bp as T,n as re}from"../jse/index-index-StHjciy-.js";import{u as ne}from"./use-drawer-zBZwZnKb.js";import"./get-popup-container-BlodRF3J.js";import"./index-CI0QbcYu.js";import"./shallowequal-OTweHxuM.js";import"./Overflow-2nn19wYT.js";import"./index-bM1Vk0h0.js";import"./collapseMotion-BMhP7PaA.js";import"./slide-2E_o1wq8.js";import"./Dropdown-C8KFxVx_.js";import"./move-tO33QGmZ.js";import"./statusUtils-BM5saZYj.js";import"./BaseInput-4GoaorVY.js";import"./index-4s_bB_58.js";import"./SearchOutlined-DWMloAPO.js";import"./isPlainObject-u3tyL0Le.js";import"./rotate-cw-G598-s-f.js";import"./x-eg9hdiEc.js";const qe=ee({__name:"index",setup(l){const[n,a]=ne({connectedComponent:K,destroyOnClose:!0}),d=$(""),p=$([]),g={columns:Y,height:"auto",keepSource:!0,toolbarConfig:{custom:!0,export:!1,zoom:!0,search:!0},pagerConfig:{enabled:!1},proxyConfig:{ajax:{query:(r,...z)=>f(null,[r,...z],function*(t,e={}){d.value="";const F=yield J(_({},e)),x=R(F,"sortNumber","id");return p.value=x,{records:x}}),querySuccess:()=>{w(o.grid.getData(),t=>t.expand=!0),re(()=>{i(!0)})}}},scrollY:{enabled:!1,gt:0},rowConfig:{keyField:"id",drag:!0},rowDragConfig:{trigger:"cell",isPeerDrag:!0,dragEndMethod({newRow:t,oldRow:e}){return t.parentId!==e.parentId?(b.warning("必须在相同层级内拖拽排序"),!1):t.operable===0||e.operable===0?(b.warning("该部门不可操作"),!1):!0}},treeConfig:{parentField:"parentId",rowField:"id",transform:!0},id:"system-dept-index"},[y,o]=L({gridOptions:g,gridEvents:{cellDblclick:t=>{const{row:e={}}=t;if(!(e!=null&&e.children))return;const r=e==null?void 0:e.expand;o.grid.setTreeExpand(e,!r),e.expand=!r},toggleTreeExpand:t=>{const{row:e={},expanded:r}=t;e.expand=r},rowDragend:r=>f(null,[r],function*({newRow:t,oldRow:e}){if(!t||!e){console.warn("拖拽行信息不完整，操作取消");return}try{yield U({fid:String(t.id),sid:String(e.id)}),yield o.query(),b.success("排序更新成功")}catch(z){o.grid.loadData(p.value),console.error(z)}})}});function i(t){var e;w(o.grid.getData(),r=>r.expand=t),(e=o.grid)==null||e.setAllTreeExpand(t)}function m(){a.setData(null).open()}function A(t){a.setData({parentId:t.id}).open()}function V(t){return f(this,null,function*(){a.setData(t).open()})}function B(t){return f(this,null,function*(){yield P(t.id),yield o.query()})}function q(){if(!d.value){o.grid.loadData(p.value),i(!0);return}const t=X(p.value,d.value,"deptName");o.grid.loadData(t),i(!0)}const{hasAccessByCodes:I}=M(),N=te(()=>I(["system:dept:list"]));return(t,e)=>N.value?(D(),h(s(Q),{key:0,"auto-content-height":""},{default:u(()=>[c(s(y),null,{"toolbar-actions":u(()=>[c(s(S),{actions:[{label:"新增",type:"primary",icon:"ant-design:plus-outlined",auth:["system:dept:add"],onClick:()=>m()}]},null,8,["actions"])]),"toolbar-tools":u(()=>[c(s(Z),null,{default:u(()=>[c(s(H).Search,{value:d.value,"onUpdate:value":e[0]||(e[0]=r=>d.value=r),placeholder:"输入部门名称搜索",style:{width:"240px"},onSearch:q,"allow-clear":""},null,8,["value"]),c(s(k),{onClick:e[1]||(e[1]=r=>i(!1))},{default:u(()=>[E(T(t.$t("pages.common.collapse")),1)]),_:1}),c(s(k),{onClick:e[2]||(e[2]=r=>i(!0))},{default:u(()=>[E(T(t.$t("pages.common.expand")),1)]),_:1})]),_:1})]),action:u(({row:r})=>[r.operable===1?(D(),h(s(S),{key:0,actions:[{label:"编辑",icon:"ant-design:edit-outlined",auth:["system:dept:edit"],onClick:V.bind(null,r)},{label:"新增下级",type:"link",auth:["system:dept:add"],icon:"ant-design:plus-outlined",size:"small",onClick:A.bind(null,r)}],"drop-down-actions":[{label:"删除",icon:"ant-design:delete-outlined",auth:["system:dept:delete"],popConfirm:{title:"确定删除吗？",confirm:B.bind(null,r)}}]},null,8,["actions","drop-down-actions"])):ae("",!0)]),_:1}),c(s(n),{onReload:e[3]||(e[3]=r=>s(o).query())})]),_:1})):(D(),h(s(W),{key:1,description:"抱歉，您没有权限访问此页面。",status:"403"}))}});export{qe as default};
