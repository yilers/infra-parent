var s=(t,o,i)=>new Promise((u,c)=>{var m=e=>{try{a(i.next(e))}catch(n){c(n)}},d=e=>{try{a(i.throw(e))}catch(n){c(n)}},a=e=>e.done?u(e.value):Promise.resolve(e.value).then(m,d);a((i=i.apply(t,o)).next())});import{c_ as C,dU as T,dV as D,cZ as v}from"./bootstrap-B0IOIL79.js";import{b as I}from"./params-B2Lywk-4.js";import{_ as N}from"./operation-preview-drawer.vue_vue_type_script_setup_true_lang-Dxtnfz_e.js";import{u as $}from"./useDateRangePicker-BKtSYaWH.js";import{_ as A}from"./table-action.vue_vue_type_style_index_0_lang-D0vDTAOO.js";import{_ as V}from"./page.vue_vue_type_script_setup_true_lang-Bz79GSJl.js";import{_ as q}from"./fallback.vue_vue_type_script_setup_true_lang-CK1l9FEq.js";import{m as G,aa as L,ab as _,b2 as h,bJ as b,j as f,u as l}from"../jse/index-index-StHjciy-.js";import{u as O}from"./use-drawer-zBZwZnKb.js";import"./index-WX1QZ44Z.js";import"./index-CI0QbcYu.js";import"./shallowequal-OTweHxuM.js";import"./Overflow-2nn19wYT.js";import"./index-bM1Vk0h0.js";import"./collapseMotion-BMhP7PaA.js";import"./slide-2E_o1wq8.js";import"./index-Bml6TPTK.js";import"./Dropdown-C8KFxVx_.js";import"./move-tO33QGmZ.js";import"./rotate-cw-G598-s-f.js";import"./x-eg9hdiEc.js";function S(t){return s(this,null,function*(){return C.post("/log/page",t)})}function Y(t){return s(this,null,function*(){return C.post(`/log/delete/${t}`)})}const{dateRangePresets:B}=$();function y(){return[{color:"processing",label:"成功",value:1},{color:"error",label:"失败",value:0}]}function M(){return[B.datetime("createTime","创建时间"),{component:"Input",fieldName:"operator",label:"操作用户",componentProps:{allowClear:!0}},{component:"Select",componentProps:{allowClear:!0,options:y(),placeholder:"请选择"},fieldName:"success",label:"请求结果"},{component:"Input",fieldName:"module",label:"模块类型",componentProps:{allowClear:!0}},{component:"Input",fieldName:"action",label:"动作",componentProps:{allowClear:!0}}]}function R(t){return[{field:"createTime",title:"创建时间",sortable:!0},{field:"operatorName",title:"操作用户",formatter({cellValue:o}){return o||"--"}},{field:"module",title:"模块"},{field:"action",title:"动作"},{field:"duration",title:"请求时长"},{field:"success",align:"center",cellRender:{name:"CellTag",options:y()},title:"请求结果",width:100},{field:"stackTrace",title:"失败原因",formatter({cellValue:o}){return o||"--"}},{field:"ip",title:"IP"},{width:120,title:"操作",align:"center",slots:{default:"action"},fixed:"right"}]}const me=G({__name:"index",setup(t){const o={wrapperClass:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",compact:!0,collapsed:!0,fieldMappingTime:[["createTime",["startTime","endTime"],"YYYY-MM-DD HH:mm:ss"]],schema:M(),submitOnChange:!1},i={columns:R(),height:"auto",keepSource:!0,proxyConfig:{ajax:{query:(de,fe)=>s(null,[de,fe],function*({page:{currentPage:r,pageSize:g},sorts:p},P){const x=I({currentPage:r,pageSize:g},P,p);return yield S(x)})}},sortConfig:{remote:!0,multiple:!1},toolbarConfig:{search:!0},rowConfig:{keyField:"id"},id:"system-log-index"},u={sortChange(){m.query()}},[c,m]=T({formOptions:o,gridOptions:i,gridEvents:u}),d=r=>s(null,null,function*(){yield Y(r.id),v.success("删除成功"),m.query()}),[a,e]=O({connectedComponent:N});function n(r){e.setData({record:r}),e.open()}const{hasAccessByCodes:w}=D(),k=L(()=>w(["system:log:list"]));return(r,g)=>k.value?(h(),_(l(V),{key:0,"auto-content-height":""},{default:b(()=>[f(l(c),{"table-title":"操作日志"},{action:b(({row:p})=>[f(l(A),{actions:[{label:"预览",icon:"ant-design:eye-outlined",auth:["system:log:list"],onClick:n.bind(null,p)},{label:"删除",icon:"ant-design:delete-outlined",auth:["system:log:delete"],type:"link",size:"small",popConfirm:{title:"确定删除吗？",confirm:d.bind(null,p)}}]},null,8,["actions"])]),_:1}),f(l(a))]),_:1})):(h(),_(l(q),{key:1,description:"抱歉，您没有权限访问此页面。",status:"403"}))}});export{me as default};
