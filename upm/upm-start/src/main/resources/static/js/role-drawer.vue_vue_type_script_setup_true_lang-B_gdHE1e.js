var G=Object.defineProperty,Z=Object.defineProperties;var _=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var F=(s,l,t)=>l in s?G(s,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[l]=t,K=(s,l)=>{for(var t in l||(l={}))q.call(l,t)&&F(s,t,l[t]);if(R)for(var t of R(l))J.call(l,t)&&F(s,t,l[t]);return s},L=(s,l)=>Z(s,_(l));var x=(s,l,t)=>new Promise((d,u)=>{var y=o=>{try{r(t.next(o))}catch(c){u(c)}},g=o=>{try{r(t.throw(o))}catch(c){u(c)}},r=o=>o.done?d(o.value):Promise.resolve(o.value).then(y,g);r((t=t.apply(s,l)).next())});import{aZ as U,a$ as Q,cZ as Y}from"./bootstrap-B0IOIL79.js";import{b as H}from"./index-DJfT9zXE.js";import{c as W,e as X,f as ee}from"./index-arYo5unX.js";import P from"./index-W0ekbP6X.js";import{T as te}from"./index-DFhZ3N70.js";import{m as z,aP as ae,b9 as v,aa as D,bz as se,w as le,v as re,n as ne,bB as oe,ad as ce,b2 as V,ae as m,aR as ie,bp as j,ai as w,j as S,bJ as b,u as k,ab as E,ac as de,ag as ue,bb as pe,bc as fe,aS as me,aw as ve,bY as M,aQ as ye}from"../jse/index-index-StHjciy-.js";import{t as ke,b as he,s as xe,l as ge}from"./tree-Cp_w0kss.js";import{u as $}from"./uniq-zDniVBSX.js";import{d as be}from"./data-N7aLfSNq.js";import{u as Ce}from"./use-drawer-zBZwZnKb.js";const we={class:"bg-background w-full rounded-lg border-[1px] p-[12px]"},De={class:"flex items-center justify-between gap-2 border-b-[1px] pb-2"},Se={class:"text-primary mx-1 font-semibold"},Ae={class:"flex flex-wrap items-center justify-between border-b-[1px] py-2"},Ie={class:"py-2"},Be=z({inheritAttrs:!1,__name:"tree-select-panel",props:ae({checkStrictly:{default:!0,type:Boolean},expandAllOnInit:{default:!1,type:Boolean},fieldNames:{default:()=>({key:"id",title:"label"}),type:Object},resetOnStrictlyChange:{default:!0,type:Boolean},treeData:{default:()=>[],type:Array}},{value:{default:()=>[],type:Array},valueModifiers:{}}),emits:["update:value"],setup(s,{expose:l}){const t=s,d=v(!1),u=v(!1),y=D(()=>!t.checkStrictly),g=D(()=>t.checkStrictly?"父子节点关联":"父子节点独立"),r=se(s,"value"),o=D(()=>{const n=t.fieldNames.key;return ke(t.treeData).map(e=>e[n])}),c=v([]),p=le([r,()=>t.treeData],()=>{if(t.checkStrictly&&r.value.length>0&&t.treeData.length>0){const n=he(t.treeData,r.value,{id:t.fieldNames.key});c.value=$([...n,...r.value]),p()}!t.checkStrictly&&r.value.length>0&&(c.value=r.value,p())});function A(n,e){if(Array.isArray(n)){const a=e.halfCheckedKeys||[];c.value=[...a,...n]}else c.value=[...n.checked],r.value=[...n.checked]}function f(n){r.value=n.target.checked?o.value:[],c.value=n.target.checked?o.value:[]}const h=v([]);function I(n){const e=n.target.checked;h.value=e?o.value:[]}l({getCheckedKeys:()=>$(c.value)}),re(()=>x(null,null,function*(){t.expandAllOnInit&&(yield ne(),h.value=o.value)}));const B=oe();return(n,e)=>(V(),ce("div",we,[m("div",De,[m("div",null,[e[5]||(e[5]=m("span",{class:"text-[14px]"},"节点状态：",-1)),m("span",{class:ie(["text-[14px]",[t.checkStrictly?"text-primary":"text-red-500"]])},j(g.value),3)]),m("div",null,[e[6]||(e[6]=w(" 已选中 ",-1)),m("span",Se,j(c.value.length),1),e[7]||(e[7]=w(" 个节点 ",-1))])]),m("div",Ae,[S(k(P),{checked:d.value,"onUpdate:checked":e[0]||(e[0]=a=>d.value=a),onChange:I},{default:b(()=>[...e[8]||(e[8]=[w(" 展开/折叠全部 ",-1)])]),_:1},8,["checked"]),S(k(P),{checked:u.value,"onUpdate:checked":e[1]||(e[1]=a=>u.value=a),onChange:f},{default:b(()=>[...e[9]||(e[9]=[w(" 全选/取消全选 ",-1)])]),_:1},8,["checked"])]),m("div",Ie,[s.treeData.length>0?(V(),E(k(te),{key:0,"check-strictly":y.value,"onUpdate:checkStrictly":e[2]||(e[2]=a=>y.value=a),"checked-keys":r.value,"onUpdate:checkedKeys":e[3]||(e[3]=a=>r.value=a),"expanded-keys":h.value,"onUpdate:expandedKeys":e[4]||(e[4]=a=>h.value=a),checkable:!0,"field-names":s.fieldNames,selectable:!1,"tree-data":s.treeData,onCheck:A},ue({_:2},[pe(Object.keys(k(B)),a=>({name:a,fn:b(i=>[fe(n.$slots,a,me(ve(i!=null?i:{})))])}))]),1032,["check-strictly","checked-keys","expanded-keys","field-names","tree-data"])):de("",!0)])]))}}),Me=z({__name:"role-drawer",emits:["reload"],setup(s,{emit:l}){const t=l,d=v(!1),u=v({}),y=v(),g=D(()=>d.value?U("pages.common.edit"):U("pages.common.add")),r=v([]);function o(){return x(this,null,function*(){const e=yield H({}),a=xe(e,"sortNumber","id"),i=ge(a,{id:"id",pid:"parentId"});r.value=i})}const[c,p]=Q({commonConfig:{componentProps:{class:"w-full"},formItemClass:"col-span-1"},layout:"vertical",schema:be(),showDefaultActions:!1,wrapperClass:"grid-cols-2 gap-x-4"}),[A,f]=Ce({onClosed:I,onConfirm:h,destroyOnClose:!0,onOpenChange(e){return x(this,null,function*(){if(!e)return null;f.lock();const{id:a}=f.getData();if(d.value=!!a,yield o(),d.value&&a){const i=yield W(a);u.value=M(i),yield p.setValues(u.value)}else yield p.setFieldValue("roleDeptIdList",[]);f.unlock()})}});function h(){return x(this,null,function*(){var e,a,i;try{f.lock(!0);const{valid:T}=yield p.validate();if(!T)return;const C=M(yield p.getValues());if(C.dataScope===4){const O=(i=(a=(e=y.value)==null?void 0:e[0])==null?void 0:a.getCheckedKeys())!=null?i:[];if(O.length===0){Y.error("选择自定义数据权限时，必须选择至少一个部门");return}C.roleDeptIdList=O}else C.roleDeptIdList=[];const N=L(K({},C),{version:u.value.version||1});yield d.value?X(N):ee(N),t("reload"),f.close()}catch(T){console.error(T)}finally{f.lock(!1)}})}function I(){return x(this,null,function*(){yield p.resetForm()})}function B(e){p.setFieldValue("deptCheckStrictly",e)}return(e,a)=>(V(),E(k(A),{title:g.value,class:"w-[600px]"},{default:b(()=>[S(k(c),null,{roleDeptIdList:b(i=>[S(k(Be),ye({ref_key:"deptSelectRef",ref:y},i,{"check-strictly":!1,"expand-all-on-init":!0,"tree-data":r.value,"field-names":{key:"id",title:"deptName"},onCheckStrictlyChange:B}),null,16,["tree-data"])]),_:1})]),_:1},8,["title"]))}});export{Me as _};
