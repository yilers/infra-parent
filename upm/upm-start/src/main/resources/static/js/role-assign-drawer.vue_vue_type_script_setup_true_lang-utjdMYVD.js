var d=(b,h,c)=>new Promise((i,s)=>{var m=t=>{try{e(c.next(t))}catch(u){s(u)}},p=t=>{try{e(c.throw(t))}catch(u){s(u)}},e=t=>t.done?i(t.value):Promise.resolve(t.value).then(m,p);e((c=c.apply(b,h)).next())});import{dU as B}from"./bootstrap-B0IOIL79.js";import{c as A,d as O}from"./index-arYo5unX.js";import{a as U}from"./index-DOXJoA8u.js";import{b as V}from"./params-B2Lywk-4.js";import{u as L,b as T}from"./data-N7aLfSNq.js";import{m as q,b9 as C,bY as z,ab as v,b2 as y,bJ as E,ac as Q,u as R,n as j}from"../jse/index-index-StHjciy-.js";import{u as F}from"./use-drawer-zBZwZnKb.js";const X=q({__name:"role-assign-drawer",emits:["reload"],setup(b,{emit:h}){const c=h,i=C({}),s=C([]),m=C(!1),[p,e]=F({onConfirm:u,onCancel:S,destroyOnClose:!0,onOpenChange(o){return d(this,null,function*(){if(!o)return null;e.lock();const{id:r}=e.getData();if(r){const n=yield A(r);i.value=z(n),s.value=i.value.userIdList||[],e.unlock(),m.value=!0}})}}),t=o=>d(null,null,function*(){o.getData().filter(l=>{var g;return(g=s.value)==null?void 0:g.includes(l.id)}).forEach(l=>{o.setCheckboxRow(l,!0)})});function u(){return d(this,null,function*(){e.lock(!0);try{const o=s.value,r={roleId:i.value.id,userIdList:o};yield O(r),c("reload"),e.close()}finally{e.lock(!1)}})}const _={compact:!0,collapsed:!0,commonConfig:{labelWidth:80},schema:T(),wrapperClass:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3"},I={checkboxConfig:{highlight:!0,reserve:!0,trigger:"row",checkRowKeys:s.value},toolbarConfig:{custom:!1,export:!1,refresh:!1,resizable:!1,zoom:!1},columns:L,height:"auto",keepSource:!0,pagerConfig:{enabled:!0},proxyConfig:{ajax:{query:(g,...w)=>d(null,[g,...w],function*({page:{currentPage:o,pageSize:r},sorts:n},l={}){const a=V({currentPage:o,pageSize:r},l,n);return yield U(a)}),querySuccess:()=>{j(()=>{t(f.grid)})}}},rowConfig:{keyField:"id"}};function k(){var w;const o=f.grid.getCheckboxReserveRecords(),r=f.grid.getCheckboxRecords(),n=f.grid.getData(),g=[...((w=s.value)==null?void 0:w.filter(a=>!n.some(x=>x.id===a)))||[],...o.map(a=>a.id),...r.map(a=>a.id)];return[...new Set(g)]}const P={checkboxChange(){s.value=k()},checkboxAll(){s.value=k()}},[D,f]=B({formOptions:_,gridOptions:I,gridEvents:P});function S(){e.close()}return(o,r)=>(y(),v(R(p),{class:"w-[800px]",title:"选择用户"},{default:E(()=>[m.value?(y(),v(R(D),{key:0})):Q("",!0)]),_:1}))}});export{X as _};
