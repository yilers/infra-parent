var ae=Object.defineProperty,oe=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var Z=(e,a,n)=>a in e?ae(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,A=(e,a)=>{for(var n in a||(a={}))le.call(a,n)&&Z(e,n,a[n]);if(H)for(var n of H(a))re.call(a,n)&&Z(e,n,a[n]);return e},Q=(e,a)=>oe(e,ie(a));var K=(e,a,n)=>new Promise((i,c)=>{var l=u=>{try{r(n.next(u))}catch(v){c(v)}},t=u=>{try{r(n.throw(u))}catch(v){c(v)}},r=u=>u.done?i(u.value):Promise.resolve(u.value).then(l,t);r((n=n.apply(e,a)).next())});import{bk as ce,bs as ue,bt as fe,bu as de,bv as f,bw as X,bx as me,by as ge,bz as he,bA as G,bB as be,bC as ye,bn as pe,bD as ee,bE as ve}from"./bootstrap-DjYyHEgg.js";import{m as D,aa as W,ad as x,b2 as m,aT as j,bc as R,bC as B,b9 as U,aR as q,j as g,u as s,bJ as h,ab as _,ai as E,bp as w,aP as te,bz as we,b7 as ne,w as xe,bF as Se,cM as $e,ag as se,cf as Pe,ae as C,v as ke,ac as M,aN as Re}from"../jse/index-index-rmdNY63r.js";import{T as Te}from"./auth-title-C7QwDUQ5.js";import{S as Le,a as Me,b as Ee,c as Ce}from"./index-D03MeGQz.js";import{m as Be}from"./crypto-DK7XV_U1.js";const De=D({__name:"spine-text",props:{animationDuration:{default:2},animationIterationCount:{default:"infinite"}},setup(e){const a=W(()=>({animation:`shine ${e.animationDuration}s linear ${e.animationIterationCount}`}));return(n,i)=>(m(),x("div",{style:j(a.value),class:"vben-spine-text !bg-clip-text text-transparent"},[R(n.$slots,"default")],4))}}),Ve=D({__name:"slider-captcha-action",props:{actionStyle:{},isPassing:{type:Boolean},toLeft:{type:Boolean}},setup(e,{expose:a}){const n=e,i=B("actionRef"),c=U("0"),l=W(()=>{const{actionStyle:r}=n;return Q(A({},r),{left:c.value})}),t=W(()=>Number.parseInt(c.value)>10&&!n.isPassing);return a({getEl:()=>i.value,getStyle:()=>{var r;return(r=i==null?void 0:i.value)==null?void 0:r.style},setLeft:r=>{c.value=r}}),(r,u)=>(m(),x("div",{ref_key:"actionRef",ref:i,class:q([{"transition-width !left-0 duration-300":e.toLeft,"rounded-md":t.value},"bg-background dark:bg-accent absolute left-0 top-0 flex h-full cursor-move items-center justify-center px-3.5 shadow-md"]),style:j(l.value),name:"captcha-action"},[g(s(ce),{"is-passing":e.isPassing,class:"text-foreground/60 size-4"},{default:h(()=>[R(r.$slots,"icon",{},()=>[e.isPassing?(m(),_(s(fe),{key:1})):(m(),_(s(ue),{key:0}))])]),_:3},8,["is-passing"])],6))}}),Ie=D({__name:"slider-captcha-bar",props:{barStyle:{},toLeft:{type:Boolean}},setup(e,{expose:a}){const n=e,i=B("barRef"),c=U("0"),l=W(()=>{const{barStyle:t}=n;return Q(A({},t),{width:c.value})});return a({getEl:()=>i.value,setWidth:t=>{c.value=t}}),(t,r)=>(m(),x("div",{ref_key:"barRef",ref:i,class:q([e.toLeft&&"transition-width !w-0 duration-300","bg-success absolute h-full"]),style:j(l.value)},null,6))}}),_e=D({__name:"slider-captcha-content",props:{contentStyle:{},isPassing:{type:Boolean},successText:{},text:{}},setup(e,{expose:a}){const n=e,i=B("contentRef"),c=W(()=>{const{contentStyle:l}=n;return A({},l)});return a({getEl:()=>i.value}),(l,t)=>(m(),x("div",{ref_key:"contentRef",ref:i,class:q([{[l.$style.success]:e.isPassing},"absolute top-0 flex size-full select-none items-center justify-center text-xs"]),style:j(c.value)},[R(l.$slots,"text",{},()=>[g(s(De),{class:"flex h-full items-center"},{default:h(()=>[E(w(e.isPassing?e.successText:e.text),1)]),_:1})])],6))}}),We="_success_fwxn1_2",Fe={success:We},Ne={$style:Fe},je=de(_e,[["__cssModules",Ne]]),qe=D({__name:"index",props:te({class:{},actionStyle:{default:()=>({})},barStyle:{default:()=>({})},contentStyle:{default:()=>({})},wrapperStyle:{default:()=>({})},isSlot:{type:Boolean,default:!1},successText:{default:""},text:{default:""}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:te(["end","move","start","success"],["update:modelValue"]),setup(e,{expose:a,emit:n}){const i=e,c=n,l=we(e,"modelValue"),t=ne({endTime:0,isMoving:!1,isPassing:!1,moveDistance:0,startTime:0,toLeft:!1});a({resume:z});const r=B("wrapperRef"),u=B("barRef"),v=B("contentRef"),S=B("actionRef");xe(()=>t.isPassing,o=>{if(o){const{endTime:y,startTime:p}=t,$=(y-p)/1e3;c("success",{isPassing:o,time:$.toFixed(1)}),l.value=o}}),Se(()=>{t.isPassing=!!l.value});function F(o){return"pageX"in o?o.pageX:"touches"in o&&o.touches[0]?o.touches[0].pageX:0}function V(o){t.isPassing||S.value&&(c("start",o),t.moveDistance=F(o)-Number.parseInt(S.value.getStyle().left.replace("px","")||"0",10),t.startTime=Date.now(),t.isMoving=!0)}function b(o){var P,k,I;const y=(k=(P=r.value)==null?void 0:P.offsetWidth)!=null?k:220,p=(I=o==null?void 0:o.offsetWidth)!=null?I:40,$=y-p-6;return{actionWidth:p,offset:$,wrapperWidth:y}}function d(o){const{isMoving:y,moveDistance:p}=t;if(y){const $=s(S),P=s(u);if(!$||!P)return;const{actionWidth:k,offset:I,wrapperWidth:N}=b($.getEl()),L=F(o)-p;c("move",{event:o,moveDistance:p,moveX:L}),L>0&&L<=I?($.setLeft(`${L}px`),P.setWidth(`${L+k/2}px`)):L>I&&($.setLeft(`${N-k}px`),P.setWidth(`${N-k/2}px`),i.isSlot||O())}}function T(o){const{isMoving:y,isPassing:p,moveDistance:$}=t;if(y&&!p){c("end",o);const P=S.value,k=s(u);if(!P||!k)return;const I=F(o)-$,{actionWidth:N,offset:L,wrapperWidth:J}=b(P.getEl());I<L?i.isSlot?setTimeout(()=>{if(l.value){const Y=s(v);Y&&(Y.getEl().style.width=`${Number.parseInt(k.getEl().style.width)}px`)}else z()},0):z():(P.setLeft(`${J-N}px`),k.setWidth(`${J-N/2}px`),O()),t.isMoving=!1}}function O(){if(i.isSlot){z();return}t.endTime=Date.now(),t.isPassing=!0,t.isMoving=!1}function z(){t.isMoving=!1,t.isPassing=!1,t.moveDistance=0,t.toLeft=!1,t.startTime=0,t.endTime=0;const o=s(S),y=s(u),p=s(v);!o||!y||!p||(p.getEl().style.width="100%",t.toLeft=!0,$e(()=>{t.toLeft=!1,o.setLeft("0"),y.setWidth("0")},300))}return(o,y)=>(m(),x("div",{ref_key:"wrapperRef",ref:r,class:q(s(Pe)("border-border bg-background-deep relative flex h-10 w-full items-center overflow-hidden rounded-md border text-center",i.class)),style:j(e.wrapperStyle),onMouseleave:T,onMousemove:d,onMouseup:T,onTouchend:T,onTouchmove:d},[g(Ie,{ref_key:"barRef",ref:u,"bar-style":e.barStyle,"to-left":t.toLeft},null,8,["bar-style","to-left"]),g(je,{ref_key:"contentRef",ref:v,"content-style":e.contentStyle,"is-passing":t.isPassing,"success-text":e.successText||s(f)("ui.captcha.sliderSuccessText"),text:e.text||s(f)("ui.captcha.sliderDefaultText")},se({_:2},[o.$slots.text?{name:"text",fn:h(()=>[R(o.$slots,"text",{isPassing:t.isPassing})]),key:"0"}:void 0]),1032,["content-style","is-passing","success-text","text"]),g(Ve,{ref_key:"actionRef",ref:S,"action-style":e.actionStyle,"is-passing":t.isPassing,"to-left":t.toLeft,onMousedown:V,onTouchstart:V},se({_:2},[o.$slots.actionIcon?{name:"icon",fn:h(()=>[R(o.$slots,"actionIcon",{isPassing:t.isPassing})]),key:"0"}:void 0]),1032,["action-style","is-passing","to-left"])],38))}}),ze={class:"w-full sm:mx-auto md:max-w-md"},Ae={class:"mt-4 flex items-center justify-between"},Xe={class:"text-muted-foreground text-center text-xs uppercase"},Qe={class:"mt-4 flex flex-wrap justify-center"},Ke=D({name:"ThirdPartyLogin",__name:"third-party-login",setup(e){return(a,n)=>(m(),x("div",ze,[C("div",Ae,[n[0]||(n[0]=C("span",{class:"border-input w-[35%] border-b dark:border-gray-600"},null,-1)),C("span",Xe,w(s(f)("authentication.thirdPartyLogin")),1),n[1]||(n[1]=C("span",{class:"border-input w-[35%] border-b dark:border-gray-600"},null,-1))]),C("div",Qe,[g(s(X),{class:"mb-3"},{default:h(()=>[g(s(Le))]),_:1}),g(s(X),{class:"mb-3"},{default:h(()=>[g(s(Me))]),_:1}),g(s(X),{class:"mb-3"},{default:h(()=>[g(s(Ee))]),_:1}),g(s(X),{class:"mb-3"},{default:h(()=>[g(s(Ce))]),_:1})])]))}}),Ge=["onKeydown"],Ue={class:"text-muted-foreground"},Oe={key:0,class:"mb-6 flex justify-between"},Je={class:"flex-center"},Ye={key:1,class:"mb-2 mt-4 flex items-center justify-between"},He={key:0,class:"mt-3 text-center text-sm"},Ze=D({name:"AuthenticationLogin",__name:"login",props:{formSchema:{default:()=>[]},codeLoginPath:{default:"/auth/code-login"},forgetPasswordPath:{default:"/auth/forget-password"},loading:{type:Boolean,default:!1},qrCodeLoginPath:{default:"/auth/qrcode-login"},registerPath:{default:"/auth/register"},showCodeLogin:{type:Boolean,default:!1},showForgetPassword:{type:Boolean,default:!1},showQrcodeLogin:{type:Boolean,default:!1},showRegister:{type:Boolean,default:!1},showRememberMe:{type:Boolean,default:!0},showThirdPartyLogin:{type:Boolean,default:!1},subTitle:{default:""},title:{default:""},submitButtonText:{default:""}},emits:["submit"],setup(e,{expose:a,emit:n}){const i=e,c=n,[l,t]=me(ne({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:W(()=>i.formSchema),showDefaultActions:!1})),r=ge(),u=`REMEMBER_ME_USERNAME_${location.hostname}`,v=localStorage.getItem(u)||"",S=U(!!v);function F(){return K(this,null,function*(){const{valid:b}=yield t.validate(),d=yield t.getValues();b&&(localStorage.setItem(u,S.value?d==null?void 0:d.username:""),c("submit",d))})}function V(b){r.push(b)}return ke(()=>{v&&t.setFieldValue("username",v)}),a({getFormApi:()=>t}),(b,d)=>(m(),x("div",{onKeydown:be(ye(F,["prevent"]),["enter"])},[R(b.$slots,"title",{},()=>[g(Te,null,{desc:h(()=>[C("span",Ue,[R(b.$slots,"subTitle",{},()=>[E(w(e.subTitle||s(f)("authentication.loginSubtitle")),1)])])]),default:h(()=>[R(b.$slots,"title",{},()=>[E(w(e.title||`${s(f)("authentication.welcomeBack")} ðŸ‘‹ðŸ»`),1)])]),_:3})]),g(s(l)),e.showRememberMe||e.showForgetPassword?(m(),x("div",Oe,[C("div",Je,[e.showRememberMe?(m(),_(s(he),{key:0,modelValue:S.value,"onUpdate:modelValue":d[0]||(d[0]=T=>S.value=T),name:"rememberMe"},{default:h(()=>[E(w(s(f)("authentication.rememberMe")),1)]),_:1},8,["modelValue"])):M("",!0)]),e.showForgetPassword?(m(),x("span",{key:0,class:"vben-link text-sm font-normal",onClick:d[1]||(d[1]=T=>V(e.forgetPasswordPath))},w(s(f)("authentication.forgetPassword")),1)):M("",!0)])):M("",!0),g(s(G),{class:q([{"cursor-wait":e.loading},"w-full"]),loading:e.loading,"aria-label":"login",onClick:F},{default:h(()=>[E(w(e.submitButtonText||s(f)("common.login")),1)]),_:1},8,["class","loading"]),e.showCodeLogin||e.showQrcodeLogin?(m(),x("div",Ye,[e.showCodeLogin?(m(),_(s(G),{key:0,class:"w-1/2",variant:"outline",onClick:d[2]||(d[2]=T=>V(e.codeLoginPath))},{default:h(()=>[E(w(s(f)("authentication.mobileLogin")),1)]),_:1})):M("",!0),e.showQrcodeLogin?(m(),_(s(G),{key:1,class:"ml-4 w-1/2",variant:"outline",onClick:d[3]||(d[3]=T=>V(e.qrCodeLoginPath))},{default:h(()=>[E(w(s(f)("authentication.qrcodeLogin")),1)]),_:1})):M("",!0)])):M("",!0),R(b.$slots,"third-party-login",{},()=>[e.showThirdPartyLogin?(m(),_(Ke,{key:0})):M("",!0)]),R(b.$slots,"to-register",{},()=>[e.showRegister?(m(),x("div",He,[E(w(s(f)("authentication.accountTip"))+" ",1),C("span",{class:"vben-link text-sm font-normal",onClick:d[4]||(d[4]=T=>V(e.registerPath))},w(s(f)("authentication.createAccount")),1)])):M("",!0)])],40,Ge))}}),it=D({name:"Login",__name:"login",setup(e){const a=pe(),n=W(()=>[{component:"VbenInput",componentProps:{placeholder:f("authentication.usernameTip")},fieldName:"account",label:f("authentication.username"),rules:ee().min(1,{message:f("authentication.usernameTip")})},{component:"VbenInputPassword",componentProps:{placeholder:f("authentication.password")},fieldName:"password",label:f("authentication.password"),rules:ee().min(1,{message:f("authentication.passwordTip")})},{component:Re(qe),fieldName:"captcha",rules:ve().refine(l=>l,{message:f("authentication.verifyRequiredTip")})}]),i=B("loginRef");function c(l){return K(this,null,function*(){l.password&&(l.password=Be(l.password)),a.authLogin(l).catch(()=>{var r,u;const t=(r=i.value)==null?void 0:r.getFormApi();t==null||t.setFieldValue("captcha",!1,!1),(u=t==null?void 0:t.getFieldComponentRef("captcha"))==null||u.resume()})})}return(l,t)=>(m(),_(s(Ze),{ref_key:"loginRef",ref:i,"form-schema":n.value,loading:s(a).loginLoading,onSubmit:c},null,8,["form-schema","loading"]))}});export{it as _};
