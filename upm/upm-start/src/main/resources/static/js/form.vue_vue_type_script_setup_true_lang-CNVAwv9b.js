var Z=Object.defineProperty,D=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var B=(a,s,r)=>s in a?Z(a,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[s]=r,d=(a,s)=>{for(var r in s||(s={}))T.call(s,r)&&B(a,r,s[r]);if(g)for(var r of g(s))E.call(s,r)&&B(a,r,s[r]);return a},_=(a,s)=>D(a,ee(s));var x=(a,s)=>{var r={};for(var o in a)T.call(a,o)&&s.indexOf(o)<0&&(r[o]=a[o]);if(a!=null&&g)for(var o of g(a))s.indexOf(o)<0&&E.call(a,o)&&(r[o]=a[o]);return r};var P=(a,s,r)=>new Promise((o,i)=>{var f=u=>{try{m(r.next(u))}catch(S){i(S)}},p=u=>{try{m(r.throw(u))}catch(S){i(S)}},m=u=>u.done?o(u.value):Promise.resolve(u.value).then(f,p);m((r=r.apply(a,s)).next())});import{eg as te,eh as re,ei as ne,dx as ae,bx as se,dK as oe}from"./bootstrap-DjYyHEgg.js";import{o as ie,p as ue}from"./index-BWhM0zNP.js";import{f as ce,d as le}from"./index-BiID8tjB.js";import{m as de,b9 as y,b$ as fe,aa as pe,ab as me,b2 as Se,bJ as ve,j as he,u as F}from"../jse/index-index-rmdNY63r.js";import{u as be}from"./use-drawer-CB92zaEG.js";const Ae=de({__name:"form",setup(a){const s=["saleOrder","payBill"],r={jzySaleOrder:!1,difference:!1,productCardMatch:ne.Sale,supplyOrderImport:re.NO,payBillImport:te.TWO},o=y([]),i=y({}),f=y([]),p=y([]),m=ae(),u=y(),[S,v]=se(_(d({showDefaultActions:!1},ce),{handleValuesChange(e,t){var n;(n=e.extend)!=null&&n.dataSource&&L(e.extend.dataSource)}})),[M,O]=be({destroyOnClose:!0,onConfirm(){return P(this,null,function*(){var t,n;try{if(!(yield v.validate()).valid)return;const e=yield v.getValues(),{_divider:l}=e,h=x(e,["_divider"]);O.lock();const N=yield $(h);yield((t=i.value)!=null&&t.id?ie:ue)(N),oe.success("保存成功"),yield m.initShopList(),O.close(),(n=u.value)==null||n.query()}finally{O.unlock()}})},onOpenChange(e){e?j():k()}});function j(){const e=O.getData();J(e),X(),U(),z(e==null?void 0:e.record)}function k(){i.value={},u.value=null,o.value=[]}function J(e){u.value=e==null?void 0:e.gridApi,f.value=(e==null?void 0:e.brandSelect)||[],p.value=(e==null?void 0:e.platformSelect)||[]}function U(){o.value=[]}function z(e){if(e){i.value=fe(e);const t=q(e.extend),n=K(t);i.value.extend=_(d(d({},r),t),{dataSource:n}),n&&(o.value=[...n])}else i.value={extend:r};v.setValues(i.value)}function L(e){if(!Array.isArray(e))return;const t=R(e);if(t!==e){o.value=t,setTimeout(()=>{v.setFieldValue("extend.dataSource",t)},0);return}o.value=[...e]}function R(e){const t=W(e);if(!t)return e;const n=s.filter(l=>l!==t);return n.some(l=>e.includes(l))?e.filter(l=>!n.includes(l)):e}function W(e){return s.find(t=>e.includes(t)&&!o.value.includes(t))}const X=()=>{v.updateSchema([{componentProps:{options:f.value},fieldName:"brandId"},{componentProps:{options:p.value},fieldName:"platformId"}])};function q(e){return typeof e=="string"?JSON.parse(e):e}function K(e){return Object.entries(e).filter(([,t])=>typeof t=="boolean"&&t===!0).map(([t])=>t)}function $(e){return P(this,null,function*(){var b;const{id:t,shopName:n,platformId:c,brandId:l,extend:h}=e,N=G(c),A=H(l),C=Q(h,(b=i.value)==null?void 0:b.extend);return _(d({},t&&{id:t}),{shopName:n,platformId:c,platformName:N,brandId:l,brandName:A,extend:JSON.stringify(C)})})}function G(e){var t,n;return(n=(t=p.value.find(c=>c.id===e))==null?void 0:t.platformName)!=null?n:""}function H(e){var t,n;return(n=(t=f.value.find(c=>c.id===e))==null?void 0:t.brandName)!=null?n:""}function Q(e,t){const n=Array.isArray(e==null?void 0:e.dataSource)?e.dataSource:[],c=le.reduce((V,I)=>(V[I.value]=n.includes(I.value),V),{}),b=e||{},{dataSource:l}=b,h=x(b,["dataSource"]),w=(typeof t=="string"?JSON.parse(t):t||{})||{},{dataSource:A}=w,C=x(w,["dataSource"]);return d(d(d({},C),h),c)}const Y=pe(()=>{var e;return(e=i.value)!=null&&e.id?"编辑店铺":"新增店铺"});return(e,t)=>(Se(),me(F(M),{class:"w-[800px]",title:Y.value},{default:ve(()=>[he(F(S))]),_:1},8,["title"]))}});export{Ae as _};
