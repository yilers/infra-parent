var O=Object.defineProperty;var C=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var v=(l,r,a)=>r in l?O(l,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[r]=a,_=(l,r)=>{for(var a in r||(r={}))j.call(r,a)&&v(l,a,r[a]);if(C)for(var a of C(r))G.call(r,a)&&v(l,a,r[a]);return l};var f=(l,r,a)=>new Promise((d,u)=>{var g=s=>{try{o(a.next(s))}catch(m){u(m)}},y=s=>{try{o(a.throw(s))}catch(m){u(m)}},o=s=>s.done?d(s.value):Promise.resolve(s.value).then(g,y);o((a=a.apply(l,r)).next())});import{ee as K,dz as L,a7 as k,dK as b}from"./bootstrap-DjYyHEgg.js";import{h as M,a as P,b as J}from"./index-D5n-88Z9.js";import{_ as U,c as Y}from"./dept-drawer.vue_vue_type_script_setup_true_lang-B1EMTipg.js";import{_ as S}from"./table-action.vue_vue_type_style_index_0_lang-BluPqhNI.js";import H from"./index-CM6A-82x.js";import Q from"./index-EkdSFYQU.js";import{_ as W}from"./page.vue_vue_type_script_setup_true_lang-CmAABu9Z.js";import{_ as X}from"./fallback.vue_vue_type_script_setup_true_lang-CaaeY5iC.js";import{e as w,a as Z,s as R}from"./tree-DTIvVT2i.js";import{m as ee,b9 as $,aa as te,ab as h,b2 as D,bJ as p,j as c,u as i,ac as ae,ai as E,bp as T,n as ne}from"../jse/index-index-rmdNY63r.js";import{u as re}from"./use-drawer-CB92zaEG.js";import"./get-popup-container-BlodRF3J.js";import"./index-Bw6N7aDv.js";import"./shallowequal-W2RnI4nT.js";import"./Dropdown-D1vLSWoc.js";import"./index-DMLMl1eR.js";import"./isPlainObject-DfbxWMXa.js";import"./rotate-cw-Dzdn7gja.js";const ke=ee({__name:"index",setup(l){const[r,a]=re({connectedComponent:U,destroyOnClose:!0}),d=$(""),u=$([]),g={columns:Y,height:"auto",keepSource:!0,toolbarConfig:{custom:!0,export:!1,zoom:!0,search:!0},pagerConfig:{enabled:!1},proxyConfig:{ajax:{query:(n,...N)=>f(null,[n,...N],function*(t,e={}){d.value="";const F=yield J(_({},e)),x=R(F,"sortNumber","id");return u.value=x,{records:x}}),querySuccess:()=>{w(o.grid.getData(),t=>t.expand=!0),ne(()=>{s(!0)})}}},scrollY:{enabled:!1,gt:0},rowConfig:{keyField:"id",drag:!0},rowDragConfig:{trigger:"cell",isPeerDrag:!0,dragEndMethod({newRow:t,oldRow:e}){return t.parentId!==e.parentId?(b.warning("必须在相同层级内拖拽排序"),!1):t.operable===0||e.operable===0?(b.warning("该部门不可操作"),!1):!0}},treeConfig:{parentField:"parentId",rowField:"id",transform:!0},id:"system-dept-index"},[y,o]=K({gridOptions:g,gridEvents:{cellDblclick:t=>{const{row:e={}}=t;if(!(e!=null&&e.children))return;const n=e==null?void 0:e.expand;o.grid.setTreeExpand(e,!n),e.expand=!n},toggleTreeExpand:t=>{const{row:e={},expanded:n}=t;e.expand=n},rowDragend:n=>f(null,[n],function*({newRow:t,oldRow:e}){if(!t||!e){console.warn("拖拽行信息不完整，操作取消");return}try{yield P({fid:String(t.id),sid:String(e.id)}),yield o.query(),b.success("排序更新成功")}catch(N){o.grid.loadData(u.value),console.error(N)}})}});function s(t){var e;w(o.grid.getData(),n=>n.expand=t),(e=o.grid)==null||e.setAllTreeExpand(t)}function m(){a.setData(null).open()}function A(t){a.setData({parentId:t.id}).open()}function B(t){return f(this,null,function*(){a.setData(t).open()})}function V(t){return f(this,null,function*(){yield M(t.id),yield o.query()})}function q(){if(!d.value){o.grid.loadData(u.value),s(!0);return}const t=Z(u.value,d.value,"deptName");o.grid.loadData(t),s(!0)}const{hasAccessByCodes:z}=L(),I=te(()=>z(["system:dept:list"]));return(t,e)=>I.value?(D(),h(i(W),{key:0,"auto-content-height":""},{default:p(()=>[c(i(y),null,{"toolbar-actions":p(()=>[c(i(S),{actions:[{label:"新增",type:"primary",icon:"ant-design:plus-outlined",auth:["system:dept:add"],onClick:()=>m()}]},null,8,["actions"])]),"toolbar-tools":p(()=>[c(i(H),null,{default:p(()=>[c(i(Q).Search,{value:d.value,"onUpdate:value":e[0]||(e[0]=n=>d.value=n),placeholder:"输入部门名称搜索",style:{width:"240px"},onSearch:q,"allow-clear":""},null,8,["value"]),c(i(k),{onClick:e[1]||(e[1]=n=>s(!1))},{default:p(()=>[E(T(t.$t("pages.common.collapse")),1)]),_:1}),c(i(k),{onClick:e[2]||(e[2]=n=>s(!0))},{default:p(()=>[E(T(t.$t("pages.common.expand")),1)]),_:1})]),_:1})]),action:p(({row:n})=>[n.operable===1?(D(),h(i(S),{key:0,actions:[{label:"编辑",icon:"ant-design:edit-outlined",auth:["system:dept:edit"],onClick:B.bind(null,n)},{label:"新增下级",type:"link",auth:["system:dept:add"],icon:"ant-design:plus-outlined",size:"small",onClick:A.bind(null,n)}],"drop-down-actions":[{label:"删除",icon:"ant-design:delete-outlined",auth:["system:dept:delete"],popConfirm:{title:"确定删除吗？",confirm:V.bind(null,n)}}]},null,8,["actions","drop-down-actions"])):ae("",!0)]),_:1}),c(i(r),{onReload:e[3]||(e[3]=n=>i(o).query())})]),_:1})):(D(),h(i(X),{key:1,description:"抱歉，您没有权限访问此页面。",status:"403"}))}});export{ke as default};
