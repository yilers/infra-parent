var $e=Object.defineProperty,ke=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable;var ae=(e,n,o)=>n in e?$e(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,ie=(e,n)=>{for(var o in n||(n={}))we.call(n,o)&&ae(e,o,n[o]);if(te)for(var o of te(n))Ie.call(n,o)&&ae(e,o,n[o]);return e},le=(e,n)=>ke(e,xe(n));var D=(e,n,o)=>new Promise((t,r)=>{var c=l=>{try{$(o.next(l))}catch(v){r(v)}},d=l=>{try{$(o.throw(l))}catch(v){r(v)}},$=l=>l.done?t(l.value):Promise.resolve(l.value).then(c,d);$((o=o.apply(e,n)).next())});import{cU as Se,g as _e,m as Te,_ as q,r as Be,d as Ae,P,a as Ee,e4 as Fe,e5 as Me,e6 as De,e7 as Ve,e8 as Le,a7 as Pe,e9 as He,aH as Oe,h as ze,ab as Ne,i as Re,z as Ge,aq as Ke,ar as je,G as We,as as Ue,b as re,ea as ce,dU as Xe,a3 as de,eb as J,aY as Ye,dV as qe,cX as Je}from"./bootstrap-B0IOIL79.js";import{a as Qe}from"./index-B8AwDIa3.js";import{h as Ze,a as en}from"./index-KxAZzjzc.js";import{c as nn,g as on}from"./index-arYo5unX.js";import{e as sn,b as tn,s as an,l as ln}from"./tree-Cp_w0kss.js";import rn from"./index-W0ekbP6X.js";import cn from"./index-Bml6TPTK.js";import{m as ne,bl as K,aa as Q,j as b,bL as dn,aP as un,bz as fn,b9 as L,v as pn,w as j,ad as ue,b2 as O,bJ as T,ae as Y,I as mn,bb as hn,ab as Z,u as w,ai as H,bp as W,bY as pe,n as me}from"../jse/index-index-StHjciy-.js";import{u as U}from"./uniq-zDniVBSX.js";import{m as gn}from"./data-N7aLfSNq.js";import{u as yn}from"./use-drawer-zBZwZnKb.js";function vn(e){return Array.isArray(e)?e:Array.from(e)}function Cn(e,n){const o=new Set(n);return e.filter(t=>!o.has(t))}function bn(e){return typeof e=="object"&&e!==null}function fe(e){return bn(e)&&Se(e)}function $n(e,...n){if(!fe(e))return[];const o=vn(e),t=[];for(let r=0;r<n.length;r++){const c=n[r];fe(c)&&t.push(...Array.from(c))}return Cn(o,t)}const X=(e,n,o,t,r)=>({backgroundColor:e,border:`${t.lineWidth}px ${t.lineType} ${n}`,[`${r}-icon`]:{color:o}}),kn=e=>{const{componentCls:n,motionDurationSlow:o,marginXS:t,marginSM:r,fontSize:c,fontSizeLG:d,lineHeight:$,borderRadiusLG:l,motionEaseInOutCirc:v,alertIconSizeLG:h,colorText:S,paddingContentVerticalSM:_,alertPaddingHorizontal:y,paddingMD:i,paddingContentHorizontalLG:s}=e;return{[n]:q(q({},Be(e)),{position:"relative",display:"flex",alignItems:"center",padding:`${_}px ${y}px`,wordWrap:"break-word",borderRadius:l,[`&${n}-rtl`]:{direction:"rtl"},[`${n}-content`]:{flex:1,minWidth:0},[`${n}-icon`]:{marginInlineEnd:t,lineHeight:0},"&-description":{display:"none",fontSize:c,lineHeight:$},"&-message":{color:S},[`&${n}-motion-leave`]:{overflow:"hidden",opacity:1,transition:`max-height ${o} ${v}, opacity ${o} ${v},
        padding-top ${o} ${v}, padding-bottom ${o} ${v},
        margin-bottom ${o} ${v}`},[`&${n}-motion-leave-active`]:{maxHeight:0,marginBottom:"0 !important",paddingTop:0,paddingBottom:0,opacity:0}}),[`${n}-with-description`]:{alignItems:"flex-start",paddingInline:s,paddingBlock:i,[`${n}-icon`]:{marginInlineEnd:r,fontSize:h,lineHeight:0},[`${n}-message`]:{display:"block",marginBottom:t,color:S,fontSize:d},[`${n}-description`]:{display:"block"}},[`${n}-banner`]:{marginBottom:0,border:"0 !important",borderRadius:0}}},xn=e=>{const{componentCls:n,colorSuccess:o,colorSuccessBorder:t,colorSuccessBg:r,colorWarning:c,colorWarningBorder:d,colorWarningBg:$,colorError:l,colorErrorBorder:v,colorErrorBg:h,colorInfo:S,colorInfoBorder:_,colorInfoBg:y}=e;return{[n]:{"&-success":X(r,t,o,e,n),"&-info":X(y,_,S,e,n),"&-warning":X($,d,c,e,n),"&-error":q(q({},X(h,v,l,e,n)),{[`${n}-description > pre`]:{margin:0,padding:0}})}}},wn=e=>{const{componentCls:n,iconCls:o,motionDurationMid:t,marginXS:r,fontSizeIcon:c,colorIcon:d,colorIconHover:$}=e;return{[n]:{"&-action":{marginInlineStart:r},[`${n}-close-icon`]:{marginInlineStart:r,padding:0,overflow:"hidden",fontSize:c,lineHeight:`${c}px`,backgroundColor:"transparent",border:"none",outline:"none",cursor:"pointer",[`${o}-close`]:{color:d,transition:`color ${t}`,"&:hover":{color:$}}},"&-close-text":{color:d,transition:`color ${t}`,"&:hover":{color:$}}}}},In=e=>[kn(e),xn(e),wn(e)],Sn=_e("Alert",e=>{const{fontSizeHeading3:n}=e,o=Te(e,{alertIconSizeLG:n,alertPaddingHorizontal:12});return[In(o)]}),_n={success:Oe,info:He,error:Pe,warning:Le},Tn={success:Ve,info:De,error:Me,warning:Fe},Bn=We("success","info","warning","error"),An=()=>({type:P.oneOf(Bn),closable:{type:Boolean,default:void 0},closeText:P.any,message:P.any,description:P.any,afterClose:Function,showIcon:{type:Boolean,default:void 0},prefixCls:String,banner:{type:Boolean,default:void 0},icon:P.any,closeIcon:P.any,onClose:Function}),En=ne({compatConfig:{MODE:3},name:"AAlert",inheritAttrs:!1,props:An(),setup(e,n){let{slots:o,emit:t,attrs:r,expose:c}=n;const{prefixCls:d,direction:$}=Ee("alert",e),[l,v]=Sn(d),h=K(!1),S=K(!1),_=K(),y=a=>{a.preventDefault();const g=_.value;g.style.height=`${g.offsetHeight}px`,g.style.height=`${g.offsetHeight}px`,h.value=!0,t("close",a)},i=()=>{var a;h.value=!1,S.value=!0,(a=e.afterClose)===null||a===void 0||a.call(e)},s=Q(()=>{const{type:a}=e;return a!==void 0?a:e.banner?"warning":"info"});c({animationEnd:i});const u=K({});return()=>{var a,g,k,A,E,F,f,p,m,x;const{banner:I,closeIcon:B=(a=o.closeIcon)===null||a===void 0?void 0:a.call(o)}=e;let{closable:M,showIcon:V}=e;const z=(g=e.closeText)!==null&&g!==void 0?g:(k=o.closeText)===null||k===void 0?void 0:k.call(o),N=(A=e.description)!==null&&A!==void 0?A:(E=o.description)===null||E===void 0?void 0:E.call(o),oe=(F=e.message)!==null&&F!==void 0?F:(f=o.message)===null||f===void 0?void 0:f.call(o),R=(p=e.icon)!==null&&p!==void 0?p:(m=o.icon)===null||m===void 0?void 0:m.call(o),se=(x=o.action)===null||x===void 0?void 0:x.call(o);V=I&&V===void 0?!0:V;const ge=(N?Tn:_n)[s.value]||null;z&&(M=!0);const C=d.value,ye=ze(C,{[`${C}-${s.value}`]:!0,[`${C}-closing`]:h.value,[`${C}-with-description`]:!!N,[`${C}-no-icon`]:!V,[`${C}-banner`]:!!I,[`${C}-closable`]:M,[`${C}-rtl`]:$.value==="rtl",[v.value]:!0}),ve=M?b("button",{type:"button",onClick:y,class:`${C}-close-icon`,tabindex:0},[z?b("span",{class:`${C}-close-text`},[z]):B===void 0?b(Ne,null,null):B]):null,Ce=R&&(Re(R)?Ge(R,{class:`${C}-icon`}):b("span",{class:`${C}-icon`},[R]))||b(ge,{class:`${C}-icon`},null),be=Ke(`${C}-motion`,{appear:!1,css:!0,onAfterLeave:i,onBeforeLeave:G=>{G.style.maxHeight=`${G.offsetHeight}px`},onLeave:G=>{G.style.maxHeight="0px"}});return l(S.value?null:b(je,be,{default:()=>[dn(b("div",re(re({role:"alert"},r),{},{style:[r.style,u.value],class:[r.class,ye],"data-show":!h.value,ref:_}),[V?Ce:null,b("div",{class:`${C}-content`},[oe?b("div",{class:`${C}-message`},[oe]):null,N?b("div",{class:`${C}-description`},[N]):null]),se?b("div",{class:`${C}-action`},[se]):null,ve]),[[Ue,!h.value]])]}))}}}),Fn=Ae(En);function he(e,n){var o;((o=e==null?void 0:e.permissions)==null?void 0:o.length)>0&&e.permissions.forEach(t=>{t.checked=n})}function ee(e,n){var o,t;he(e,n),(t=(o=e==null?void 0:e.children)==null?void 0:o.forEach)==null||t.call(o,r=>{ee(r,n)})}function Mn(e){sn(e,n=>{if(Dn(n),n.children&&n.children.length>0){const o=n.children.filter(c=>c.permissionType===2&&n.permissionType!==0),t=$n(n.children,o);n.children=t;const r=o.map(c=>({id:c.id,label:c.permissionName,checked:!1}));n.permissions=r}})}function Dn(e){var n,o,t,r;e.permissionType===1&&((o=(n=e.children)==null?void 0:n.forEach)==null||o.call(n,c=>{if([0,1].includes(c.permissionType)){const d=`错误用法: [${e.permissionName} - 菜单]下不能放 目录/菜单 -> [${c.permissionName}]`;console.warn(d),ce.warning({message:"提示",description:d,duration:0})}})),e.permissionType===2&&((r=(t=e.children)==null?void 0:t.forEach)==null||r.call(t,c=>{if([0,1,2].includes(c.permissionType)){const d=`错误用法: [${e.permissionName} - 按钮]下不能放置'目录/菜单/按钮' -> [${c.permissionName}]`;console.warn(d),ce.warning({message:"提示",description:d,duration:0})}}))}const Vn={class:"flex h-full flex-col",id:"menu-select-table"},Ln={class:"text-primary mx-1 font-semibold"},Pn={class:"flex flex-wrap gap-x-3 gap-y-1"},Hn=ne({name:"MenuSelectTable",inheritAttrs:!1,__name:"menu-select-table",props:un({checkedKeys:{default:()=>[]},defaultExpandAll:{type:Boolean,default:!0},hasPermissionType2:{type:Boolean,default:!0},menus:{}},{association:{type:Boolean,default:!0},associationModifiers:{}}),emits:["update:association"],setup(e,{expose:n}){const o=e,t=fn(e,"association"),r={checkboxConfig:{labelField:"permissionName",checkStrictly:!t.value},size:"small",columns:J,height:"auto",keepSource:!0,pagerConfig:{enabled:!1},proxyConfig:{enabled:!1},toolbarConfig:{refresh:!1,custom:!1,zoom:!0},rowConfig:{isHover:!1,isCurrent:!1,keyField:"id"},scrollY:{enabled:!0,gt:0},treeConfig:{parentField:"parentId",rowField:"id",transform:!1},showOverflow:!1},c=L(0);function d(){c.value=y().length}const[$,l]=Xe({gridOptions:r,gridEvents:{checkboxChange:i=>{const s=i.checked,u=i.row;t.value?ee(u,s):he(u,s),d()},checkboxAll:i=>{i.$grid.getData().forEach(u=>{ee(u,i.checked)}),d()}}});function v(i,s,u){i.forEach(a=>{s.includes(a.id)&&l.grid.setCheckboxRow(a,!0),a.permissions&&a.permissions.length>0&&a.permissions.forEach(g=>{s.includes(g.id)&&(g.checked=!0,u&&S(a))}),a.children&&a.children.length>0&&v(a.children,s,u)})}pn(()=>{j(()=>o.menus,i=>D(null,null,function*(){const s=pe(i);Mn(s),yield l.grid.loadData(s),o.defaultExpandAll&&(yield me(),h(!0))})),j(t,i=>{l.setGridOptions({checkboxConfig:{checkStrictly:!i}})}),j(()=>o.checkedKeys,i=>{const s=U([...i]),u=l.grid.getData();v(u,s,t.value),d()}),j(()=>o.hasPermissionType2,i=>{l.setGridOptions({columns:i?J:J.filter(s=>s.field!=="permissions")})},{immediate:!0})});function h(i){var s;(s=l.grid)==null||s.setAllTreeExpand(i)}function S(i){if(t.value){const s=i.permissions.filter(u=>u.checked===!0);s.length>0&&l.grid.setCheckboxRow(i,!0),s.length===0&&l.grid.setCheckboxRow(i,!1)}d()}function _(i,s){const u=[];return i.forEach(a=>{if(a.children&&a.children.length>0){const g=_(a.children,s);u.push(...g)}else if(s&&u.push(a.id),a.permissions&&a.permissions.length>0){const g=a.permissions.filter(k=>k.checked===!0).map(k=>k.id);u.push(...g)}}),U(u)}function y(){var k,A,E,F,f,p,m,x,I;if(t.value){const B=(E=(A=(k=l==null?void 0:l.grid)==null?void 0:k.getCheckboxRecords)==null?void 0:A.call(k,!0))!=null?E:[],M=_(B,!0),V=tn(o.menus,M);return U([...V,...M])}const i=(p=(f=(F=l==null?void 0:l.grid)==null?void 0:F.getCheckboxRecords)==null?void 0:f.call(F,!0))!=null?p:[],s=(I=(x=(m=l==null?void 0:l.grid)==null?void 0:m.getData)==null?void 0:x.call(m))!=null?I:[],u=i.map(B=>B.id),a=_(s,!1);return U([...u,...a])}return n({getCheckedKeys:y}),(i,s)=>(O(),ue("div",Vn,[b(w($),null,{"toolbar-actions":T(()=>[b(w(Fn),{class:"mr-2",type:"info"},{message:T(()=>[Y("div",null,[s[2]||(s[2]=H(" 已选中 ",-1)),Y("span",Ln,W(c.value),1),s[3]||(s[3]=H(" 个节点 ",-1))])]),_:1})]),"toolbar-tools":T(()=>[b(w(cn),null,{default:T(()=>[b(w(de),{onClick:s[0]||(s[0]=u=>h(!1))},{default:T(()=>[H(W(i.$t("pages.common.collapse")),1)]),_:1}),b(w(de),{onClick:s[1]||(s[1]=u=>h(!0))},{default:T(()=>[H(W(i.$t("pages.common.expand")),1)]),_:1})]),_:1})]),permissions:T(({row:u})=>[Y("div",Pn,[(O(!0),ue(mn,null,hn(u.permissions,a=>(O(),Z(w(rn),{key:a.id,checked:a.checked,"onUpdate:checked":g=>a.checked=g,onChange:()=>S(u)},{default:T(()=>[H(W(a.label),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])]),_:1})]))}}),On=Ye(Hn,[["__scopeId","data-v-76e91b49"]]),zn={class:"h-[600px] w-full"},Zn=ne({__name:"role-menu-drawer",emits:["reload"],setup(e,{emit:n}){const o=n,t=L(),r=L([]),c=L(!1),d=L({}),{hasAccessByRoles:$}=qe(),l=Q(()=>$(["platformAdmin"])),v=Q(()=>"分配菜单权限"),h=L(""),S=L([]),[_,y]=Je({commonConfig:{componentProps:{class:"w-full"},formItemClass:"col-span-1"},layout:"vertical",schema:gn(),showDefaultActions:!1,wrapperClass:"grid-cols-2 gap-x-4",handleValuesChange(f,p){E(f,p)}}),[i,s]=yn({onClosed:a,onConfirm:u,destroyOnClose:!0,onOpenChange(f){return D(this,null,function*(){if(!f)return null;s.lock();const{id:p}=s.getData();c.value=!!p;const m=yield nn(p);d.value=le(ie({},m),{menuCheckStrictly:!0}),y.setValues(d.value),yield g(),yield k(),s.unlock()})}});function u(){return D(this,null,function*(){var f,p,m;try{s.lock(!0);const{valid:x}=yield y.validate();if(!x)return;const I=(m=(p=(f=t.value)==null?void 0:f.getCheckedKeys)==null?void 0:p.call(f))!=null?m:[],B=pe(yield y.getValues()),M={roleId:B.id,permissionIdList:I,device:B.device};yield on(M),o("reload"),s.close()}catch(x){console.error(x)}finally{s.lock(!1)}})}function a(){return D(this,null,function*(){yield y.resetForm()})}function g(){return D(this,null,function*(){var f,p;try{const m=yield Qe();S.value=m,h.value=((f=m[0])==null?void 0:f.code)||"",y.updateSchema([{componentProps:{options:m.map(x=>({label:x.name,value:x.code}))},fieldName:"device"}]),y.setFieldValue("device",((p=m[0])==null?void 0:p.code)||"")}catch(m){}})}function k(){return D(this,null,function*(){const f=yield w(l)?Ze(w(h)):en(w(h)),p=an(f,"sortNumber","id");r.value=ln(p,{id:"id",pid:"parentId"});const m=new Set(p.map(I=>I.parentId).filter(Boolean));d.value.menuIds=d.value.relationPermissionList.filter(I=>!m.has(I.id)).map(I=>I.id)||[],yield me();const x=c.value?d.value.menuIds:[];yield y.setFieldValue("menuIds",x)})}function A(f){y.setFieldValue("menuCheckStrictly",f)}const E=(f,p)=>D(null,null,function*(){p[0]==="device"&&w(h)!==f.device&&(h.value=f.device,yield y.setFieldValue("menuIds",[]),yield k())});return(f,p)=>(O(),Z(w(i),{title:v.value,class:"w-[800px]"},{default:T(()=>[b(w(_),null,{menuIds:T(m=>[Y("div",zn,[(O(),Z(w(On),{ref_key:"menuSelectRef",ref:t,"checked-keys":m.value,association:w(y).form.values.menuCheckStrictly,menus:r.value,key:h.value,"onUpdate:association":A},null,8,["checked-keys","association","menus"]))])]),_:1})]),_:1},8,["title"]))}});export{Zn as _};
